/*! Thrive Quiz Builder - 2022-01-25
* http://www.thrivethemes.com/
* Copyright (c) 2022 Thrive Themes */
var ThriveQuizB=ThriveQuizB||{};ThriveQuizB.models=ThriveQuizB.models||{},ThriveQuizB.collections=ThriveQuizB.collections||{},function(a){a(function(){Backbone.emulateHTTP=!0,ThriveQuizB.models.Base=Backbone.Model.extend({idAttribute:"ID",validation_error:function(a,b){return{field:a,message:b}}}),ThriveQuizB.models.Quiz=ThriveQuizB.models.Base.extend({defaults:{ID:"",shortcode_code:"",type:"",results:[],minimum_results:2,style:"",tpl:"",structure:[],state:ThriveQuizB.util.states.normal,validation:{valid:!1,error:{qna:ThriveQuizB.t.NoQuestionError,results:ThriveQuizB.t.ResultPageError}}},parse:function(a){a.results=new ThriveQuizB.collections.Options(a.results);var b=this.getQuizTypeText(a.type);return a.quiz_type_text=b.text,a.quiz_type_label=b.label,a.thrive_images&&(a.thrive_images=new ThriveQuizB.collections.ThriveImages(a.thrive_images)),a},getQuizTypeText:function(a){var b={text:ThriveQuizB.t.quiz_type_text_not_set,label:ThriveQuizB.t.quiz_type_text_not_set};switch(a){case ThriveQuizB.data.quiz_types.personality:b.text=ThriveQuizB.t.quiz_type_text_personality,b.label=ThriveQuizB.t.quiz_type_label_personality;break;case ThriveQuizB.data.quiz_types.number:b.text=ThriveQuizB.t.quiz_type_text_number,b.label=ThriveQuizB.t.quiz_type_label_number;break;case ThriveQuizB.data.quiz_types.percentage:b.text=ThriveQuizB.t.quiz_type_text_percentage,b.label=ThriveQuizB.t.quiz_type_label_percentage;break;case ThriveQuizB.data.quiz_types.right_wrong:b.text=ThriveQuizB.t.quiz_type_text_right_wrong,b.label=ThriveQuizB.t.quiz_type_label_right_wrong;break;case ThriveQuizB.data.quiz_types.survey:b.text=ThriveQuizB.t.quiz_type_text_survey,b.label=ThriveQuizB.t.quiz_type_label_survey}return b},url:function(){var a=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=quiz");return this.get("ID")&&(a+="&ID="+this.get("ID")),a},getCode:function(){if(this.get("shortcode_code").length)return this.get("shortcode_code");var a="["+ThriveQuizB.shortcode_name+" id='"+this.get("ID")+"']";return this.set("shortcode_code",a),this.get("shortcode_code")},validate:function(a,b){var c=[];if(a.post_title||c.push(this.validation_error("post_title",ThriveQuizB.t.invalid_name)),c.length)return c},get_settings_step:function(){return this.get("type")?this.get("style")?void 0:"style":"type"},load_chart_data:function(b){return this.get("ID")?this.has("chart_data")?b.call(null,this.get("chart_data")):void a.ajax({url:this.url(),data:{custom:"chart_data",_nonce:ThriveQuizB.admin_nonce},type:"post",dataType:"json"}).done(_.bind(function(a){this.set("chart_data",a),b.call(null,this.get("chart_data"))},this)).fail(_.bind(function(){b.call(null,null)},this)):null},get_chart_dummy_data:function(){var a={};return a.conversions=[11,8,14,11,17,12,9,19,17,11,21,13,4],a.impressions=[64,58,89,85,93,75,74,83,88,72,90,82,27],a.labels=_.map(function(){return""},_.range(a.impressions.length)),a},get_edit_route:function(){return"#dashboard/quiz/"+this.get("ID")},get_report_route:function(){return"#reports/"+this.get("ID")},resetStatistics:function(b){b=b||{};var c=_.extend({type:"post",dataType:"json",url:this.url()+"&custom=reset_statistics"},b);return a.ajax(c)},anonymizeResults:function(b){b=b||{};var c=_.extend({type:"post",dataType:"json",url:this.url()+"&custom=anonymize_results"},b);return a.ajax(c)},structure_set:function(){return this.get("page_variations")>0||this.get("structure").tge_question_number},hasBadge:function(){if(!this.get("thrive_images")instanceof ThriveQuizB.collections.ThriveImages)return!1;var a=this.get("thrive_images").first();return a&&null!==a.get("image_url")},hasQuestions:function(){return this.get("structure")&&parseInt(this.get("structure").tge_question_number)>0},hasResultLinks:function(){return this.get("structure")&&this.get("structure").results_page&&this.get("structure").results_page.links&&this.get("structure").results_page.links.length>0}}),ThriveQuizB.models.Page=ThriveQuizB.models.Base.extend({defaults:{ID:""},parse:function(a){return a.variations&&(a.variations=new ThriveQuizB.collections.Variations(a.variations)),a.archived_variations&&(a.archived_variations=new ThriveQuizB.collections.Variations(a.archived_variations)),a},url:function(){var a=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=page");return this.get("ID")&&(a+="&ID="+this.get("ID")),a},checkVariationsContent:function(a,b){b||(b={});var c=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=check_variations_content",data:b},a);return jQuery.ajax(c)},gdprUserConsent:function(a,b){b||(b={});var c=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=gdpr_user_consent",data:b},a);return jQuery.ajax(c)}}),ThriveQuizB.models.Variation=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:"",quiz_id:"",page_id:"",parent_id:"",is_control:0,post_title:"",post_status:ThriveQuizB.data.variation_status.publish,state_order:"",cache_impressions:0,cache_optins:0,cache_optin_conversion_rate:"N/A",cache_social_shares:0,cache_social_share_conversion_rate:"N/A",content:""},validate:function(a,b){var c=[];if(a.post_title||a.default_name||c.push(this.validation_error("post_title",ThriveQuizB.t.invalid_name)),c.length)return c},url:function(){var a=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=variation");return this.get("id")&&(a+="&id="+this.get("id")),a},resetStatistics:function(a,b){b||(b={});var c=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=reset_statistics",data:b},a);return jQuery.ajax(c)},generateFirstVariation:function(a,b){b||(b={});var c=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=generate_first_variation",data:b},a);return jQuery.ajax(c)},cloneVariation:function(a,b){b||(b={});var c=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action=clone_variation",data:b},a);return jQuery.ajax(c)},get_name:function(){var a;try{a=ThriveQuizB.data.quiz_structure_item_types[this.get("type")].name}catch(b){return this.get("name")}return a}}),ThriveQuizB.models.BreadcrumbLink=ThriveQuizB.models.Base.extend({defaults:{ID:"",hash:"",label:"",full_link:!1},initialize:function(a){this.get("ID")||this.set("ID",a.label.split(" ").join("").toLowerCase()),this.set("full_link",a.hash.match(/^http/))},get_url:function(){return this.get("full_link")?this.get("hash"):"#"+this.get("hash")}}),ThriveQuizB.collections.Base=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)},first:function(){return this.at(0)}}),ThriveQuizB.collections.Quizzes=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Quiz,comparator:function(a){return parseInt(a.get("order"))},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=quizzes&start=0&end=15")}}),ThriveQuizB.collections.ReportQuizzes=ThriveQuizB.collections.Quizzes.extend({url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=quizzes&all_quizzes=1")}}),ThriveQuizB.collections.Breadcrumbs=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Base.extend({defaults:{hash:"",label:""}}),add_page:function(a,b){var c=new ThriveQuizB.models.BreadcrumbLink({hash:a,label:b});return this.add(c)}}),ThriveQuizB.models.Option=ThriveQuizB.models.Base.extend({defaults:{}}),ThriveQuizB.models.StructureItem=ThriveQuizB.models.Base.extend({defaults:{image:null,type:null,name:null,mandatory:!1,last:!1,viewed:!1},is_results_page:function(){return void 0!==this.get("results_page")},is_results_url:function(){return!1!==this.is_results_page()&&"url"===this.get("results_page").type}}),ThriveQuizB.models.Structure=ThriveQuizB.models.Base.extend({defaults:{splash:!1,qna:!1,optin:!1,results:!1},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=structure")}}),ThriveQuizB.collections.Options=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Option}),ThriveQuizB.models.ThriveImage=ThriveQuizB.models.Base.extend({defaults:{ID:"",state:"normal"},url:function(){var a=ajaxurl+"?action="+TIE.admin_ajax_controller+"&route=image&_nonce="+TIE.nonce;return parseInt(this.get("ID"))&&(a+="&ID="+this.get("ID")),a},get_bg_style:function(){var a="background-image: ",b=ThriveQuizB.globals.badge_templates.findWhere({key:this.get("settings").template});return this.get("image_url")?a+="url("+this.get("image_url")+")":a+="url("+b.get("thumb")+")",a}}),ThriveQuizB.collections.ThriveImages=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.ThriveImage}),ThriveQuizB.models.QuizStyle=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:{ID:"",quiz_id:"",style:""},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=style")},validate:function(a,b){var c=[];if(a.style||c.push(this.validation_error("style",ThriveQuizB.t.invalid_name)),c.length)return c}}),ThriveQuizB.models.QuizHilightSettings=ThriveQuizB.models.Base.extend({defaults:{highlight_answer:1,load_next_question:0,highlight_and_show_feedback:0},initialize:function(a){a=a||{},"right_wrong"===this.get("quiz_type")&&a.hasOwnProperty("highlight_answer")&&!a.hasOwnProperty("highlight_and_show_feedback")&&1!==a.highlight_answer&&(this.attributes.load_next_question=1,this.attributes.highlight_answer=0)},getKeysToReset:function(){return this.defaults},resetValues:function(){_.each(this.getKeysToReset(),function(a,b){this.attributes[b]=0},this)}}),ThriveQuizB.models.QuizFeedbackSettings=ThriveQuizB.models.QuizHilightSettings.extend({defaults:{display_feedback:1,display_feedback_time:10,press_next:0},initialize:function(a){a=a||{},this.get("quiz_type")&&"right_wrong"!==this.get("quiz_type")&&!a.hasOwnProperty("display_feedback")&&(this.attributes.display_feedback=0)},getKeysToReset:function(){return{display_feedback:0,press_next:1,dont_display_feedback:1}}}),ThriveQuizB.models.QuizType=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:{ID:"",type:"",results:[],minimum_results:2},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=type")},validate:function(a,b){var c=[],d=!1;if(a.display_feedback_time&&(isNaN(a.display_feedback_time)||a.display_feedback_time<=0))return TVE_Dash.err("The value must be a number greater than zero"),c;if(a.type&&a.type===ThriveQuizB.data.quiz_types.personality){if(a.results.length<a.minimum_results)d=!0;else{var e=[];a.results.each(function(a,b){a.get("text")&&e.push(a.get("text"))}),e.length<a.minimum_results&&(d=!0)}if(d)return c.push(ThriveQuizB.t.minimum_results_warning),c}},prepareForSave:function(){this.get("feedback_settings")instanceof Backbone.Model&&this.set({feedback_settings:this.get("feedback_settings").toJSON()},{silent:!0}),this.get("highlight_settings")instanceof Backbone.Model&&this.set({highlight_settings:this.get("highlight_settings").toJSON()},{silent:!0})}}),ThriveQuizB.models.Test=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:function(){return{id:"",item_ids:[],auto_win_min_conversions:100,auto_win_min_duration:14,auto_win_chance_original:95,conversion_goal:null,title:"",notes:"",page_id:null}},validate:function(a){var b=[];if(a.title||b.push(this.validation_error("test_title",ThriveQuizB.t.TestTitleRequired)),!a.conversion_goal&&a.is_results&&(b.push(this.validation_error("conversion_goal",ThriveQuizB.t.ConversionGoalRequired)),TVE_Dash.err(ThriveQuizB.t.ConversionGoalRequired)),a.auto_win_enabled&&(a.auto_win_min_conversions.length<=0?b.push(this.validation_error("auto_win_min_conversions",ThriveQuizB.t.AutoWinMinConversionsRequired)):(isNaN(a.auto_win_min_conversions)||a.auto_win_min_conversions<0||a.auto_win_min_conversions!=parseInt(a.auto_win_min_conversions,10))&&b.push(this.validation_error("auto_win_min_conversions",ThriveQuizB.t.PositiveIntegerNumber)),a.auto_win_min_duration.length<=0?b.push(this.validation_error("auto_win_min_duration",ThriveQuizB.t.AutoWinMinDurationRequired)):(isNaN(a.auto_win_min_duration)||a.auto_win_min_duration<0||a.auto_win_min_duration!=parseInt(a.auto_win_min_duration,10))&&b.push(this.validation_error("auto_win_min_duration",ThriveQuizB.t.PositiveIntegerNumber)),a.auto_win_chance_original.length<=0?b.push(this.validation_error("auto_win_chance_original",ThriveQuizB.t.AutoWinChanceOriginalRequired)):(isNaN(a.auto_win_chance_original)||a.auto_win_chance_original>100||a.auto_win_chance_original<0)&&b.push(this.validation_error("auto_win_chance_original",ThriveQuizB.t.PositivePercentNumber))),a.form_types&&a.form_types.length<2&&b.push(this.validation_error("form_types",ThriveQuizB.t.MinimumTwoFormTypesAreRequired)),b.length)return b},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=test&id="+this.get("id"))}}),ThriveQuizB.collections.Tests=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Test}),ThriveQuizB.models.TestItem=ThriveQuizB.models.Base.extend({defaults:{ID:"",active:1,conversions:0,id:null,impressions:0,is_control:0,is_winner:0,social_shares:0,stopped_date:null,test_id:null,variation_id:null},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=test_item")},getConversionRate:function(){var a=parseInt(this.get("impressions"))?parseInt(this.get("optins_conversions"))/parseInt(this.get("impressions"))*100:0;return a=ThriveQuizB.util.roundNumber(a,3),a=a.toFixed(2)},getPercentageImprovementColor:function(){var a=parseFloat(this.get("percentage_improvement"));return isNaN(a)?"":a<0?ThriveQuizB.data.colors.red:a>0?ThriveQuizB.data.colors.green:""}}),ThriveQuizB.collections.TestItems=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.TestItem,getTotals:function(){return{impressions:this.getTotalImpressions(),conversions:this.getTotalConversions(),conversions_rate:this.getConversionRate()}},getTotalImpressions:function(){var a=0;return _.each(this.models,function(b){a+=parseInt(b.get("impressions"))}),a},getTotalConversions:function(){var a=0;return _.each(this.models,function(b){a+=parseInt(b.get("optins_conversions"))}),a},getConversionRate:function(){var a=0!==this.getTotalImpressions()?this.getTotalConversions()/this.getTotalImpressions()*100:0;return a=a.toFixed(2)},getCandleStickData:function(){var a=[];_.each(this.models,function(b){var c=parseInt(b.get("conversion_rate")),d=parseInt(b.get("impressions"));if(isNaN(c)||isNaN(d)||0===d)a.push([0,0]);else{var e=Math.round(100*Math.sqrt(c*(100-c)/d))/100;a.push([c-e,c+e])}});var b=ThriveQuizB.data.colors.red,c=ThriveQuizB.data.colors.grey,d=ThriveQuizB.data.colors.green,e=a[0],f=[],g=[];return _.each(a,function(a){var h=[],i=[];a[0]<e[0]?(i.push(b),h.push(a[0]),a[1]<e[0]?h.push(a[1]):a[1]<e[1]?(i.push(c),h.push(e[0]),h.push(a[1])):e[1]<a[1]&&(i.push(c),i.push(d),h.push(e[0]),h.push(e[1]),h.push(a[1]))):a[0]<e[1]?(i.push(c),h.push(a[0]),a[1]<=e[1]?h.push(a[1]):e[1]<a[1]&&(i.push(d),h.push(e[1]),h.push(a[1]))):e[1]<a[1]&&(i.push(d),h.push(a[0]),h.push(a[1])),f.push(h),g.push(i)}),{chartData:f,chartColors:g}},getHighestRateItem:function(){var a,b=0;return this.each(function(c){parseFloat(c.getConversionRate())>=b&&(a=c.get("id"),b=parseFloat(c.getConversionRate()))}),0===b?void 0:a}}),ThriveQuizB.models.QuizUserAnswer=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,question:"",answers:{}}}),ThriveQuizB.models.QuizUser=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,random_identifier:null,date_started:null,social_badge_lin:null,email:null,points:null,quiz_id:null,completed_quiz:null}}),ThriveQuizB.models.Reporting=ThriveQuizB.models.Base.extend({defaults:{report_type:"completions",quiz_id:null},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=reporting")}}),ThriveQuizB.models.CompletionQuiz=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,name:"",count:null}}),ThriveQuizB.models.CompletionPagination=ThriveQuizB.models.Base.extend({defaults:{currentPage:null,pageCount:null,totalItems:null,itemsPerPage:null,pagesToDisplay:null}}),ThriveQuizB.collections.CompletionTableModel=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.CompletionQuiz}),ThriveQuizB.models.QuestionsReportItem=ThriveQuizB.models.Base.extend({defaults:{id:null,text:null,total:null,answers:{}}}),ThriveQuizB.collections.QuestionsReportItems=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuestionsReportItem}),ThriveQuizB.models.QuestionsReportAnswer=ThriveQuizB.models.Base.extend({defaults:{count:null,percent:null,text:null}}),ThriveQuizB.collections.QuestionsReportAnswers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuestionsReportAnswer}),ThriveQuizB.collections.QuizUsers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuizUser}),ThriveQuizB.collections.QuizUserAnswers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.QuizUserAnswer,url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=user_answers")}}),ThriveQuizB.collections.QuizStyles=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Base}),ThriveQuizB.collections.Variations=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Variation}),ThriveQuizB.collections.Pages=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Page}),ThriveQuizB.models.UserQuestion=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:"",quiz_id:null,image:"",q_type:null,text:""}}),ThriveQuizB.collections.UserQuestions=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.UserQuestion}),ThriveQuizB.models.UserAnswer=ThriveQuizB.models.Base.extend({defaults:{question_id:"",quiz_id:null,image:"",result_id:null,text:"",chosen:!1},get_thumb_url:function(){var a="";return this.get("image")&&"object"==typeof this.get("image")&&this.get("image").sizes&&this.get("image").sizes.thumbnail&&this.get("image").sizes.thumbnail.url&&(a=this.get("image").sizes.thumbnail.url),"string"==typeof this.get("image")&&(a=this.get("image")),a}}),ThriveQuizB.collections.UserAnswers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.UserAnswer}),ThriveQuizB.models.CompletionReport=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:function(){return{interval:"day",chart_data:[],chart_title:"",chart_x_axis:[],chart_y_axis:""}}}),ThriveQuizB.models.ChartModel=ThriveQuizB.models.Base.extend({idAttribute:"ID",defaults:function(){return{interval:"day",chart_data:[],chart_title:"",chart_x_axis:[],chart_y_axis:""}},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=chartAPI&chart_type=testChart&id="+this.get("ID")+"&interval="+this.get("interval"))}}),ThriveQuizB.models.CompletionChartModel=ThriveQuizB.models.Base.extend({idAttribute:"quiz_id",defaults:function(){return{interval:"day",quiz_id:"",chart_data:[],chart_title:"",chart_x_axis:[],chart_y_axis:""}},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=completionchart&id="+this.get("id")+"&interval="+this.get("interval")+"&date="+this.get("date"))}}),ThriveQuizB.models.UsersList=ThriveQuizB.models.Base.extend({defaults:function(){return{current_page:1,total_items:null,per_page:10,total_pages:null,quiz_id:null}},url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=users_reporting")}}),ThriveQuizB.models.FlowReport=ThriveQuizB.models.Base.extend({defaults:{splash:null,qna:null,optin:null,results:null,quiz_id:null}}),ThriveQuizB.models.FlowReportSection=ThriveQuizB.models.Base.extend({defaults:{type:"splash",data:null}}),ThriveQuizB.collections.BadgeTemplates=ThriveQuizB.collections.Base.extend({}),ThriveQuizB.models.Settings=ThriveQuizB.models.Base.extend({url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=settings")},defaults:{tqb_promotion_badge:1}}),ThriveQuizB.collections.PaginatedCollection=Backbone.Collection.extend({currentPage:1,perPage:10,totalItems:0,initialize:function(a){this.totalItems=a.length},pageInfo:function(){var a=2,b=(this.currentPage-1)*this.perPage,c={offset:b,startItem:b+1,stopItem:b+this.perPage>this.totalItems?this.totalItems:b+this.perPage,currentPage:this.currentPage,totalItems:this.totalItems,perPage:this.perPage,totalPages:Math.ceil(this.totalItems/this.perPage),pages:[],prev:!1,next:!1},d=[1];if(this.currentPage-a>a&&d.push("..."),this.currentPage>a)for(var e=this.currentPage-a;e<this.currentPage;e++)-1===d.indexOf(e)&&d.push(e);this.currentPage>1&&d.push(this.currentPage);for(var f=this.currentPage+1;f<=this.currentPage+a&&f<=c.totalPages;f++)d.push(f);return this.currentPage+a<c.totalPages-1&&d.push("..."),-1===d.indexOf(c.totalPages)&&d.push(c.totalPages),c.pages=d,this.currentPage>1&&(c.prev=!0),this.currentPage<c.totalPages&&(c.next=!0),c},getItems:function(){var a=this.pageInfo();return this.slice(a.offset,a.stopItem)},nextPage:function(){this.currentPage=this.currentPage+1,this.trigger("refresh")},previousPage:function(){this.currentPage=this.currentPage-1,this.trigger("refresh")},goToPage:function(a){a=parseInt(a),isNaN(a)&&(a=1),this.currentPage=a,this.trigger("refresh")}}),ThriveQuizB.models.ResultsSettings=ThriveQuizB.models.Base.extend({defaults:{display_message:!1,forward_results:!1},initialize:function(a){this.init_message(void 0!==a.message?a.message:void 0),this.init_links(void 0!==a.links?a.links:[])},parse:function(a){return a&&a.links&&(this.init_links(a.links),delete a.links),this.init_message(a.message),delete a.message,a},init_message:function(a){if(this.get("message")instanceof ThriveQuizB.models.RedirectMessage)return this.get("message").set(a);this.set("message",new ThriveQuizB.models.RedirectMessage(a))},init_links:function(a){this.set("links",new ThriveQuizB.collections.RedirectLinks(Array.isArray(a)?a:[]))},validate:function(){if(!1===this.get("message").isValid())return this.get("message").validationError},url:function(){var a=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=resultspage");return this.get("ID")&&(a+="&ID="+this.get("ID")),a}}),ThriveQuizB.models.RedirectLink=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{type:"local"},url:function(){var a=ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=redirectlink");return this.get("id")&&(a+="&id="+this.get("id")),a},validate:function(a,b){a=a||{};var c=ThriveQuizB.t.redirect_link.errors,d=parseInt(a.lower_bound),e=parseInt(a.upper_bound);return void 0!==a.quiz_id&&a.quiz_id?void 0!==a.page_id&&a.page_id?"local"!==a.type&&"external"!==a.type?"Something went wrong: link type not set":isNaN(d)?c.invalid_lower_bound:d<b.minimum_result?c.lower_bound_lower_than_minimum_result:d>b.maximum_result?c.lower_bound_greater_than_maximum_result:isNaN(e)?c.invalid_upper_bound:e>b.maximum_result?c.upper_bound_greater_than_maximum_result:e<b.minimum_result?c.upper_bound_lower_than_minimum_result:e<d?c.lower_bound_greater_than_upper_bound:"external"===a.type&&(!a.link||a.link.length<=0)?c.url_not_set:"external"!==a.type||this.isValidURL(a.link)?"local"!==a.type||a.post_id?void 0:c.no_content:c.invalid_url:"Something went wrong: page is not set":"Something went wrong: quiz is not set"},isValidURL:function(a){try{return new URL(a),!0}catch(_){return!1}},isLast:function(){return parseInt(this.collection.last().get("id"))===parseInt(this.get("id"))},isFirst:function(){return parseInt(this.collection.first().get("id"))===parseInt(this.get("id"))},reset_target:function(){this.set({post_id:null,link:null},{silent:!0})},setLowerBound:function(a){a=parseInt(a)||0,this.set("lower_bound",a);var b=this.prev();if(b)return a<=b.get("lower_bound")?(b.set("status","invalid"),b.set("lower_bound",0),void b.setLowerBound(a)):void(a<=b.get("upper_bound")&&(b.setUpperBound(a-1),b.set("status","valid")))},setUpperBound:function(a){a=parseInt(a)||0,this.set("upper_bound",a);var b=this.next();if(b)return a>=b.get("upper_bound")?(b.set("status","invalid"),b.set("lower_bound",0),void b.setUpperBound(a)):void(b.get("lower_bound")<=a&&(b.setLowerBound(a+1),b.set("status","valid")))},prev:function(){var a=this.collection.indexOf(this);return a>0?this.collection.at(a-1):null},next:function(){var a=this.collection.indexOf(this);return a<this.collection.length-1?this.collection.at(a+1):null}}),ThriveQuizB.collections.RedirectLinks=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.RedirectLink,initialize:function(a){return a},comparator:function(a){return a.get("lower_bound")},save:function(){new ThriveQuizB.collections.RedirectLinksWrapper({links:this}).save()},validate:function(a){if(a=a instanceof Backbone.Model?a:new Backbone.Model,this.length<=0)return!1;if(this.where({status:"invalid"}).length>0)return!1;if("personality"!==a.get("quiz_type")){var b=this.findWhere({lower_bound:parseInt(a.get("minimum_result"))}),c=this.findWhere({upper_bound:parseInt(a.get("maximum_result"))});if(!(void 0!==b&&void 0!==c))return!1}return!0}}),ThriveQuizB.collections.RedirectLinksWrapper=Backbone.Model.extend({url:function(){return ThriveQuizB.util.ajaxurl("action=tqb_admin_ajax_controller&route=redirectlink&custom=bulk_save")}}),ThriveQuizB.models.RedirectMessage=ThriveQuizB.models.Base.extend({defaults:{title:ThriveQuizB.t.redirect_message.title,text:ThriveQuizB.t.redirect_message.message,duration:3},validate:function(a){var b=parseInt(a.duration),c=a.title||"",d=a.text||"",e=ThriveQuizB.t.redirect_message.errors;return isNaN(b)?e.invalid_duration:b<1||b>10?e.invalid_duration:c.length<=0?e.invalid_title:d.length<=0?e.invalid_text:void 0}})})}(jQuery);var ThriveQuizB=ThriveQuizB||{};ThriveQuizB.views=ThriveQuizB.views||{},function(a){a(function(){Backbone.View.prototype.tvd_clear_errors=function(){return this.$(".tvd-invalid").removeClass("tvd-invalid"),this.$("select").trigger("tvdclear"),this},a(document).keypress(function(a){13!=a.which&&13!=a.keyCode||jQuery("a").is(":focus")||jQuery(".tqb-detele-structure-card-modal").is(":visible")&&jQuery(".tqb-detele-structure-card-action").focus().click()}),Backbone.View.prototype.tvd_show_errors=function(b){function c(b){if("string"==typeof b)return TVE_Dash.err(b);f=f.add(e.$("[data-field="+b.field+"]").addClass("tvd-invalid").each(function(){var c=a(this);c.is("select")?c.trigger("tvderror",b.message):c.next("label").attr("data-error",b.message)}))}if(b=b||this.model){var d=b instanceof Backbone.Model?b.validationError:b,e=this,f=a();return Array.isArray(d)?_.each(d,function(a){c(a)}):c(d),f.not(".tvd-no-focus").first().focus(),this.scroll_first_error(f.first()),this}},Backbone.View.prototype.scroll_first_error=function(a){if(!(this instanceof TVE_Dash.views.Modal&&a.length))return this;var b=a.offset().top,c=this.$_content.offset().top,d=this.$_content.scrollTop(),e=this.$_content.outerHeight();if(b>=c&&b<e+c-50)return this;this.$_content.animate({scrollTop:d+b-c-40},200,"swing")},ThriveQuizB.views.Base=Backbone.View.extend({render:function(){return this},modal:function(a,b){return TVE_Dash.modal(a,b)},bind_zclip:function(){TVE_Dash.bindZClip(this.$el.find("a.tvd-copy-to-clipboard"))}}),ThriveQuizB.views.Dashboard=ThriveQuizB.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("dashboard"),events:{"click .tqb-add-quiz-dashboard":"addNew","click .tqb-import-quiz":"import"},addNew:function(){return this.modal(ThriveQuizB.views.ModalNewQuiz,{model:new ThriveQuizB.models.Quiz({}),collection:this.collection,className:"tvd-modal tvd-qt-modal",width:"90%","max-width":"700px",in_duration:200,out_duration:0,templates:new Backbone.Collection(ThriveQuizB.quiz_templates)}),this},render:function(){this.$el.html(this.template({}));var a=new ThriveQuizB.views.QuizList({el:this.$("#tqb-quiz-list"),collection:this.collection}),b=new ThriveQuizB.views.Pagination({el:this.$(".tqb-load-more-section"),collection:this.collection,$quiz_list:this.$("#tqb-quiz-list")});return ThriveQuizB.quizzes_details.quizzes_number<ThriveQuizB.quizzes_details.max_quiz_number&&(ThriveQuizB.quizzes_details.quizzes_number=ThriveQuizB.quizzes_details.quizzes_displayed),a.render(),b.render(),this.search(),TVE_Dash.hideLoader(),this},search:function(){var a=this.$(".tqb-search-quiz"),b=new Backbone.Model({placeholder:ThriveQuizB.t.search_quizzes,label:ThriveQuizB.t.quiz_name,required:!1}),c=new ThriveQuizB.views.TextSearch({model:b,collection:this.collection,tagName:"div",dashboard_el:this.$el});a.prepend(c.render().$el),c.focus()},import:function(){this.modal(ThriveQuizB.views.ModalImportQuiz,{})}}),ThriveQuizB.views.Pagination=ThriveQuizB.views.Base.extend({className:"tqb-load-more-section",events:{"click .tqb-load-all":"loadAll","click .tqb-load-more":"loadMore"},initialize:function(a){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.$quiz_list=a.$quiz_list},render:function(){TVE_Dash.showLoader();var a=ThriveQuizB.quizzes_details.quizzes_displayed,b=ThriveQuizB.quizzes_details.quizzes_number,c=ThriveQuizB.quizzes_details.max_quiz_number,d=b-a,e=this.$el.find(".tqb-remaining-quizzes");b&&b!==a?(e.text(d+" "+ThriveQuizB.t.more_quizzes),c<=d&&(d=c),ThriveQuizB.quizzes_details.to_be_loaded=d,this.$el.find(".tqb-load-more").text(ThriveQuizB.t.load_more.replace("%d",d))):this.$el.addClass("tvd-hide"),TVE_Dash.hideLoader()},loadAll:function(){TVE_Dash.showLoader();var b=this;return a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:ThriveQuizB.quizzes_details.quizzes_displayed,end:ThriveQuizB.quizzes_details.quizzes_number,_nonce:ThriveQuizB.admin_nonce}}).done(function(a){for(var c in a){var d=a[c].ID,e=new ThriveQuizB.models.Quiz;ThriveQuizB.shown_quizzes.visible[d]=!0,a[c].tqb_quiz_source="add",e.set(a[c]),b.collection.add(e)}ThriveQuizB.quizzes_details.quizzes_displayed=ThriveQuizB.quizzes_details.quizzes_number,b.render(),TVE_Dash.hideLoader()}),this},loadMore:function(){TVE_Dash.showLoader();var b=this,c=ThriveQuizB.quizzes_details.quizzes_displayed,d=c+ThriveQuizB.quizzes_details.to_be_loaded;return a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:c,end:d,_nonce:ThriveQuizB.admin_nonce}}).done(function(a){for(var c in a){var d=a[c].ID,e=new ThriveQuizB.models.Quiz;ThriveQuizB.shown_quizzes.visible[d]=!0,a[c].tqb_quiz_source="add",e.set(a[c]),b.collection.add(e)}ThriveQuizB.quizzes_details.quizzes_displayed+=ThriveQuizB.quizzes_details.to_be_loaded,b.render(),TVE_Dash.hideLoader()}),this}}),ThriveQuizB.views.QuizList=ThriveQuizB.views.Base.extend({events:{"click .tqb-add-quiz":"addNew"},itemViews:[],initialize:function(){this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"add",function(a){if(!_.isEmpty(a.get("tqb_quiz_source")))switch(a.get("tqb_quiz_source")){case"clone":this.renderClone(a);break;case"add":this.renderOne(a),this.updateOrder()}})},render:function(){function b(b,c){var d=a(c.placeholder),e=d.prevAll().not(c.item).length+1;d.html("<div class='tqb-inside-placeholder'><span>"+e+(ThriveQuizB.t.n_suffix[e]?ThriveQuizB.t.n_suffix[e]:ThriveQuizB.t.n_th)+" "+ThriveQuizB.t.priority+"</span></div>")}this.$el.find(".tqb-quiz-item").remove(),this.itemViews=[],this.collection.each(this.renderOne,this);var c=this;return this.$el.sortable({placeholder:"ui-sortable-placeholder",items:".tqb-quiz-item",forcePlaceholderSize:!0,handle:".tqb-drag-card",update:_.bind(c.updateOrder,this),tolerance:"pointer",change:b,start:function(c,d){b(c,d),a("body").addClass("tqb-sorting")},stop:function(){setTimeout(function(){a("body").removeClass("tqb-sorting")},200)}}),this},updateOrder:function(){var b={};_.each(this.itemViews,function(a){a.model.get("order")!=a.$el.index()&&(a.model.set("order",a.$el.index()),b[a.model.get("ID")]=a.$el.index())}),this.collection.sort(),a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quiz",custom:"update_order",new_order:b,_nonce:ThriveQuizB.admin_nonce}})},renderOne:function(a){
var b=this.$el.find(".tqb-quiz-item").last(),c=new ThriveQuizB.views.Quiz({model:a,collection:this.collection});return!!ThriveQuizB.shown_quizzes.visible[a.get("ID")]&&(b.length?b.after(c.render().$el):this.$el.prepend(c.render().$el),this.itemViews.push(c),this)},addNew:function(){return this.modal(ThriveQuizB.views.ModalNewQuiz,{model:new ThriveQuizB.models.Quiz({}),collection:this.collection,className:"tvd-modal tvd-qt-modal",width:"90%","max-width":"700px",in_duration:200,out_duration:0,templates:new Backbone.Collection(ThriveQuizB.quiz_templates)}),this},renderClone:function(a){var b=new ThriveQuizB.views.Quiz({model:a,collection:this.collection});if(this.$el.prepend(b.render().$el),this.itemViews.push(b),ThriveQuizB.quizzes_details.quizzes_displayed!==ThriveQuizB.quizzes_details.quizzes_number&&this.$el.find(".tqb-quiz-item").length%ThriveQuizB.quizzes_details.max_quiz_number==1){var c=this.$el.find(".tqb-quiz-item").last(),d=c.find(".tqb-copy-shortcode").attr("data-id");c.remove(),this.collection.remove(this.collection.get(parseInt(d)),{silent:!0}),this.itemViews=this.itemViews.filter(function(a){return a.model.get("ID")!==parseInt(d)})}return this.updateOrder(),this}}),ThriveQuizB.views.Quiz=ThriveQuizB.views.Base.extend({initialize:function(){this.listenTo(this.model,"change:state",this.renderState)},render:function(){return this.renderState(),this},renderState:function(){var a=this.model.get("state");if(ThriveQuizB.views["Quiz"+TVE_Dash.upperFirst(a)+"State"]){var b=new(ThriveQuizB.views["Quiz"+TVE_Dash.upperFirst(a)+"State"])({model:this.model,collection:this.collection});b.render(),this.$el.replaceWith(b.$el),this.setElement(b.$el)}}}),ThriveQuizB.views.QuizNormalState=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s6 tvd-ms6 tvd-m4 tvd-l3 tqb-quiz-item",template:TVE_Dash.tpl("quiz/item"),events:{"click .tqb-delete-quiz":"setDeleteState","click .tqb-edit-quiz-title":"editTitle","click .tqb-copy-shortcode":"copyShortcodeModal","click .tqb-clone-quiz":"cloneQuiz"},render:function(){return this.$el.html(this.template({item:this.model})),this.$quizTitle=this.$(".tvd-card-title"),this},setDeleteState:function(){this.$el.live_tooltip("destroy");var a=this.collection.findWhere({state:"delete"});a&&a.set("state",ThriveQuizB.util.states.normal),this.model.set("state",ThriveQuizB.util.states.delete)},editTitle:function(){var a=this,b=this.$(".tqb-edit-quiz-title"),c=new Backbone.Model({value:this.model.get("post_title"),label:ThriveQuizB.t.quiz_name,required:!0});b.hide();var d=new ThriveQuizB.views.TextEdit({model:c,tagName:"div"});this.$quizTitle.hide().after(d.render().$el),c.on("change:value",function(){a.saveTitle.apply(a,arguments),d.remove(),a.$quizTitle.show(),b.show()}),c.on("tqb_no_change",function(){a.$quizTitle.html(a.model.get("post_title")).show(),d.remove(),b.show()}),d.focus()},saveTitle:function(a,b){var c=this;this.model.set("post_title",b),this.model.save(null,{success:function(){c.$quizTitle.html(b),TVE_Dash.success(ThriveQuizB.t.quiz_title_save_success_toast)},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_title_save_fail_toast)}})},copyShortcodeModal:function(){var a=this;this.modal(ThriveQuizB.views.ModalCopyShortcode,{item:a.model,width:"800px"})},cloneQuiz:function(){TVE_Dash.showLoader();var b=this.model,c=b.clone(),d=this,e={};a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quiz",custom:"clone_current",quiz_id:b.get("ID"),_nonce:ThriveQuizB.admin_nonce}}).done(function(a){if(_.isNumber(a)){var f=ThriveQuizB.shown_quizzes.order[ThriveQuizB.quizzes_details.quizzes_displayed-1];e={completed_count:0,comment_count:0,social_shares:0,subscribers:0,users_started:0,post_title:"["+ThriveQuizB.t.copy+"] "+b.get("post_title"),order:0,menu_order:0,ID:a,tqb_quiz_source:"clone"},c.set(e),ThriveQuizB.quizzes_details.quizzes_number===ThriveQuizB.quizzes_details.quizzes_displayed||ThriveQuizB.quizzes_details.quizzes_displayed<ThriveQuizB.quizzes_details.quizzes_displayed.max_quiz_number?ThriveQuizB.quizzes_details.quizzes_displayed+=1:ThriveQuizB.shown_quizzes.visible[f]=!1,ThriveQuizB.quizzes_details.quizzes_number+=1,d.collection.unshift(c),ThriveQuizB.shown_quizzes.visible[a]=!0,TVE_Dash.success(ThriveQuizB.t.clone_quiz_success)}else TVE_Dash.err(ThriveQuizB.t.clone_quiz_error)}).fail(function(){TVE_Dash.err(ThriveQuizB.t.clone_quiz_error)}).always(function(){TVE_Dash.hideLoader()})},chart:function(a){var b=!0,c=this.$(".tqb-chart-no-data").clone();(!a||a.impressions.length<2)&&(b=!1,a=this.model.get_chart_dummy_data());var d=[{title:{text:ThriveQuizB.t.no_of_impressions}}],e=[{name:ThriveQuizB.t.impressions,type:"line",data:a.impressions}];a.conversions&&(d.push({labels:{format:"{value}"},title:{text:ThriveQuizB.t.no_of_conversions},opposite:!0}),e.push({name:ThriveQuizB.t.conversions,type:"line",yAxis:1,data:a.conversions,tooltip:{valueSuffix:""}})),setTimeout(_.bind(function(){this.$(".tqb-quiz-chart").highcharts({colors:b?["#3498db","#47bb28"]:["#fff","#fff"],credits:{enabled:!1},plotOptions:{line:{marker:{enabled:!1}}},title:{text:" "},xAxis:{categories:a.labels,labels:{enabled:!1}},yAxis:d,tooltip:{shared:!0},legend:{enabled:!1},series:e}),b||this.$(".tqb-quiz-chart").addClass("tvd-relative tqb-blurred").append(c.removeClass("tvd-hide"))},this))}}),ThriveQuizB.views.QuizDeleteState=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s6 tvd-m4 tvd-ms6 tvd-l3 tqb-quiz-item",template:TVE_Dash.tpl("quiz/delete-state"),events:{"click .tqb-delete-no":function(){this.model.set("state",ThriveQuizB.util.states.normal)},"click .tqb-delete-yes":"yes",keydown:"keyAction"},initialize:function(){this.listenTo(this.collection,"remove",this.remove)},render:function(){this.$el.html(this.template({item:this.model}));var a=this;return _.defer(function(){a.$(".tve-delete-quiz-card").focus()}),this},keyAction:function(a){var b=a.which;13==b?this.yes():27==b&&this.model.set("state",ThriveQuizB.util.states.normal)},yes:function(){var b=this,c=this.model.get("ID");TVE_Dash.cardLoader(this.$el),this.model.destroy({wait:!0,success:function(){TVE_Dash.success(ThriveQuizB.t.quiz_deleted_success_toast),ThriveQuizB.util.showHideNoQuizInfo(),ThriveQuizB.quizzes_details.quizzes_number-=1,delete ThriveQuizB.shown_quizzes.visible[c],ThriveQuizB.quizzes_details.quizzes_number+1<=ThriveQuizB.quizzes_details.quizzes_displayed?ThriveQuizB.quizzes_details.quizzes_displayed-=1:a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:ThriveQuizB.quizzes_details.quizzes_displayed-1,end:ThriveQuizB.quizzes_details.quizzes_displayed-1,_nonce:ThriveQuizB.admin_nonce}}).done(function(a){var c=a[0].ID,d=new ThriveQuizB.models.Quiz;ThriveQuizB.shown_quizzes.visible[c]=!0,a[0].tqb_quiz_source="add",d.set(a[0]),b.collection.add(d)}),ThriveQuizB.globals.quizzes.length<ThriveQuizB.quizzes_details.max_quiz_number&&a("#tqb-no-search-result, .tqb-load-more-section").hide()},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_deleted_fail_toast)}})}}),ThriveQuizB.views.EditQuiz=ThriveQuizB.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("quiz/edit"),events:{"click .tqb-edit-quiz-title":"editTitle","click .tqb-quiz-action":"handleAction","click #tqb-export-quiz-button":"onExportClicked"},initialize:function(){this.model.on("tqb_style_changed",_.bind(function(){this.model.get("type")&&this.check_structure(),this.render()},this)),this.listenTo(this.model,"change:type",function(a){this.model.get("style")&&this.check_structure(),this.render()},this),this.listenTo(this.model.get("thrive_images"),"add",this.render_badge_card)},render:function(){this.$el.html(this.template({item:this.model})),this.$quizTitle=this.$(".tqb-quiz-title"),this.model.get("style")&&this.model.get("type")&&this.renderStructure(),this.render_type_card(),this.render_style_card(),this.render_badge_card(),this.model.hasQuestions()&&(this.$(".tqb-export-quiz").removeClass("tqb-disabled"),this.$(".tqb-export-container").removeClass("tvd-tooltipped"));var b=this;return this.model.get("wizard_complete")||this.model.get("type")&&this.model.get("style")&&this.model.get("structure").viewed&&this.model.get("structure").viewed.results&&this.model.get("structure").tge_question_number>0&&a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quiz",custom:"wizard_complete",ID:this.model.get("ID"),_nonce:ThriveQuizB.admin_nonce},success:function(a){a&&(b.model.set("wizard_complete",1),TVE_Dash.success(ThriveQuizB.t.wizard_complete))}}),this.bind_zclip(),TVE_Dash.materialize(this.$el),this},check_structure:function(){this.model.get("structure").length||this.renderStructure(!0)},render_type_card:function(){this.$(".tqb-quiz-action").text(this.model.structure_set()?ThriveQuizB.t.quiz_settings:ThriveQuizB.t.change_type);var a=this.model.getQuizTypeText(this.model.get("type")),b=ThriveQuizB.data.quiz_types.survey===this.model.get("type")&&this.model.structure_set();this.$el.find(".tqb-quiz-type").text(a.label),this.$el.find(".tqb-quiz-card-summary").text(a.text),this.$el.find(".tqb-logo-holder i").attr("id",this.model.get("type")),this.$(".tqb-quiz-action, .tqb-quiz-description").toggleClass("tqb-hide",b)},render_style_card:function(){var a=new ThriveQuizB.views.QuizStyle({model:this.model,collection:new ThriveQuizB.collections.QuizStyles(ThriveQuizB.quiz_styles)});this.$("#tqb-quiz-style-card").html(a.render().$el)},render_badge_card:function(){var a=this.$("#tqb-badge-card");new ThriveQuizB.views.Badge({el:a,model:this.model.get("thrive_images").first(),collection:this.model.get("thrive_images"),quiz_type:this.model.get("type")}).render()},renderStructure:function(a){var b=this;if(this.model.get("style")){var c=this.model.get("structure"),d=null;if(c.quiz_type=this.model.get("type"),c.style=parseInt(this.model.get("style")),this.structure_view&&this.structure_view.remove(),void 0!==c.ID)d=new ThriveQuizB.models.Structure(c),this.structure_view=new ThriveQuizB.views.QuizStructure({model:d}),this.$el.find("#tqb-quiz-structure-row").append(this.structure_view.render().$el),setTimeout(function(){ThriveQuizB.util.bind_wistia()},0);else{var c;ThriveQuizB.quiz_templates.forEach(function(a,d){a.id===b.model.get("tpl")&&(c=a)}),"survey"===this.model.get("type")&&(c.splash=!0),c.ID=b.model.get("ID"),d=new ThriveQuizB.models.Structure(c),a&&d.save(null,{success:function(a,c){a.attributes.quiz_type=b.model.get("type"),b.structure_view=new ThriveQuizB.views.QuizStructure({model:a}),b.$el.find("#tqb-quiz-structure-row").append(b.structure_view.render().$el),b.model.set("structure",c),TVE_Dash.materialize(b.$el),setTimeout(function(){ThriveQuizB.util.bind_wistia()},0)},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_structure_save_fail_toast)}})}}},editTitle:function(){var a=this,b=this.$el.find(".tqb-edit-quiz-title"),c=new Backbone.Model({value:this.model.get("post_title"),label:ThriveQuizB.t.quiz_name,required:!0});b.hide(),c.on("change:value",function(){a.saveTitle.apply(a,arguments),a.$quizTitle.show(),d.remove(),b.show()}),c.on("tqb_no_change",function(){a.$quizTitle.html(a.model.get("post_title")).show(),d.remove(),b.show()});var d=new ThriveQuizB.views.TextEdit({model:c,tagName:"div"});this.$quizTitle.hide().after(d.render().$el),d.focus()},handleAction:function(){this.model.structure_set()?this.openSettingsModal(this._getModalModel()):this.modal(ThriveQuizB.views.ModalEditQuizType,this._getModalArgs())},_getModalModel:function(){return new ThriveQuizB.models.QuizType({ID:this.model.get("ID"),type:this.model.get("type"),results:this.model.get("results"),feedback_settings:new ThriveQuizB.models.QuizFeedbackSettings(_.extend(this.model.get("feedback_settings"),{quiz_type:this.model.get("type")})),highlight_settings:new ThriveQuizB.models.QuizHilightSettings(_.extend(this.model.get("highlight_settings"),{quiz_type:this.model.get("type")}))})},_getModalArgs:function(){var a,b=0;if(this.model.structure_set())switch(a=!0,this.model.get("type")){case ThriveQuizB.data.quiz_types.personality:b=1;break;case ThriveQuizB.data.quiz_types.right_wrong:b=2}return{model:this._getModalModel(),quiz_model:this.model,types:new Backbone.Collection(ThriveQuizB.quiz_types),width:"90%","max-width":"980px",modal_step:b,edit_mode:a}},openSettingsModal:function(a){a=a instanceof ThriveQuizB.models.QuizType?a:new ThriveQuizB.models.QuizType,this.modal(ThriveQuizB.views.QuizSettings,{model:a,quiz_model:this.model,width:"800px","max-width":"60%"})},saveTitle:function(a,b){var c=this;this.model.set({post_title:b}),this.model.save(null,{success:function(a,d){c.$quizTitle.html(b);try{var e=ThriveQuizB.globals.quizzes.findWhere({ID:c.model.get("ID")});e instanceof ThriveQuizB.models.Quiz&&e.set("post_title",b)}catch(f){console.log("Error: "+f)}TVE_Dash.success(ThriveQuizB.t.quiz_title_save_success_toast)},error:function(a,b){TVE_Dash.err(ThriveQuizB.t.quiz_title_save_fail_toast)}})},onExportClicked:function(){this.modal(ThriveQuizB.views.ModalExportQuiz,{title:ThriveQuizB.t.export_quiz+" "+this.model.get("post_title"),"max-width":"50%",dismissible:!1,model:this.model})}}),ThriveQuizB.views.TextEdit=ThriveQuizB.views.Base.extend({className:"tvd-input-field tqb-inline-edit",template:TVE_Dash.tpl("textedit"),events:{"keyup input":"keyup","change input":function(){return a.trim(this.input.val())?(this.model.set("value",this.input.val()),!1):(this.input.addClass("tvd-invalid"),!1)},"blur input":function(){this.model.trigger("tqb_no_change")}},keyup:function(a){27===a.which&&this.model.trigger("tqb_no_change")},render:function(){return this.$el.html(this.template({item:this.model})),this.input=this.$("input"),this},focus:function(){this.input.focus().select()}}),ThriveQuizB.views.TextSearch=ThriveQuizB.views.TextEdit.extend({show_pagination:!1,className:"tvd-input-field tqb-inline-search",template:TVE_Dash.tpl("search"),events:{"keyup input":"keyup","click svg":function(){this.input.val()&&this.request_search()}},initialize:function(a){this.dashboard_el=a.dashboard_el,this.listenTo(this.collection,"reset",_.bind(function(a){this.dashboard_el.find(".tqb-load-more-section").toggleClass("tvd-hide",!this.show_pagination),this.dashboard_el.find("#tqb-quiz-list .tvd-card-new").toggleClass("tvd-hide",!this.show_pagination),a.length?this.dashboard_el.find("#tqb-no-search-result").hide():this.dashboard_el.find("#tqb-no-search-result").show(),TVE_Dash.hideLoader()},this))},keyup:_.debounce(function(a){_.isEmpty(this.input.val())&&8===a.keyCode?this.restore_quizzes():_.isEmpty(this.input.val())||!/[a-zA-Z0-9!@#$&()\[\]\\-`.+,\/\"]/i.test(a.key)&&8!==a.keyCode&&13!==a.keyCode||this.request_search()},1e3),request_search:function(){var b=this;TVE_Dash.showLoader(),a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",search_title:this.input.val(),_nonce:ThriveQuizB.admin_nonce}}).done(function(a){for(var c in a){var d=a[c].ID;ThriveQuizB.shown_quizzes.visible[d]=!0,a[c].tqb_quiz_source="search"}b.show_pagination=!1,b.collection.reset(a)}).always(function(){TVE_Dash.hideLoader()})},restore_quizzes:function(){TVE_Dash.showLoader();var b=this;a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"quizzes",start:0,end:ThriveQuizB.quizzes_details.max_quiz_number,_nonce:ThriveQuizB.admin_nonce}}).done(function(a){for(var c in a){var d=a[c].ID;ThriveQuizB.shown_quizzes.visible[d]=!0,a[c].tqb_quiz_source="search"}b.show_pagination=ThriveQuizB.quizzes_details.quizzes_number>ThriveQuizB.quizzes_details.max_quiz_number,b.collection.reset(a)}).always(function(){TVE_Dash.hideLoader()})}}),ThriveQuizB.views.Breadcrumbs=ThriveQuizB.views.Base.extend({el:a("#tqb-breadcrumbs-wrapper")[0],template:TVE_Dash.tpl("breadcrumbs"),initialize:function(){this.$title=a("head > title"),this.original_title=this.$title.html(),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render)},render:function(){this.$el.empty().html(this.template({links:this.collection}))}}),ThriveQuizB.views.Badge=ThriveQuizB.views.Base.extend({initialize:function(a){this.quiz_type=a.quiz_type,this.listenTo(this.model,"change:state",this.render_state)},render:function(){this.render_state()},render_state:function(){var a;a=this.model&&this.model.get("settings").template?this.model.get("state"):"survey"===this.quiz_type?"unavailable":"add";var b="Badge"+TVE_Dash.upperFirst(a)+"State";if(ThriveQuizB.views[b]){var c=new ThriveQuizB.views[b]({model:this.model,collection:this.collection});c.render(),this.$el.replaceWith(c.$el),this.setElement(c.$el)}}}),ThriveQuizB.views.BadgeNormalState=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("badge/card"),className:"tvd-col tvd-s12 tvd-m4 tvd-l4",id:"tqb-badge-card",events:{"click #tqb-remove-badge":"remove"},render:function(){return this.$el.html(this.template({item:this.model})),this},remove:function(){this.model.set("state","delete")}}),ThriveQuizB.views.BadgeAddState=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("badge/add"),className:"tvd-col tvd-s12 tvd-m4 tvd-l4 tvd-pointer",id:"tqb-badge-card",events:{"click #tqb-add-badge":"add_badge"},initialize:function(a){this.quiz_type=a.quiz_type},render:function(){return this.$el.html(this.template({item:this.model})),this},add_badge:function(){this.model||this.modal(ThriveQuizB.views.ModalBadgeTemplates,{collection:this.collection,"max-width":"80%"})}}),ThriveQuizB.views.BadgeUnavailableState=ThriveQuizB.views.BadgeAddState.extend({render:function(){return this.$el.html(this.template({item:this.model})),this.$(".tqb-new-button").removeAttr("data-tooltip").removeClass("tvd-tooltipped"),this.$(".tvd-card-content").addClass("tqb-disabled"),this.$el.append('<div class="tqb-no-badge"><b class="tqb-title">'+ThriveQuizB.t.unavailableBadgeTitle+'</b><p class="tqb-info">'+ThriveQuizB.t.unavailableBadge+"</p></div>"),this}}),ThriveQuizB.views.BadgeDeleteState=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s12 tvd-m4 tvd-l4",template:TVE_Dash.tpl("badge/delete"),id:"tqb-badge-card",events:{"click .tqb-delete-no":function(){this.model.set("state",ThriveQuizB.util.states.normal)},"click .tqb-delete-yes":"yes",keydown:"keyAction"},render:function(){return this.$el.html(this.template({item:this.model})),this},keyAction:function(a){var b=a.which;13==b?this.yes():27==b&&this.model.set("state",ThriveQuizB.util.states.normal)},yes:function(){var a=this;TVE_Dash.cardLoader(this.$el);var b=new ThriveQuizB.models.ThriveImage({post_parent:ThriveQuizB.globals.quiz.get("ID")});this.model.destroy({wait:!0,success:function(){b.save(null,{success:function(b,c,d){a.collection.push(b),TVE_Dash.success(ThriveQuizB.t.badge_deleted_success)}})}})}}),ThriveQuizB.views.QuizStyle=ThriveQuizB.views.Base.extend({className:"tvd-card",events:{click:"editQuizStyle"},render:function(){return 0===this.model.get("style").length?this.render_new_button():this.render_card_content(),this.model.on("change:structure",this.render_card_content,this),TVE_Dash.materialize(this.$el),this},render_card_content:function(){var a=TVE_Dash.tpl("quiz/style/card");this.$el.html(a({model:this.collection.findWhere({id:this.model.get("style")}),qna_editor_url:this.model.get("structure").qna_editor_url})),this.$el.addClass("tvd-white")},render_new_button:function(){var a=TVE_Dash.tpl("quiz/style/new-button"),b=ThriveQuizB.t.choose_quiz_style;this.$el.html(a({item:new Backbone.Model({label:b}),model:this.model})),this.$el.addClass("tvd-medium-xxsmall tvd-card-new tvd-valign-wrapper tvd-relative tqb-new-button")},editQuizStyle:function(b){a(b.target).is(".tqb-edit-design")||this.modal(ThriveQuizB.views.ModalEditQuizStyle,{collection:this.collection,model:this.model,styles:[],width:"800px","max-width":"60%"})}}),ThriveQuizB.views.QuizStyleItem=ThriveQuizB.views.Base.extend({className:"tvd-row tvd-no-margin-bottom tvd-collapse tvd-pointer tqb-quiz-style-item",template:TVE_Dash.tpl("quiz/style/item"),render:function(a){return this.$el.html(this.template({item:this.model,selected:!0===a})),this.$el.attr("data-style",this.model.get("id")),this.model.get("tqb_splash")&&this.render_page(new Backbone.Model(this.model.get("tqb_splash"))),this.model.get("tqb_qna")&&this.render_page(new Backbone.Model(this.model.get("tqb_qna"))),this.model.get("tqb_optin")&&this.render_page(new Backbone.Model(this.model.get("tqb_optin"))),this.model.get("tqb_results")&&this.render_page(new Backbone.Model(this.model.get("tqb_results"))),TVE_Dash.materialize(this.$el),this},render_page:function(a){new ThriveQuizB.views.StyleItemCard({el:this.$(".tbq-style-pages"),model:a}).render()}}),ThriveQuizB.views.QuizPageVariations=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("variations/dashboard"),events:{"click .tqb-add-new-form":"addNewForm","click .tqb-toggle-display":"toggleDisplay","click .tqb-start-variation-test":"startVariationTestPopup"},initialize:function(a){this.completed_tests=a.completed_tests,this.model.on("tqb_variation_removed",_.bind(function(){this.render()},this)),this.model.on("tqb_variation_added",_.bind(function(){this.render()},this)),this.model.on("tqb_completed_test_removed",_.bind(function(){this.render()},this)),this.model.on("adjust_completed_tests_counter",_.bind(function(){this.$el.find("#tqb-completed-tests-count").html("("+this.completed_tests.length+")")},this))},render:function(){return this.$el.html(this.template({model:this.model})),this.toggleLogic(),this.renderVariationList(),this.renderCompletedtests(),this.renderArchivedVariationList(),_.contains([ThriveQuizB.data.quiz_structure_item_types.optin.key,ThriveQuizB.data.quiz_structure_item_types.results.key],this.model.get("post_type"))&&this.renderGdprUserConsent(),TVE_Dash.materialize(this.$el),this},renderCompletedtests:function(){if(this.completed_tests.length){new ThriveQuizB.views.CompletedTestItemList({model:this.model,collection:this.completed_tests,el:this.$el.find("#tqb-completed-test-list")}).render(),this.$el.find("#tqb-completed-tests-count").html("("+this.completed_tests.length+")"),this.$el.find("#tqb-completed-tests").show()}},renderVariationList:function(){this.variation_list&&this.variation_list.remove(),this.variation_list=new ThriveQuizB.views.VariationList({el:this.$("#tqb-page-variations-list"),collection:this.model.get("variations"),model:this.model}),this.$el.find("#tqb-page-variations-list").append(this.variation_list.render().$el)},renderArchivedVariationList:function(){this.model.get("archived_variations").length<=0||(this.archived_variation_list&&this.archived_variation_list.remove(),this.archived_variation_list=new ThriveQuizB.views.VariationList({el:this.$("#tqb-archived-page-variations-list"),collection:this.model.get("archived_variations"),model:this.model}),this.$el.find("#tqb-archived-page-variations-list").append(this.archived_variation_list.render().$el))},renderGdprUserConsent:function(){this.gdpr_user_consent&&this.gdpr_user_consent.remove(),this.gdpr_user_consent=new ThriveQuizB.views.VariationUserConsentGDPR({el:this.$("#tqb-page-gdpr-user-consent"),model:this.model}),this.$el.find("#tqb-page-gdpr-user-consent").append(this.gdpr_user_consent.render().$el)},toggleDisplay:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");jQuery(b.data("target"))[c?"slideDown":"slideUp"](200),b.toggleClass("collapsed"),b.toggleClass("hover")},toggleLogic:function(){this.$el.find("#tqb-archived-forms")[this.model.get("archived_variations").length?"show":"hide"]()},addNewForm:function(){this.modal(ThriveQuizB.views.ModalAddVariation,{collection:this.model.get("variations"),model:new ThriveQuizB.models.Variation({name:this.model.get("post_title"),page_id:this.model.get("ID"),quiz_id:this.model.get("post_parent")}),width:"800px","max-width":"60%"})},startVariationTestPopup:function(a){var b=this;TVE_Dash.showLoader(),this.model.checkVariationsContent({success:function(a){if(b.$el.find(".tvd-collection-item").removeClass("tve-form-no-content"),a.length>0)a.forEach(function(a,c){b.$el.find("[data-id='"+a+"']").addClass("tve-form-no-content")}),TVE_Dash.err(ThriveQuizB.t.MissingFormContent);else{var c=[];b.model.get("variations").each(function(a){c.push(a.get("id"))});var d=new ThriveQuizB.models.Test({item_ids:c,page_id:b.model.get("ID"),is_results:b.model.get("post_type")==ThriveQuizB.data.quiz_structure_item_types.results.key});b.modal(ThriveQuizB.views.ModalVariationTest,{model:d,width:"800px","max-width":"60%"})}},error:function(){},complete:function(){TVE_Dash.hideLoader()}},{quiz_id:this.model.get("post_parent")})}}),ThriveQuizB.views.QuizPageTest=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/view"),events:{"click .tqb-toggle-display":"toggleDisplay"},initialize:function(a){this.completed_tests=a.completed_tests;var b=0;this.model.get("test_items").forEach(function(a){a.color=ThriveQuizB.chart_colors[b%ThriveQuizB.chart_colors.length],b++}),this.model.get("stopped_items").forEach(function(a){a.color=ThriveQuizB.chart_colors[b%ThriveQuizB.chart_colors.length]}),this.model.set("test_items",new ThriveQuizB.collections.TestItems(this.model.get("test_items"))),this.model.set("stopped_items",new ThriveQuizB.collections.TestItems(this.model.get("stopped_items")))},render:function(){return this.$el.html(this.template({test:this.model})),this.model.get("test_items").each(this.renderOne,this),this.renderTotal(),this.renderStoppedItems(),this.renderChart(),this.renderCompletedtests(),this.model.get("status")&&this.renderOptions(),this.displayNoDataOverlay(this.model.get("test_items")),TVE_Dash.materialize(this.$el),this},renderStoppedItems:function(){if(this.model.get("stopped_items").length){new ThriveQuizB.views.TestStoppedItemList({model:this.model,collection:this.model.get("stopped_items"),el:this.$el.find("#tqb-form-test-stopped-items")}).render()}},renderChart:function(){var a=new ThriveQuizB.models.ChartModel({ID:this.model.get("id"),start_date:this.model.get("date_started"),interval:"day"}),b=new ThriveQuizB.views.ChartView({model:a,el:this.$el.find(".tve-chart-interval")});b.drawCandleStick(this.model.get("test_items"),"tve-candle-stick-chart"),this.model.get("stopped_items")&&b.drawCandleStick(this.model.get("stopped_items"),"tve-candle-stick-chart-stopped"),a.fetch()},renderOptions:function(){new ThriveQuizB.views.TestOptions({model:this.model,collection:this.model.get("test_items"),el:this.$el.find("#tqb-test-options")}).render()},renderCompletedtests:function(){if(this.completed_tests.length){new ThriveQuizB.views.CompletedTestItemList({model:this.model,collection:this.completed_tests,el:this.$el.find("#tqb-completed-test-list")}).render(),this.$el.find("#tqb-completed-tests-count").html("("+this.completed_tests.length+")"),this.$el.find("#tqb-completed-tests").show()}},renderTotal:function(){new ThriveQuizB.views.TestItemsTotals({model:this.model,collection:this.model.get("test_items"),el:this.$el.find("#tqb-test-items-total")}).render()},renderOne:function(a,b){a.set("show_graph",!0),a.set("parent_test_running",this.model.get("status"));var c=new ThriveQuizB.views.TestItem({model:a,collection:this.model.get("test_items")});this.$el.find("#tqb-form-test-items").append(c.render().$el)},toggleDisplay:function(a){var b=jQuery(a.currentTarget),c=b.hasClass("collapsed");jQuery(b.data("target"))[c?"slideDown":"slideUp"](200),b.toggleClass("collapsed"),b.toggleClass("hover")},displayNoDataOverlay:function(a){var b=!0;a.each(function(a){if(parseInt(a.get("impressions"))>0)return void(b=!1)}),b?this.$el.find(".tve-chart-overlay").show():this.$el.find(".tve-chart-overlay").hide()}}),ThriveQuizB.views.CompletedTestItemList=ThriveQuizB.views.Base.extend({initialize:function(){this.collection.on("tqb_test_removed",_.bind(function(){this.render(),0==this.collection.length?this.model.trigger("tqb_completed_test_removed"):this.model.trigger("adjust_completed_tests_counter")},this))},addOne:function(a,b){var c=ThriveQuizB.data.colors[a.get("index")%ThriveQuizB.data.colors.length];a.set("show_graph",!0),a.set("parent_test_running",this.model.get("status")),a.set("color",c);var d=new ThriveQuizB.views.CompletedTestItem({model:a,collection:this.collection});this.$el.append(d.render().el)},addAll:function(a){a.each(this.addOne,this)},render:function(){var a=this.$el.find(".tvd-collection-header");return this.$el.html(a),this.addAll(this.collection),this}}),ThriveQuizB.views.CompletedTestItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/completed-item"),tagName:"li",className:"tvd-collection-item tvd-gray",events:{"click .tqb-test-delete":"deleteTest","click .tqb-view-test":"viewTest"},initialize:function(a){this.highest_id=a.highest_id,this.model.on("tqb_test_removed",_.bind(function(){this.collection.trigger("tqb_test_removed")},this))},render:function(){return this.$el.html(this.template({test:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this},viewTest:function(){ThriveQuizB.router.navigate("#dashboard/test/"+this.model.get("id"),{trigger:!0})},deleteTest:function(){this.modal(ThriveQuizB.views.ModalDeleteTest,{width:"800px","max-width":"60%",model:this.model})}}),ThriveQuizB.views.TestOptions=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/options"),events:{"click .tqb-stop-test":"stopTest"},stopTest:function(){this.modal(ThriveQuizB.views.ModalStopVariationTest,{title:ThriveQuizB.t.ChooseWinner,width:1230,"max-width":"90%",model:this.model,collection:this.collection})},render:function(){this.$el.append(this.template(this.model.toJSON()))}}),ThriveQuizB.views.TestItemsTotals=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/test-total"),events:{"click .tqb-edit-test":"editTest"},initialize:function(){this.listenTo(this.model,"auto_win_changed",_.bind(this.render,this))},render:function(){this.$el.html(this.template({totals:this.collection.getTotals(),test:this.model}))},editTest:function(){this.modal(ThriveQuizB.views.ModalEditVariationTest,{title:ThriveQuizB.t.AutomaticWinnerSettings,model:this.model,width:"800px","max-width":"60%"})}}),ThriveQuizB.views.TestItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("tests/test-item"),tagName:"tr",className:"tvd-collection-item",initialize:function(a){this.page_id=a.page_id},events:{"click .tqb-test-item-winner":"setWinner","click .tqb-stop-test-variation-modal":"stopVariation"},render:function(){return this.$el.html(this.template({item:this.model})),this},setWinner:function(a){a.preventDefault();var b=this;TVE_Dash.showLoader(),this.model.set("is_winner",!0),this.model.save({},{success:function(a,c){ThriveQuizB.router.navigate("#dashboard/page/"+b.page_id,{trigger:!0})},complete:function(a){b.model.trigger("tqb_close_modal")}}),TVE_Dash.showLoader()},stopVariation:function(a){this.modal(ThriveQuizB.views.ModalStopVariation,{model:this.model,collection:this.collection,"max-width":"60%",width:450})}}),ThriveQuizB.views.VariationList=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("variations/list"),initialize:function(){this.listenTo(this.collection,"remove",this.removeAction),this.listenTo(this.collection,"add",this.addAction)},removeAction:function(){this.model.trigger("tqb_variation_removed")},addAction:function(){this.model.trigger("tqb_variation_added")},render:function(){return this.$el.html(this.template({model:this.model,collection:this.collection})),this.collection.each(this.renderOne,this),TVE_Dash.materialize(this.$el),this},renderOne:function(a){this.model.get("is_default")&&a.set("is_default",!0);var b=new ThriveQuizB.views.VariationItem({item:a,page_model:this.model});this.$el.find("#tqb-page-variations-item").append(b.render().$el)}}),ThriveQuizB.views.VariationItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("variations/item"),tagName:"tr",className:"tvd-collection-item",events:{"click .tqb-variation-archive":"archive","click .tqb-variation-reset":"reset","click .tqb-variation-delete":"delete",
"click .tqb-variation-re-add":"reAdd","click .tqb-variation-clone":"clone","click .tqb-edit-variation-title":"editVariationTitle"},initialize:function(a){this.item=a.item,this.page_model=a.page_model,this.$el.attr("data-id",this.item.get("id")),this.item.get("post_status")===ThriveQuizB.data.variation_status.archive?this.template=TVE_Dash.tpl("variations/item-archived"):this.template=TVE_Dash.tpl("variations/item"),this.listenTo(this.item,"change:cache_impressions",this.render),this.listenTo(this.item,"change:is_control",this.render)},render:function(){return this.$el.html(this.template({item:this.item,page_model:this.page_model})),this.$variationTitle=this.$el.find(".tqb-variation-title"),this},archive:function(){1==this.page_model.get("variations").length?TVE_Dash.modal(ThriveQuizB.views.ModalArchiveLastVariation,{model:this.item,page_model:this.page_model}):TVE_Dash.modal(ThriveQuizB.views.ModalArchiveVariation,{model:this.item,page_model:this.page_model})},reset:function(){TVE_Dash.modal(ThriveQuizB.views.ModalResetVariation,{model:this.item})},reAdd:function(){var a=this.item.toJSON(),b=new ThriveQuizB.models.Variation;delete a.id,delete a.post_title,b.set(a),b.set({post_status:ThriveQuizB.data.variation_status.publish,name:this.page_model.get("post_title")}),TVE_Dash.modal(ThriveQuizB.views.ModalReAddVariation,{model:b,page_model:this.page_model,width:"800px","max-width":"60%"})},clone:function(){TVE_Dash.showLoader();var a=this.item.toJSON(),b=this,c=new ThriveQuizB.models.Variation;delete a.is_control,a.cache_impressions=0,a.cache_optins=0,a.cache_optins_conversions=0,a.cache_social_shares=0,a.cache_social_shares_conversions=0,c.set(a),c.set("post_title",ThriveQuizB.t.copy_of+" "+a.post_title),TVE_Dash.showLoader(),c.cloneVariation({success:function(a){c.trigger("add:parent_post",a),c.set({id:a.id,tcb_editor_url:a.tcb_editor_url,cache_optin_conversion_rate:"N/A",cache_social_share_conversion_rate:"N/A"}),b.page_model.get("variations").add(c)},error:function(){},complete:function(){TVE_Dash.hideLoader()}},c.toJSON())},delete:function(){TVE_Dash.modal(ThriveQuizB.views.ModalDeleteVariation,{model:this.item})},editVariationTitle:function(){var a=this,b=this.$el.find(".tqb-edit-variation-title"),c=new Backbone.Model({value:this.item.get("post_title"),label:ThriveQuizB.t.variation_name,required:!0});b.hide(),c.on("change:value",function(){a.saveTitle.apply(a,arguments),a.$variationTitle.show(),d.remove(),b.show()}),c.on("tqb_no_change",function(){a.$variationTitle.html(a.item.get("post_title")).show(),d.remove(),b.show()});var d=new ThriveQuizB.views.TextEdit({model:c,tagName:"div"});this.$variationTitle.hide().after(d.render().$el),d.focus()},saveTitle:function(a,b){var c=this;this.item.set({post_title:b}),this.item.save(null,{success:function(a,d){c.$variationTitle.html(b),TVE_Dash.success(ThriveQuizB.t.variation_title_save_success_toast)},error:function(a,b){TVE_Dash.err(ThriveQuizB.t.variation_title_save_fail_toast)}})}}),ThriveQuizB.views.VariationUserConsentGDPR=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("variations/gdpr-user-consent"),events:{"click #tqb_gdpr_user_permission":"checkboxClicked"},render:function(){var a=this.model.get("gdpr_user_consent");return this.$el.html(this.template({checked:!(1!==parseInt(a))})),this},checkboxClicked:function(a){TVE_Dash.showLoader(),this.model.gdprUserConsent({success:function(a){1===parseInt(a.ok)?TVE_Dash.success(a.msg):TVE_Dash.err(a.msg)},complete:function(){TVE_Dash.hideLoader()}},{checked:a.currentTarget.checked?1:0})}}),ThriveQuizB.views.QuizStructureItem=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s12 tvd-m3 tvd-valign tqb-structure-item-wrapper tqb-relative-tooltip-position",template:TVE_Dash.tpl("quiz/structure-item"),events:{"click .tqb-structure-item-card-delete":"deleteCardModal","click .tqb-add-form":"addNewForm","click .tqb-view-test":"viewTest"},initialize:function(a){this.model.on("tqb_render_structure_item",this.deleteCard,this)},render:function(){return this.$el.html(this.template({item:this.model,tge_url:ThriveQuizB.globals.quiz.get("tge_url")})),this},deleteCardModal:function(){var a=this;this.modal(ThriveQuizB.views.ModalDeleteStructureItem,{model:a.model,width:"600px","max-width":"60%"})},deleteCard:function(){this.model.trigger("delete:structureItem",this.model),this.remove()},addNewForm:function(){var a=this.model.get("has_running_test"),b="";a&&ThriveQuizB.router.navigate("#dashboard/test/"+a.id,{trigger:!0}),this.model.get("viewed")||(b="/true"),ThriveQuizB.router.navigate("#dashboard/page/"+this.model.get("ID")+b,{trigger:!0})},viewTest:function(){ThriveQuizB.router.navigate("#dashboard/test/"+this.model.get("has_running_test").id,{trigger:!0})}}),ThriveQuizB.views.QuizStructureResultsItem=ThriveQuizB.views.QuizStructureItem.extend({template:TVE_Dash.tpl("quiz/structure-results-item"),events:function(){return _.extend({},ThriveQuizB.views.QuizStructureItem.prototype.events,{"change #tqb-result-types":function(a){this.change_type(a.currentTarget.value)}})},render:function(){return ThriveQuizB.views.QuizStructureItem.prototype.render.apply(this,arguments),this.render_types(ThriveQuizB.results_page_types),this.toggleTooltip(),this},toggleTooltip:function(){var a=this.$("#tqb-results-tooltip");a.hide(),"url"===this.model.get("results_page").type&&0===this.model.get("results_page").links.length?(a.find("span").html(ThriveQuizB.t.create_redirect_link),a.show()):"page"===this.model.get("results_page").type&&!1===this.model.get("viewed")&&this.model.get("question_number")>0&&(a.find("span").html(ThriveQuizB.t.create_result_page),a.show())},change_type:function(a){-1!==Object.keys(ThriveQuizB.results_page_types).indexOf(a)&&(this.$el.find(".tqb-structure-item-card").removeClass("page url").addClass(a),this.model.get("results_page").type=a,this.save_results_page(this.model.get("results_page")),this.toggleTooltip())},save_results_page:function(b){this.toggleManageButton(!0),a.ajax({type:"post",url:ajaxurl,data:{action:ThriveQuizB.ajax_actions.admin_controller,route:"structure_item",model:b,_nonce:ThriveQuizB.admin_nonce},success:_.bind(function(){this.toggleManageButton(!1)},this)})},render_types:function(a){var b=null;void 0!==this.model.get("results_page")&&this.model.get("results_page").type&&(b=this.model.get("results_page").type);var c=this.$("#tqb-result-types");this.$el.find(".tqb-structure-item-card").removeClass("page url").addClass(b),this.$(".tqb-wizard-tooltip span."+b).show(),_.each(a,function(a,b,d){var e=_.extend({label:"Undefined",value:"Undefined"},a);c.append('<option value="'+e.value+'">'+e.label+"</option>")},this),c.val(b)},toggleManageButton:function(a){a=!!a,this.$(".tqb-add-form").toggleClass("tvd-btn-purple",!a),this.$(".tqb-add-form").toggleClass("tvd-btn-gray",a)},addNewForm:function(){if(!this.$(".tqb-add-form").is(".tvd-btn-gray")){var a=this.model.get("has_running_test"),b="";if(a)return ThriveQuizB.router.navigate("#dashboard/test/"+a.id,{trigger:!0});if(this.model.is_results_url())return ThriveQuizB.router.navigate("#dashboard/page/"+this.model.get("ID")+"/redirect-settings",{trigger:!0});this.model.get("viewed")||(b="/true"),ThriveQuizB.router.navigate("#dashboard/page/"+this.model.get("ID")+b,{trigger:!0})}}}),ThriveQuizB.views.QuizStructureButton=ThriveQuizB.views.Base.extend({className:"tvd-row tvd-center",template:TVE_Dash.tpl("quiz/structure-button"),events:{"click .tqb-dotted-holder":"addCard"},render:function(){return this.$el.html(this.template({item:this.model})),this},addCard:function(){this.model.trigger("add:structureItem",this.model),this.remove(),a(".tvd-material-tooltip").hide()}}),ThriveQuizB.views.QuizStructure=ThriveQuizB.views.Base.extend({className:"tvd-col tvd-s12",template:TVE_Dash.tpl("quiz/structure"),initialize:function(a){},render:function(){return this.$el.html(this.template()),this.renderItem("splash"),this.renderItem("qna"),this.renderItem("optin"),this.renderItem("results"),this.hideShowExtra(),this},renderItem:function(a){var b,c={},d=null,e=this,f=this.model.get(a),g="number"==typeof f&&f;c.last="results"===a,c.type=a,c.quiz_type=this.model.get("quiz_type"),c.parent_id=this.model.get("ID"),c.viewed=!this.model.get("viewed")||this.model.get("viewed")[a],c.mandatory=ThriveQuizB.data.quiz_structure_item_types[a].mandatory,c.post_type=ThriveQuizB.data.quiz_structure_item_types[a].key,c.name=ThriveQuizB.data.quiz_structure_item_types[a].name,this.model.get("running_tests")?c.has_running_test=this.model.get("running_tests")[a]:c.has_running_test=!1,c.question_number=this.model.get("tge_question_number")?this.model.get("tge_question_number"):0,c.nr_of_variations=this.model.get("nr_of_variations")&&this.model.get("nr_of_variations")[a]?this.model.get("nr_of_variations")[a]:0,c.ID=g,c.style=this.model.get("style"),"results"===c.type&&void 0!==this.model.get("results_page")&&(c.results_page=this.model.get("results_page"));var h=new ThriveQuizB.models.StructureItem(c);if(h.on("add:structureItem",function(a){e.addCard(a)}),h.on("delete:structureItem",function(a){e.deleteCard(a)}),f){switch(a){case"results":b=new ThriveQuizB.views.QuizStructureResultsItem({model:h});break;case"qna":h.set("qna_editor_url",this.model.get("qna_editor_url")),b=new ThriveQuizB.views.QuizStructureItem({model:h}),b.template=TVE_Dash.tpl("quiz/structure-item-qna");break;default:b=new ThriveQuizB.views.QuizStructureItem({model:h})}d=this.$el.find("#tqb-structure-card-"+a)}else b=new ThriveQuizB.views.QuizStructureButton({model:h}),d=this.$el.find("#tqb-structure-button-"+a);return d.append(b.render().$el),this},addCard:function(a){var b=a.get("type"),c=this;this.model.set(b,!0),this.model.save(null,{success:function(a){ThriveQuizB.globals.quiz.set("structure",a.toJSON()),c.renderItem(b),ThriveQuizB.util.bind_wistia()},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_structure_save_fail_toast)}}),this.hideShowExtra()},deleteCard:function(a){var b=a.get("type"),c=this;this.model.set(b,!1),this.model.save(null,{success:function(a){ThriveQuizB.globals.quiz.set("structure",a.toJSON()),c.renderItem(b)},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_structure_save_fail_toast)}}),this.hideShowExtra()},checkIfFull:function(){var a=this,b=!0;return Object.keys(ThriveQuizB.data.quiz_structure_item_types).forEach(function(c,d){a.model.get(c)||(b=!1)}),b},hideShowExtra:function(){this.checkIfFull()?this.$el.find("#tqb-structure-button-wrapper").hide():this.$el.find("#tqb-structure-button-wrapper").show()}}),ThriveQuizB.views.StyleItemCard=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("quiz/style/item/card"),render:function(){return this.$el.append(this.template({item:this.model})),this}}),ThriveQuizB.views.ChartView=ThriveQuizB.views.Base.extend({events:{"change #tqb-chart-interval-select":"intervalChanged"},currentInterval:"day",currentSource:"",currentDate:"",initialize:function(){this.source=this.model.get("quiz_id"),this.createChart();var a=this;this.listenTo(this.model,"change:interval",function(){a.model.fetch()}),this.listenTo(this.model,"change:date",function(){a.model.fetch()}),this.listenTo(this.model,"change",this.updateChart)},intervalChanged:function(){var a=this.$el.find("#tqb-chart-interval-select").val();a!=this.currentInterval&&(this.currentInterval=a,void 0!==this.chart&&this.chart.showLoading(),this.model.set("interval",a))},updateChart:function(){this.chart.set("data",this.model.get("chart_data")),this.chart.set("title",this.model.get("chart_title")),this.chart.set("x_axis",this.model.get("chart_x_axis")),this.chart.set("y_axis",this.model.get("chart_y_axis")),this.chart.redraw()},createChart:function(){var a=!1;(this.model.get("quiz_id")||0==this.model.get("quiz_id"))&&(a=!0),this.chart=new ThriveQuizB.LineChart({title:"",data:[],renderTo:"tqb-chart-container",legend:a}),this.chart.showLoading()},drawCandleStick:function(a,b){if(a){var c=a.getCandleStickData();this.bar_chart=new ThriveQuizB.BarChart({title:"",data:c.chartData,colors:c.chartColors,renderTo:b})}}}),ThriveQuizB.views.TestStoppedItemList=ThriveQuizB.views.Base.extend({addOne:function(a,b){a.set("show_graph",!0),a.set("parent_test_running",this.model.get("status"));var c=new ThriveQuizB.views.TestStoppedItem({model:a});this.$el.append(c.render().el)},addAll:function(a){a.each(this.addOne,this)},render:function(){return this.addAll(this.collection),this}}),ThriveQuizB.views.TestStoppedItem=ThriveQuizB.views.Base.extend({tagName:"tr",className:"tvd-collection-item tvd-gray",template:TVE_Dash.tpl("tests/stopped-item"),initialize:function(a){this.highest_id=a.highest_id},render:function(){return this.$el.html(this.template({item:this.model})),this.highest_id===this.model.get("id")&&this.$el.addClass("highlight"),this}}),ThriveQuizB.views.BadgeTemplateItem=ThriveQuizB.views.Base.extend({className:"tqb-badge-template-card",template:TVE_Dash.tpl("badge/template"),events:{"click .tvd-card":"toggle_selected"},render:function(){return this.$el.html(this.template({item:this.model})),this},toggle_selected:function(b){var c=a(b.currentTarget),d=b.currentTarget.dataset.key;this.collection.each(function(a,b,c){a.set("selected",!1,{silent:!0})}),TVE_Dash.select_card(c,c.parents("#tqb-badge-templates-list").first().find(".tvd-card")),this.collection.findWhere({key:d}).set("selected",!0)}}),ThriveQuizB.views.ReportSources=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/source-options"),render:function(){return this.$el.html(this.template({sources:this.collection})),TVE_Dash.materialize(this.$el),this}}),ThriveQuizB.views.Reporting=ThriveQuizB.views.Base.extend({className:"tvd-container",template:TVE_Dash.tpl("reporting-main"),type:null,events:{"change #tqb-report-source":"changeQuiz","change #tqb-report-type":"changeReport","change #tqb-chart-date-select":"changeDateInterval","change #tqb-chart-interval-select":"changeReport","click .calendar-trigger-icon":"triggerDatepicker","click #tqb-reset-quiz-stats":"resetStats","click #tqb-anonymize-quiz-results":"anonymizeResults"},initialize:function(a){this.listenTo(this.collection,"tqb:reset-stats",function(){this.changeReport(!0)}),a.report_type&&(this.report_type=a.report_type)},render:function(){return this.$el.html(this.template({item:this.model})),this.$el.find(".tqb-secondary-selectors").hide(),this.$el.find(".tqb-custom-filter").hide(),this.$("#tqb-report-type").val(this.report_type),TVE_Dash.materialize(this.$el),this.renderQuizList(),this},buildCsvUrl:function(){var b=a(".tqb-answers-csv"),c=b.attr("href"),d=this.model.get("quiz_id"),e=this.updateQueryStringParameter(c,"quiz_id",d);e=this.updateQueryStringParameter(e,"tqb_answ_csv_nonce",ThriveQuizB.admin_answ_csv_nonce),b.attr("href",e)},updateQueryStringParameter:function(a,b,c){var d=new RegExp("([?&])"+b+"=.*?(&|$)","i"),e=-1!==a.indexOf("?")?"&":"?";return a.match(d)?a.replace(d,"$1"+b+"="+c+"$2"):a+e+b+"="+c},renderQuizList:function(){var a=this;this.collection.fetch({success:function(b,c){var d=new ThriveQuizB.views.ReportSources({collection:a.collection});a.$("#tqb-report-source-container").html(d.render().$el),a.model.get("selected")&&a.$el.find("#tqb-report-source").val(a.model.get("selected")),a.changeQuiz(),a.changeReport(),a.getReport(),TVE_Dash.materialize(a.$el)}})},_get_reset_stats_button:function(){return this.$btnResetStats||(this.$btnResetStats=this.$("#tqb-reset-quiz-stats")),this.$btnResetStats.length?this.$btnResetStats:this.$el},changeQuiz:function(a){this.model.set("quiz_id",this.$el.find("#tqb-report-source").val()),0!=this.model.get("quiz_id")?this._get_reset_stats_button().removeClass("tvd-disabled").removeAttr("disabled"):this.$("#tqb-reset-quiz-stats").addClass("tvd-disabled").attr("disabled","disabled"),a&&this.getReport()},changeDateInterval:function(a){if(this.setModel(),"completions"==this.model.get("report_type")&&this.model.get("date")==ThriveQuizB.date_intervals.custom)return this.$el.find(".tqb-custom-filter").show(),void this.getReport();this.$el.find(".tqb-custom-filter").hide(),a&&this.getReport()},changeReport:function(a){if(a&&a.target&&"tqb-report-type"===a.target.id)return ThriveQuizB.router.navigate("#reports/"+this.model.get("quiz_id")+"/"+a.currentTarget.value,{trigger:!0});if(this.setModel(),this.hideAllOption(),a&&this.getReport(),"users"===this.model.get("report_type")?this.$("#tqb-anonymize-quiz-results").removeClass("tvd-hide"):this.$("#tqb-anonymize-quiz-results").addClass("tvd-hide"),this.toggleAnswCsvBtn(this.report_type),this.report_type){this.$("#tqb-report-type").attr("value",this.report_type)}},toggleAnswCsvBtn:function(a){this.$(".tqb-answers-csv").hide(),"questions"===a&&this.$(".tqb-answers-csv").show()},hideAllOption:function(){"completions"!==this.model.get("report_type")?(0==this.$el.find("#tqb-report-source").val()&&this.$el.find("#tqb-report-source").val(this.$el.find("#tqb-report-source option:first").val()).trigger("change"),this.$el.find('#tqb-report-source option[value="0"]').detach()):0==this.$el.find('#tqb-report-source option[value="0"]').length&&this.$el.find("#tqb-report-source").append(TVE_Dash.tpl("reporting/all-source"))},setModel:function(){this.model.set("report_type",this.report_type),this.model.set("date",this.$el.find("#tqb-chart-date-select").val()),this.model.set("interval",this.$el.find("#tqb-chart-interval-select").val()),this.model.set("start_date",this.$el.find("#tqb-report-start-date").val()),this.model.set("end_date",this.$el.find("#tqb-report-end-date").val())},getReport:function(){TVE_Dash.showLoader();var a=this;this.model.save(null,{success:function(b,c){c?("users"==a.model.get("report_type")&&a.renderUsersView(c),"flow"==a.model.get("report_type")&&a.renderFlowView(c),"completions"==a.model.get("report_type")&&a.renderCompletionView(c),"questions"==a.model.get("report_type")&&a.renderQuestionsView(c)):TVE_Dash.err(ThriveQuizB.t.SourceNotFound)},error:function(a,b){},complete:function(){TVE_Dash.hideLoader()}})},renderCompletionView:function(a){new ThriveQuizB.views.CompletionReport({model:new ThriveQuizB.models.CompletionReport(a),el:this.$el.find("#tqb-report-content")}).render();var b=this;return this.$el.find("#tqb-report-start-date").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){b.validateDate("start",b.$el.find("#tqb-report-start-date").val())},onStart:function(){var a=new Date;b.model.set("start_date",[a.getFullYear(),a.getMonth(),a.getDate()-7]),this.set("select",b.model.get("start_date"))}}),this.$el.find("#tqb-report-end-date").pickadate({format:"yyyy-mm-dd",format_submit:"yyyy-mm-dd",onClose:function(){b.validateDate("end",b.$el.find("#tqb-report-end-date").val())},onStart:function(){var a=new Date;b.model.set("end_date",[a.getFullYear(),a.getMonth(),a.getDate()]),this.set("select",b.model.get("end_date"))}}),this.changeReport(),this.$el.find(".tqb-secondary-selectors").show(),this},validateDate:function(a,b){"start"===a&&this.model.get("start_date")!==b&&(this.model.set("start_date",b),this.changeReport(!0)),"end"===a&&this.model.get("end_date")!==b&&(this.model.set("end_date",b),this.changeReport(!0))},renderUsersView:function(a){var b=this,c=new ThriveQuizB.views.QuizUsersList({collection:new ThriveQuizB.collections.QuizUsers(a.data),model:new ThriveQuizB.models.UsersList({total_items:a.total_items,total_pages:a.total_pages,per_page:a.per_page,current_page:a.current_page,offset:a.offset,quiz_id:this.model.get("quiz_id"),since:a.since})});return b.$el.find("#tqb-report-content").html(c.render().el),this.$el.find(".tqb-secondary-selectors").hide(),this},renderFlowView:function(a){return new ThriveQuizB.views.FlowReport({model:new ThriveQuizB.models.FlowReport(a),el:this.$el.find("#tqb-report-content")}).render(),this.$el.find(".tqb-secondary-selectors").hide(),this},renderQuestionsView:function(a){this.buildCsvUrl();var b,c=new ThriveQuizB.collections.CompletionTableModel;this.parseQuestions(a.questions).forEach(function(a,d){b=new ThriveQuizB.models.QuestionsReportItem(a),c.push(b)});var d=new ThriveQuizB.views.QuestionsReport({collection:c,el:this.$el.find("#tqb-report-content")});return d.since=a.since,d.render(),this.$el.find(".tqb-secondary-selectors").hide(),this},parseQuestions:function(b){return a.map(b,function(a,b){return a})},resetStats:function(){this.modal(ThriveQuizB.views.ModalResetQuiz,{model:this.collection.findWhere({ID:parseInt(this.model.get("quiz_id"))}),collection:this.collection})},anonymizeResults:function(){this.modal(ThriveQuizB.views.ModalAnonymizeResults,{model:this.collection.findWhere({ID:parseInt(this.model.get("quiz_id"))}),collection:this.collection})}}),ThriveQuizB.views.QuestionsReport=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/questions-report"),render:function(){return this.$el.html(this.template({date:this.since})),this.renderQuestions(),this},renderQuestions:function(){return this.collection.length?(a(".tqb-answers-csv").removeClass("tqb-disabled"),this.collection.each(this.renderOne,this)):(a(".tqb-answers-csv").addClass("tqb-disabled"),this.$el.find(".tqb-questions-report-no-data").show()),this},renderOne:function(a){var b;return b=3===parseInt(a.get("question_type"))?new ThriveQuizB.views.OpenQuestionsReportItem({model:a}):new ThriveQuizB.views.QuestionsReportItem({model:a}),this.$el.find(".tqb-questions-container").append(b.render().$el),b.renderChart(),this}}),ThriveQuizB.views.QuestionsReportItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/questions-question"),render:function(){return this.$el.html(this.template({item:this.model})),this.renderAnswers(),this},renderChart:function(){var b=this;this.pie_chart=new ThriveQuizB.Pie3DChart({title:"",data:a.map(b.model.get("answers"),function(a,b){return a}),renderTo:"tqb-chart-container-"+b.model.get("id")}),0==this.model.get("total")&&this.$(".tve-chart-overlay").show()},renderAnswers:function(){var a,b=new ThriveQuizB.collections.QuestionsReportAnswers;return this.parseQuestions(this.model.get("answers")).forEach(function(c,d){a=new ThriveQuizB.models.QuestionsReportAnswer(c),b.push(a)}),new ThriveQuizB.views.QuestionsReportAnswers({collection:b,el:this.$el.find(".tqb-answer-table")}).render(),this},parseQuestions:function(b){return a.map(b,function(a,b){return a})}}),ThriveQuizB.views.OpenQuestionsReportItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/questions-open-question"),className:"tqb-oeq-reporting",render:function(){this.$el.html(this.template({item:this.model}));var b=this.$(".tqb-csv-download"),c=b.attr("href");return b.attr("href",c+"&"+a.param({question_id:this.model.get("id"),tqb_csv_nonce:ThriveQuizB.admin_csv_nonce})),new ThriveQuizB.views.PaginationView({el:this.$(".tqb-answers-box"),model:this.model,collection:new ThriveQuizB.collections.PaginatedCollection(this.model.get("user_answers"))}).render(),this},renderChart:function(){}}),ThriveQuizB.views.PaginationView=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/pagination"),events:{"click .tqb-next":"nextPage","click .tqb-previous":"previousPage","click .tqb-page":"goToPage","change .tqb-perPage":function(a){if(a&&a.currentTarget.value){var b=parseInt(a.currentTarget.value);isNaN(b)&&(b=this.collection.length),this.collection.perPage=b,this.collection.currentPage=1,this.collection.trigger("refresh")}}},initialize:function(a){!1==a.collection instanceof ThriveQuizB.collections.PaginatedCollection&&(this.collection=new ThriveQuizB.collections.PaginatedCollection),_.bindAll(this,"render"),this.collection.bind("refresh",this.render)},render:function(){var a=this.collection.pageInfo(),b=this.collection.getItems(),c=TVE_Dash.tpl("reporting/questions/open/answer");return this.$el.html(this.template(a)),_.each(b,function(a){this.$el.append(c({answer:a}))},this),TVE_Dash.materialize(this.$el),this},nextPage:function(a){a&&a.currentTarget.dataset.page<=this.collection.pageInfo().totalPages&&this.collection.nextPage()},previousPage:function(a){a&&a.currentTarget.dataset.page>=1&&this.collection.previousPage()},goToPage:function(a){a&&a.currentTarget.dataset.page&&this.collection.goToPage(a.currentTarget.dataset.page)}}),ThriveQuizB.views.QuestionsReportAnswers=ThriveQuizB.views.Base.extend({render:function(){return this.collection.each(this.renderOne,this),this},renderOne:function(a){var b=new ThriveQuizB.views.QuestionsReportAnswer({model:a});return this.$el.append(b.render().$el),this}}),ThriveQuizB.views.QuestionsReportAnswer=ThriveQuizB.views.Base.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("reporting/questions-answer"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveQuizB.views.CompletionReport=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/completion-report"),render:function(){this.$el.html(this.template({item:this.model})),this.updateColorList(this.model);var a=new ThriveQuizB.models.CompletionChartModel(this.model.toJSON()),b=new ThriveQuizB.views.ChartView({model:a,el:this.$el.find(".tve-chart-interval")});this.validateChartData(),b.updateChart();var c,d=this.parseTableQuizzes(this.model.get("quiz_list")),e=new ThriveQuizB.collections.CompletionTableModel,f=this;if(d.length){d.forEach(function(a,b){c=new ThriveQuizB.models.CompletionQuiz(a),c.set("color",f.colors[a.quiz_id]),e.push(c)});new ThriveQuizB.views.CompletionTable({collection:e,el:this.$el.find(".tqb-table-container")}).render(),this.$el.find("#tqb-table-items").show()}else this.$el.find("#tqb-table-items").hide();return TVE_Dash.materialize(this.$el),this},updateColorList:function(){this.colors=[];var a=this;this.parseTableQuizzes(this.model.get("chart_data")).forEach(function(b,c){a.colors[b.id]=ThriveQuizB.chart_colors[c%ThriveQuizB.chart_colors.length]})},parseTableQuizzes:function(b){return a.map(b,function(a,b){return a})},validateChartData:function(){_.isEmpty(this.model.get("chart_data"))&&this.$el.find(".tve-chart-overlay").show()}}),ThriveQuizB.views.CompletionQuiz=ThriveQuizB.views.Base.extend({tagName:"li",className:"tvd-collection-item",template:TVE_Dash.tpl("reporting/completion-quiz"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveQuizB.views.CompletionTable=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/completion-table"),currentPage:1,pageCount:1,pagesToDisplay:2,itemsPerPage:10,totalItems:0,collectionSlice:null,from:(this.currentPage-1)*this.itemsPerPage,events:{"click a.page":"changePage"},initialize:function(){this.collectionSlice||(this.collectionSlice=this.collection),this.collectionSlice.length>this.itemsPerPage&&this.getItemsToDisplay(this.collectionSlice),this.totalItems=this.collection.length,this.pageCount=Math.ceil(this.totalItems/this.itemsPerPage)},getItemsToDisplay:function(a){var b=(this.currentPage-1)*this.itemsPerPage;this.collectionSlice=new ThriveQuizB.collections.CompletionTableModel(a.chain().rest(b).first(this.itemsPerPage).value())},render:function(){return this.$el.html(this.template({item:this.model})),this.totalItems>this.itemsPerPage&&this.renderPagination(),this.renderList(this.collectionSlice),this},renderList:function(a){var b=this.$el.find("#tqb-table-items .tvd-collection-header");this.$el.find("#tqb-table-items").html(b),a.each(this.renderOne,this)},renderOne:function(a){var b=new ThriveQuizB.views.CompletionQuiz({model:a});return this.$el.find("#tqb-table-items").append(b.render().$el),this},renderPagination:function(){var a=this,b=new ThriveQuizB.views.CompletionReportPagination({model:new ThriveQuizB.models.CompletionPagination({currentPage:parseInt(a.currentPage),pageCount:parseInt(a.pageCount),totalItems:parseInt(a.totalItems),itemsPerPage:parseInt(a.itemsPerPage),pagesToDisplay:parseInt(a.pagesToDisplay)})});return a.$el.find("#tqb-completion-pagination").html(b.render().$el),!0},changePage:function(a,b){var c=this;c.itemsPerPage;return a&&void 0!==a.currentTarget?c.currentPage=jQuery(a.currentTarget).attr("value"):b&&void 0!==b.page&&(c.currentPage=parseInt(b.page)),c.currentPage<1&&(c.currentPage=1),this.getItemsToDisplay(this.collection),this.renderList(this.collectionSlice),this.renderPagination(),!1}}),ThriveQuizB.views.QuizUsersList=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/users-list"),events:{"click .tqb-view-quiz-user-data":"viewUserAnswers","click .tqb-previous-page":"previousPage","click .tqb-next-page":"nextPage","change #tqb-user-per-page":"changeNrOfRows","click .tqb-jump-to-page-button":"jumpToPage"},render:function(){return this.$el.html(this.template({item:this.model})),this.collection.each(this.renderOne,this),Number(this.model.get("total_items"))<Number(this.model.get("per_page"))&&this.hidePagination(),this.$el.find("#tqb-user-per-page").val(this.model.get("per_page")),this.enterPress(),this},renderOne:function(a){var b=new ThriveQuizB.views.User({model:a,collection:this.collection});return this.$el.find(".tqb-users-list-table-content").append(b.render().$el),this},hidePagination:function(){this.$el.find(".tqb-users-report-jump").hide(),this.$el.find(".tqb-users-report-pagination").hide()},enterPress:function(){var b=this;return a(document).off("keypress"),a(document).on("keypress",function(a){13!=a.which&&13!=a.keyCode||b.jumpToPage()}),this},jumpToPage:function(){var a=this.$el.find("#tqb-current-page-input").val();if(a<=this.model.get("total_pages")&&a>=1){var b=this.model.get("per_page");this.model.set("current_page",a),this.model.set("jump_page",a),this.model.set("offset",(a-1)*b),this.refreshList()}else TVE_Dash.err(this.$el.find("#tqb-current-page-input").attr("data-error")),this.$el.find("#tqb-current-page-input").addClass("tvd-invalid")},changeNrOfRows:function(){this.model.set("offset",0),this.model.set("current_page",0),this.model.set("per_page",this.$el.find("#tqb-user-per-page").val()),this.refreshList()},previousPage:function(){var a=this.model.get("current_page"),b=this.model.get("per_page");a>1&&(this.model.set("offset",(a-2)*b),this.model.set("current_page",--a),this.refreshList())},nextPage:function(){var a=this.model.get("current_page"),b=this.model.get("per_page");a<this.model.get("total_pages")&&(this.model.set("offset",a*b),this.model.set("current_page",++a),this.refreshList())},refreshList:function(){TVE_Dash.showLoader();var a=this;this.model.save(null,{success:function(b,c){a.collection=new ThriveQuizB.collections.QuizUsers(c.data),a.model.set("total_pages",c.total_pages),a.render()},error:function(a,b){},complete:function(){TVE_Dash.hideLoader()}})}}),ThriveQuizB.views.User=ThriveQuizB.views.Base.extend({tagName:"tr",className:"tqb-user-table-item tvd-gray",template:TVE_Dash.tpl("reporting/users-item"),events:{"click .tqb-view-users-answers":"showAnswers"},render:function(){return this.$el.html(this.template({item:this.model})),this},showAnswers:function(){var a=this;(new ThriveQuizB.collections.QuizUserAnswers).fetch({data:{quiz_id:a.model.get("quiz_id"),user_id:a.model.get("id")},success:function(b,c){a.modal(ThriveQuizB.views.ModalViewUserAnswers,{model:a.model,collection:new ThriveQuizB.collections.UserQuestions(c),width:"750px"})},error:function(a,b,c){}})}}),ThriveQuizB.views.UserQuestion=ThriveQuizB.views.Base.extend({className:"tvd-collection-item",tagName:"li",template:TVE_Dash.tpl("reporting/user-question"),initialize:function(){this.collection=new ThriveQuizB.collections.UserAnswers(this.model.get("answers"))},render:function(){this.$el.html(this.template({item:this.model}));var a=this.$el.find(".tqb-user-answers"),b=parseInt(this.model.get("q_type"));return a.empty(),a.addClass(1===b||3===b?"tqb-text-question":"tqb-image-question"),this.collection.each(function(c){var d=new ThriveQuizB.views.UserQuestionAnswer({model:c,q_type:b});a.append(d.render().el)},this),this}}),ThriveQuizB.views.CompletionReportPagination=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("reporting/completion-pagination"),render:function(){return this.$el.html(this.template({item:this.model})),this}}),
ThriveQuizB.views.UserQuestionAnswer=ThriveQuizB.views.Base.extend({className:"tvd-collection-item tvd-gray tqb-flex-item",q_type:1,initialize:function(a){this.q_type=parseInt(a.q_type||this.q_type)},render:function(){return this.$el.html(this.template({item:this.model})),this},template:function(a){a=a||{};var b="text";switch(this.q_type){case 2:b="image";break;case 3:b="open"}return TVE_Dash.tpl("reporting/user-answer-"+b,a)}}),ThriveQuizB.views.FlowReport=ThriveQuizB.views.Base.extend({className:"tqb-flow-report",template:TVE_Dash.tpl("reporting/flow-report"),render:function(){return this.$el.html(this.template({item:this.model})),this.model.get("splash")&&this.renderSplash(),this.renderQNA(),this.model.get("optin")&&this.renderOptin(),this.renderResults(),this.renderConclusion(),this},renderConclusion:function(){var a=this.model.get("splash")?this.model.get("splash")[ThriveQuizB.event_types.impression]:this.model.get("qna")[ThriveQuizB.event_types.impression],b=this.model.get("results")[ThriveQuizB.event_types.conversion];this.$el.find(".tqb-visitors-completed").html(b),this.$el.find(".tqb-conversion-rate").html((100*b/a).toFixed(2)+"%"),this.$el.find(".tqb-flow-report-conclusion").show(),this.$el.find(".tqb-flow-report-no-data").hide()},renderSplash:function(){var a=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"splash",data:this.model.get("splash"),total:this.model.get("users")})});this.$el.find(".tqb-flow-report-splash").html(a.render().el)},renderQNA:function(){var a=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"qna",data:this.model.get("qna"),total:this.model.get("users")})});this.$el.find(".tqb-flow-report-qna").html(a.render().el)},renderOptin:function(){var a=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"optin",data:this.model.get("optin"),subscribers:this.model.get("optin_subscribers"),total:this.model.get("users")})});this.$el.find(".tqb-flow-report-optin").html(a.render().el)},renderResults:function(){var a=new ThriveQuizB.views.FlowReportSection({model:new ThriveQuizB.models.FlowReportSection({type:"results",data:this.model.get("results"),subscribers:this.model.get("results_subscribers"),social_shares:this.model.get("results_social_shares"),total:this.model.get("users"),results_page:new Backbone.Model(this.model.get("results_page"))})});this.$el.find(".tqb-flow-report-results").html(a.render().el)}}),ThriveQuizB.views.FlowReportSection=ThriveQuizB.views.Base.extend({className:"tvd-collection-item tvd-row",template:TVE_Dash.tpl("reporting/flow-section"),initialize:function(){var a=this.model.get("data");if(void 0===this.model.get("data")[ThriveQuizB.event_types.skip_optin]&&(a[ThriveQuizB.event_types.skip_optin]=0,this.model.set("data",a)),void 0===this.model.get("data")[ThriveQuizB.event_types.conversion]&&(a[ThriveQuizB.event_types.conversion]=0,this.model.set("data",a)),void 0===this.model.get("data")[ThriveQuizB.event_types.impression]&&(a[ThriveQuizB.event_types.impression]=0,this.model.set("data",a)),this.model.get("data")[ThriveQuizB.event_types.skip_optin]){var b=Number(a[ThriveQuizB.event_types.skip_optin])+Number(a[ThriveQuizB.event_types.conversion]);a[ThriveQuizB.event_types.conversion]=b,this.model.set("data",a)}},render:function(){return this.$el.html(this.template({item:this.model})),this}}),ThriveQuizB.views.CategoryItem=ThriveQuizB.views.Base.extend({className:"tqb-quiz-category",template:TVE_Dash.tpl("category-item"),events:{"click .tqb-remove-input":"remove_option"},initialize:function(a){this.quiz_model=a.quiz_model,a.item&&(this.item=a.item)},render:function(){return this.$el.append(this.template({item:this.model})),this},remove_option:function(){this.quiz_model.get("results").remove(this.model),this.remove()}}),ThriveQuizB.views.QuizHilightSettings=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("quiz/settings/highlight-answer"),events:{"click .tqb-radio-option":"handle"},render:function(){return this.$el.html(this.template({model:this.model})),TVE_Dash.data_binder(this),this},handle:function(b){this.$(".tqb-radio-option").attr("checked",!1),this.model.resetValues(),this.model.set(b.currentTarget.dataset.attr,1);var c=this.model;a(".tqb-highlight-answer").each(function(){c.set(a(this).attr("data-attr"),a(this).is(":checked")?1:0,{silent:!0})}),this.render()}}),ThriveQuizB.views.AnswerFeedbackSettings=ThriveQuizB.views.QuizHilightSettings.extend({template:TVE_Dash.tpl("quiz/settings/feedback")}),ThriveQuizB.views.AnswerFeedbackExtendedSettings=ThriveQuizB.views.QuizHilightSettings.extend({template:TVE_Dash.tpl("quiz/settings/feedback-extended")}),ThriveQuizB.views.PreviewFeedbackSettings=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("quiz/settings/feedback-preview"),render:function(){return this.$el.html(this.template({model:this.model})),this}}),ThriveQuizB.views.QuizExtraSettings=ThriveQuizB.views.Base.extend({initialize:function(a){this.quiz_model=a.quiz_model},render:function(){var a="render_"+this.model.get("type")+"_settings";return a="function"==typeof this[a]?a:"render_default_settings",this[a](),this},render_right_wrong_settings:function(){this.hilight_view=new ThriveQuizB.views.QuizHilightSettings({model:this.model.get("highlight_settings"),el:this.$(".tqb-highlight-settings")}).render(),this.feedback_view=new ThriveQuizB.views.AnswerFeedbackSettings({model:this.model.get("feedback_settings"),el:this.$(".tqb-feedback-settings")}).render(),new ThriveQuizB.views.PreviewFeedbackSettings({el:this.$(".tqb-preview-settings")}).render(),this.hilight_view.model.on("change",function(a){this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===a.get("load_next_question")),this.$(".tqb-tooltip-demo").toggleClass("tqb-hide",1!==a.get("highlight_and_show_feedback")),this.$(".tqb-feedback-text").html(1===a.get("highlight_and_show_feedback")?ThriveQuizB.t.highlight_and_feedback_text:ThriveQuizB.t.feedback_text)},this),this.feedback_view.model.on("change",function(a){this.$(".tqb-button-holder").toggleClass("tqb-hide",1!==a.get("press_next"))},this),this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===this.hilight_view.model.get("load_next_question")),this.$(".tqb-tooltip-demo").toggleClass("tqb-hide",1!==this.hilight_view.model.get("highlight_and_show_feedback")),this.$(".tqb-button-holder").toggleClass("tqb-hide",1!==this.feedback_view.model.get("press_next")),this.$(".tqb-feedback-text").html(1===this.hilight_view.model.get("highlight_and_show_feedback")?ThriveQuizB.t.highlight_and_feedback_text:ThriveQuizB.t.feedback_text)},render_default_settings:function(){this.feedback_view=new ThriveQuizB.views.AnswerFeedbackExtendedSettings({model:this.model.get("feedback_settings"),el:this.$(".tqb-feedback-settings")}),this.feedback_view.render(),new ThriveQuizB.views.PreviewFeedbackSettings({el:this.$(".tqb-preview-settings")}).render(),this.feedback_view.model.on("change",function(a){this.showPreview(a)},this),this.showPreview(this.feedback_view.model),this.$(".tqb-prev-demo").addClass("tqb-normal-answer")},showPreview:function(a){if(!(!a instanceof Backbone.Model)){var b=1===a.get("display_feedback")||1===a.get("press_next");this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===a.get("load_next_question")),this.$(".tqb-feedback-settings, .tqb-preview-settings").toggleClass("tqb-hide",1===a.get("load_next_question")),this.$(".tqb-tooltip-demo").toggleClass("tqb-hide",!b),this.$(".tqb-button-holder").toggleClass("tqb-hide",1!==a.get("press_next"))}},render_personality_settings:function(){this.renderAddCategoryItem(),this.model.get("results").each(this.renderCategoryItem,this),this.model.get("results").on("add_item",function(a){this.model.get("results").add(a),this.renderCategoryItem(a),this.renderAddCategoryItem()},this),this.render_default_settings()},renderAddCategoryItem:function(){this.addCatView&&(this.addCatView.undelegateEvents(),this.addCatView.$el.empty()),this.addCatView=new ThriveQuizB.views.AddCategoryItem({model:new ThriveQuizB.models.Base({quiz_id:this.model.get("ID"),text:""}),el:this.$(".add-category-holder"),collection:this.model.get("results")}),this.addCatView.render()},renderCategoryItem:function(a){var b=new ThriveQuizB.views.CategoryItem({item:a.get("text"),quiz_model:this.model,model:a});this.$("#tqb-multiple-input-wrapper").append(b.render().$el)}}),ThriveQuizB.views.AddCategoryItem=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("new-category-item"),events:{"click #tqb-add-result":"add","keypress input":function(a){13===a.which&&(this.model.get("text").length||this.model.set("text",a.currentTarget.value),this.add())}},render:function(){return this.$el.html(this.template({model:this.model})),TVE_Dash.data_binder(this),this},add:function(){return this.collection.length>=ThriveQuizB.data.max_interval_number?void TVE_Dash.err(ThriveQuizB.t.maximum_limit_of_results):this.model.get("text").length?this.model.get("text").length>255?void TVE_Dash.err(ThriveQuizB.t.category_title_too_long):void this.collection.trigger("add_item",this.model):void TVE_Dash.err(ThriveQuizB.t.category_title_required)}}),ThriveQuizB.views.ResultsSettings=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("redirect-settings"),messageView:null,events:{"click .tqb-add-new-link":function(){if(!this.$(".tqb-redirect-link-form").length){var a=new ThriveQuizB.models.RedirectLink({lower_bound:this.model.get("minimum_result"),upper_bound:this.model.get("maximum_result"),quiz_id:this.model.get("post_parent"),page_id:this.model.get("ID")}),b=new ThriveQuizB.views.RedirectLinkForm({model:a,settings:this.model.toJSON()});a.on("tqb:added",function(a){this.model.get("links")instanceof ThriveQuizB.collections.RedirectLinks&&(this.model.get("links").add(a),this.renderLinks(this.model.get("links")))},this),this.$("#tgb-redirect-links").after(b.render().$el)}}},render:function(){return this.$el.html(this.template({item:this.model})),this.model.get("links")instanceof ThriveQuizB.collections.RedirectLinks&&(this.renderLinks(this.model.get("links")),this.listenTo(this.model.get("links"),"tqb:link:saved",function(){this.renderLinks(this.model.get("links"))}),this.listenTo(this.model.get("links"),"remove",function(){this.renderLinks(this.model.get("links"))}),this.listenTo(this.model.get("links"),"change",this.toggleQuizStatus)),"personality"===this.model.get("quiz_type")?this.$(".tqb-add-new-link").hide():this.$(".tqb-add-new-link").css("display","inline-block"),this.listenTo(this.model,"change:display_message",_.bind(function(a,b){b?this.messageView=this.renderMessageView():this.messageView.remove(),a.isValid()&&a.save()},this)),this.listenTo(this.model,"change:forward_results",_.bind(function(a,b){this.$("#tqb-redirect-params-wrapper").toggle(b),a.isValid()&&a.save()},this)),this.listenTo(this.model.get("message"),"change",function(a){a.isValid()&&this.model.save()}),this.model.get("display_message")&&(this.messageView=this.renderMessageView()),this.$("#tqb-redirect-params-wrapper").toggle(!!this.model.get("forward_results")),TVE_Dash.data_binder(this),this},toggleQuizStatus:function(){if(this.model.get("links")instanceof ThriveQuizB.collections.RedirectLinks){var a=this.model.get("links").validate(this.model);this.$(".tqb-quiz-not-ready").toggle(!a),this.$(".tqb-quiz-ready").toggle(a)}},renderLinks:function(a){if(a instanceof ThriveQuizB.collections.RedirectLinks){this.toggleQuizStatus(),a.sort(),this.$("#tqb-redirect-links-header")[a.length?"show":"hide"](),this.$("#tqb-no-redirect-links")[a.length?"hide":"show"](),"personality"===this.model.get("quiz_type")&&this.$("#tqb-redirect-links-header").hide();var b=this.$("#tqb-redirect-links");b.empty();var c=this;a.each(function(a,d,e){var f=new ThriveQuizB.views.RedirectLink({model:a,settings:c.model.toJSON()});b.append(f.render().$el)},this)}},renderMessageView:function(){var a=new ThriveQuizB.views.RedirectMessage({model:this.model.get("message")}).render();return this.$("#tqb-message-wrapper").html(a.$el),a}}),ThriveQuizB.views.RedirectMessage=ThriveQuizB.views.Base.extend({template:TVE_Dash.tpl("results-links/message"),initialize:function(a){a.model||(this.model=new ThriveQuizB.models.RedirectMessage)},render:function(){return this.$el.html(this.template({model:this.model})),TVE_Dash.data_binder(this),this}}),ThriveQuizB.views.RedirectLink=ThriveQuizB.views.Base.extend({className:"tvd-row",template:TVE_Dash.tpl("results-links/item"),result_template:TVE_Dash.tpl("results-links/category-item"),settings:{minimum_result:0,maximum_result:0},events:{"change select":"on_type_changed","click .tqb-delete-link":function(){var a={itemView:this,model:this.model,width:"600px","max-width":"60%"};this.modal(ThriveQuizB.views.ModalDeleteRedirectLink,a)},"change .tqb-lower-bound":function(a){var b=parseInt(a.currentTarget.value);return b<this.settings.minimum_result||b>this.settings.maximum_result?TVE_Dash.err(TVE_Dash.sprintf("Invalid Lower Bound. It should be between %s and %s !",[this.settings.minimum_result,this.settings.maximum_result])):b>this.model.get("upper_bound")?TVE_Dash.err(ThriveQuizB.t.redirect_link.errors.lower_bound_greater_than_upper_bound):(this.model.set("status","valid"),this.model.setLowerBound(b),void this.model.collection.save())},"change .tqb-upper-bound":function(a){var b=parseInt(a.currentTarget.value);return b<this.settings.minimum_result||b>this.settings.maximum_result?TVE_Dash.err(TVE_Dash.sprintf("Invalid Upper Bound. It should be between %s and %s !",[this.settings.minimum_result,this.settings.maximum_result])):b<this.model.get("lower_bound")?TVE_Dash.err(ThriveQuizB.t.redirect_link.errors.upper_bound_lower_than_lower_bound):(this.model.set("status","valid"),this.model.setUpperBound(b),void this.model.collection.save())},"change .tqb-link-target":function(a){if("external"===this.model.get("type")&&this.model.set("link",a.currentTarget.value),!1===this.model.isValid())return TVE_Dash.err(this.model.validationError);"personality"===this.settings.quiz_type&&this.model.set("status","valid");var b=this;this.model.save(null,{success:function(){b.render()}})},"click .tqb-edit-redirect-link":function(){var a=this.$(".tqb-link-target").show();"local"===this.model.get("type")?(a.val(TVE_Dash.escapeHTML(this.model.get("post_title"))),this.init_autocomplete()):(a.val(this.model.get("link")),this.$(".tqb-link-target").autocomplete(),this.$(".tqb-link-target").autocomplete("destroy"));var b=a.val(),c=this;a.focus().blur(function(){this.value===b&&c.render()})}},initialize:function(b){b&&b.settings&&(this.settings=a.extend({},this.settings,b.settings)),this.listenTo(this.model,"change:status",this.render),this.listenTo(this.model,"change:lower_bound",this.render),this.listenTo(this.model,"change:upper_bound",this.render)},render:function(){return"personality"===this.settings.quiz_type?this.$el.html(this.result_template({item:this.model})):this.$el.html(this.template({item:this.model})),this.model.get("post_title")&&0!==this.model.get("post_title").length||0!==this.model.get("link").length||(this.$(".tqb-edit-redirect-link").hide(),this.$(".tqb-link-target").show().attr("placeholder","Search for content"),this.init_autocomplete()),this.$(".tqb-redirect-status-icon").toggleClass("tqb-redirect-hidden","valid"===this.model.get("status")),this.$("select").val(this.model.get("type")),TVE_Dash.materialize(this.$el),this},on_type_changed:function(a){var b=this.model.get("type"),c=a.currentTarget.value;this.$(".tqb-redirect-link-target").remove(),this.$(".tqb-link-target").val("").show().attr("placeholder","local"===c?ThriveQuizB.t.redirect_link.search_content:ThriveQuizB.t.redirect_link.add_url),this.model.set("type",c),this.$(".tqb-edit-redirect-link").hide(),"local"===c?this.init_autocomplete():(this.$(".tqb-link-target").autocomplete(),this.$(".tqb-link-target").autocomplete("destroy"));var d=this;this.$(".tqb-link-target").blur(function(){""===this.value&&(d.model.set("type",b),d.render())}),setTimeout(function(a){a.$(".tqb-link-target").focus()},0,this)},init_autocomplete:function(){var b=this,c=this.$(".tqb-link-target");c.autocomplete({minLength:3,source:function(b,c){a.ajax({url:ajaxurl,dataType:"json",type:"post",data:{action:"tqb_admin_ajax_controller",route:"post_search",s:b.term,_nonce:ThriveQuizB.admin_nonce},success:function(a){c(a)},error:function(){c([])}})},select:function(a,d){return b.model.reset_target(),b.model.set("post_id",d.item.id),b.model.set("post_title",d.item.label),b.model.set("status","valid"),c.val(TVE_Dash.escapeHTML(d.item.label)).trigger("change").blur(),!1}}).data("ui-autocomplete")._renderItem=function(b,c){var d=a("<span>"),e=a("<span>");return a(b).addClass("tqb-redirect-dropdown"),d.append(c.label),e.append(c.type),a("<li>").append(d,e).appendTo(b)}}}),ThriveQuizB.views.RedirectLinkForm=ThriveQuizB.views.Base.extend({className:"tqb-redirect-link-form",template:TVE_Dash.tpl("results-links/form"),$link_type:null,settings:{minimum_result:0,maximum_result:0},events:{"click .tqb-cancel-link":"remove","click .tqb-save-link":"save","change #tqb-link-target":function(a){"external"===this.model.get("type")&&this.model.set("link",a.currentTarget.value)}},initialize:function(a){this.settings=a&&a.settings||this.settings,this.listenTo(this.model,"change:type",this.type_changed)},render:function(){return this.$el.html(this.template({item:this.model})),this.$link_type=this.$("#tqb-link-type"),this.$link_type.val(this.model.get("type")),this.$search=this.$("#tqb-link-target"),"local"===this.model.get("type")&&this.autocomplete(),TVE_Dash.data_binder(this),TVE_Dash.materialize(this.$el),this},type_changed:function(a,b){this.model.reset_target(),this.$search.val(""),"external"===b?(this.$search.autocomplete("destroy"),this.$search.attr("placeholder",ThriveQuizB.t.redirect_link.add_url)):(this.$search.attr("placeholder",ThriveQuizB.t.redirect_link.search_content),this.autocomplete())},save:function(){if(!1!==this.model.isValid(this.settings)){if(this.settings.links instanceof ThriveQuizB.collections.RedirectLinks){var a=!1,b=!1;if(this.settings.links.each(function(c){!a&&parseInt(this.model.get("lower_bound"))>=parseInt(c.get("lower_bound"))&&parseInt(this.model.get("lower_bound"))<=parseInt(c.get("upper_bound"))&&(a=!0),!b&&parseInt(this.model.get("upper_bound"))>=parseInt(c.get("lower_bound"))&&parseInt(this.model.get("upper_bound"))<=parseInt(c.get("upper_bound"))&&(b=!0)},this),a||b)return TVE_Dash.err("Lower or Upper bounds are already set for another link")}this.model.save({},{success:function(a){a.trigger("tqb:added",a)},error:function(a){TVE_Dash.err(a.responseText)}}),this.remove()}},autocomplete:function(){var b=this;this.$search.autocomplete({minLength:3,source:function(b,c){a.ajax({url:ajaxurl,dataType:"json",type:"post",data:{action:"tqb_admin_ajax_controller",route:"post_search",s:b.term,_nonce:ThriveQuizB.admin_nonce},success:function(a){c(a)},error:function(){c([])}})},select:function(a,c){b.model.set("post_id",c.item.id)},close:function(){var a=TVE_Dash.escapeHTML(b.$search.val());b.$search.val(a)}}).data("ui-autocomplete")._renderItem=function(b,c){var d=a("<span>"),e=a("<span>");return a(b).addClass("tqb-redirect-dropdown"),d.append(c.label),e.append(c.type),a("<li>").append(d,e).appendTo(b)}}})})}(jQuery);var ThriveQuizB=ThriveQuizB||{};ThriveQuizB.views=ThriveQuizB.views||{},function(a){a(function(){a("body").on("click",".tqb-toggle-settings",function(a){TVE_Dash.modal(ThriveQuizB.views.ModalSettings,{"max-width":"35%"})}),ThriveQuizB.views.ModalSteps=TVE_Dash.views.Modal.extend({stepClass:".tqb-modal-step",currentStep:0,$step:null,events:{"click .tqb-modal-next-step":"next","click .tqb-modal-prev-step":"prev"},afterRender:function(){return this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(0),this},gotoStep:function(a){var b=this.steps.hide().eq(a).show(),c=this;return this.$step=b,setTimeout(function(){c.input_focus(b)},50),this.currentStep=a,this},next:function(){this.beforeNext(),this.gotoStep(this.currentStep+1),this.afterNext()},prev:function(){this.beforePrev(),this.gotoStep(this.currentStep-1),this.afterPrev()},beforeNext:function(){return this},afterNext:function(){return this},beforePrev:function(){return this},afterPrev:function(){return this}}),ThriveQuizB.views.ModalNewQuiz=ThriveQuizB.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/new-quiz"),events:function(){return _.extend({},ThriveQuizB.views.ModalSteps.prototype.events,{"click .tqb-new-quiz-tpl":"chooseQuizTemplate","click .tvd-modal-submit":"save"})},afterInitialize:function(){this.listenTo(this.model,"change:tpl",_.bind(function(){var a=this.templates.findWhere({id:this.model.get("tpl")});this.model.set("post_title",a.get("is_empty")?"":a.get("name")),this.model.set("tpl",a.get("id"))},this))},afterRender:function(){this.steps=this.$(this.stepClass).hide(),this.gotoStep(0),this.renderTemplates(),ThriveQuizB.util.data_binder(this)},chooseQuizTemplate:function(b){var c=a(b.target).closest(".tvd-card")[0],d=this.$(".tqb-new-quiz-tpl");this.$el.find(".tqb-modal-next-step").removeAttr("disabled"),TVE_Dash.select_card(a(c),d),this.model.set("tpl",c.dataset.id),this.renderDescription()},renderTemplates:function(){var a=this.$(".tqb-new-quiz-templates");return a.empty(),this.data.templates.each(function(b){a.append(TVE_Dash.tpl("modals/new-quiz-tpl",{item:b}))},this),this},renderDescription:function(){var a=this.$(".tqb-new-quiz-description"),b=this.model.get("tpl");if(b){var c=this.data.templates.findWhere({id:b});a.html("<span>"+c.get("description")+"</span>&nbsp;"),a.append(c.get("learn_more")),ThriveQuizB.util.bind_wistia()}},next:function(){if(!this.model.get("tpl"))return TVE_Dash.err(ThriveQuizB.t.QuizMissingTemplate);this.gotoStep(this.currentStep+1)},save:function(a){var b=this;this.model.isValid()&&(TVE_Dash.showLoader(),this.model.set("order",0,{silent:!0}),this.model.save(null,{success:function(a,c){if(a.set("ID",c),b.collection.unshift(a),ThriveQuizB.shown_quizzes.order){var d=ThriveQuizB.shown_quizzes.order[ThriveQuizB.quizzes_details.quizzes_displayed-1];ThriveQuizB.quizzes_details.quizzes_number===ThriveQuizB.quizzes_details.quizzes_displayed||ThriveQuizB.quizzes_details.quizzes_displayed<ThriveQuizB.quizzes_details.quizzes_displayed.max_quiz_number?ThriveQuizB.quizzes_details.quizzes_displayed+=1:ThriveQuizB.shown_quizzes.visible[d]=!1,ThriveQuizB.shown_quizzes.visible[c]=!0}ThriveQuizB.quizzes_details.quizzes_number+=1,ThriveQuizB.globals.quizzes.add(b.model,{at:b.collection.length}),b.close(),ThriveQuizB.router.navigate(a.get_edit_route(),{trigger:!0})},error:function(){TVE_Dash.err(ThriveQuizB.t.quiz_save_fail_toast)},complete:function(){TVE_Dash.hideLoader()}}))}}),ThriveQuizB.views.ModalEditQuizType=ThriveQuizB.views.ModalSteps.extend({template:TVE_Dash.tpl("modals/edit-quiz-type"),className:"tvd-modal tqb-feedback-modal",modal_step:0,edit_mode:!1,events:function(){return _.extend({},ThriveQuizB.views.ModalSteps.prototype.events,{"click .tqb-quiz-selector":"changeQuizType","click .tqb-modal-submit":"save"})},afterInitialize:function(a){this.quiz_model=a.quiz_model,this.modal_step=a.modal_step,this.edit_mode=a.edit_mode||this.edit_mode,this.listenTo(this.model,"change:type",_.bind(function(){var a=this.types.findWhere({key:this.model.get("type")});this.renderQuizType(a)},this))},afterRender:function(){if(this.steps=this.$el.find(this.stepClass).hide(),this.gotoStep(this.modal_step),this.edit_mode&&this.$el.find(".tqb-modal-prev-step").html(ThriveQuizB.t.cancel),1===this.modal_step&&this.$el.find("#tqb-quiz-type-results-message").html(ThriveQuizB.t.personality_result_change_text),this.$el.find(".tqb-modal-type-action").hide(),this.model.get("type")){var a=this.types.findWhere({key:this.model.get("type")});this.renderQuizType(a)}TVE_Dash.data_binder(this)},changeQuizType:function(b){var c=b.currentTarget,d=a(c).attr("data-type"),e=a(c).attr("data-description"),f=a(c).attr("data-learn-more"),g=a(c).children(".tvd-card"),h=this.$el.find(".tvd-card");TVE_Dash.select_card(g,h),this.$el.find("#tqb-quiz-type-description").html(e+" "+f),ThriveQuizB.util.bind_wistia(),this.model.set("type",d),this.$(".tqb-save").toggleClass("tqb-hide","survey"!==d),this.$(".tqb-continue").toggleClass("tqb-hide","survey"===d)},renderQuizType:function(a){a.get("has_next_step")&&(this.changeNextButton("tqb-modal-submit","tqb-modal-next-step"),this.$el.find(".tqb-modal-type-action").text(ThriveQuizB.t.continue),"number"!==a.get("key")&&'"percentage"'!==a.get("key")||this.model.set("results",new ThriveQuizB.collections.Options([])))},changeNextButton:function(a,b){this.$el.find(".tqb-modal-type-action").show().removeClass(a).addClass(b)},gotoStep:function(a){this.$el.css({height:2===a?"40%":"70%"}),ThriveQuizB.views.ModalSteps.prototype.gotoStep.apply(this,arguments)},prev:function(){if(this.quiz_settings_view&&this.quiz_settings_view.undelegateEvents(),this.edit_mode)return this.close();var a=this.currentStep;switch(this.model.get("type")){case"right_wrong":a=this.currentStep-2;break;case"personality":a=this.currentStep-1;break;case"percentage":case"number":case"survey":a=this.currentStep-3}this.gotoStep(a)},next:function(){if(!this.model.get("type"))return TVE_Dash.err(ThriveQuizB.t.QuizMissingType);var a=this.currentStep;switch(this.model.get("type")){case"right_wrong":a=this.currentStep+2;break;case"personality":a=this.currentStep+1;break;case"percentage":case"number":a=this.currentStep+3}this.gotoStep(a),this.quiz_settings_view=new ThriveQuizB.views.QuizExtraSettings({model:this.model,el:this.$step.find(".tqb-quiz-extra-settings")}),this.quiz_settings_view.render()},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var b=this,c=a(".tqb-edit-quiz-type");TVE_Dash.showLoader(),this.model.get("results").each(function(a){a&&!a.get("text")&&a.destroy()}),this.model.prepareForSave(),this.model.save(null,{success:function(a,d){b.quiz_model.set("type",a.get("type")),b.quiz_model.set("results",new ThriveQuizB.collections.Options(d.returned_results)),b.quiz_model.set("feedback_settings",a.get("feedback_settings")),b.quiz_model.set("highlight_settings",a.get("highlight_settings")),b.quiz_model.structure_set()||c.html(ThriveQuizB.t.change_type);try{var e=ThriveQuizB.globals.quizzes.findWhere({ID:b.quiz_model.get("ID")});e instanceof ThriveQuizB.models.Quiz&&e.set("type",a.get("type"))}catch(f){console.log("Error: "+f)}TVE_Dash.success(d.responseText)},error:function(a,b){TVE_Dash.err(b.responseText)},complete:function(){TVE_Dash.hideLoader(),b.close()}})}}),ThriveQuizB.views.ModalEditQuizStyle=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/edit-quiz-style"),className:"tvd-modal tvd-modal-fixed-footer tqb-choose-quiz-style",events:{"click .tqb-quiz-style-item":"selectStyleItem","click .tvd-modal-submit":"save"},afterRender:function(){var a=this.collection.indexOf(this.collection.findWhere({id:this.model.get("style")}));-1!==a&&this.collection.models.splice(0,0,this.collection.models.splice(a,1)[0]),this.collection.each(this.renderOne,this)},renderOne:function(a){var b=this.model.get("style")===a.get("id"),c=new ThriveQuizB.views.QuizStyleItem({model:a});b&&(this.selected_stye=a.get("id")),this.$("#tqb-quiz-styles-list").append(c.render(b).$el)},selectStyleItem:function(b){var c=a(b.currentTarget),d=c.attr("data-style"),e=c.parent().find(".tqb-card-style-item");TVE_Dash.select_card(c.find(".tvd-card").first(),e),this.selected_stye=d},save:function(){if(this.tvd_clear_errors(),!this.selected_stye)return TVE_Dash.err(ThriveQuizB.t.style_warning);this.model.set("style",this.selected_stye);var a=this,b=new ThriveQuizB.models.QuizStyle({style:this.model.get("style"),quiz_id:this.model.get("ID"),structure:this.model.get("structure")});TVE_Dash.showLoader(),b.save(null,{success:function(b,c){a.model.trigger("tqb_style_changed")},error:function(a,b){},complete:function(){TVE_Dash.hideLoader(),a.close()}})}}),ThriveQuizB.views.ModalAddVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/add-variation"),events:{"click .tvd-modal-submit":"save"},afterRender:function(){this._prepare_translations(),ThriveQuizB.util.data_binder(this)},_prepare_translations:function(){var b=this;this.$(".tqb-translate").each(function(){var c=a(this).html();c=c.replace("%s",b.model.get_name()),a(this).html(c)})},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var a=this;TVE_Dash.showLoader(),this.model.save(null,{success:function(b,c){a.model.trigger("add:parent_post",c),-1!==Backbone.history.getFragment().indexOf("dashboard/page/")?(b.set({id:c.id,tcb_editor_url:c.tcb_editor_url}),a.collection.add(b)):ThriveQuizB.router.navigate("#dashboard/page/"+c.page_id,{trigger:!0})},error:function(a,b){},complete:function(){TVE_Dash.hideLoader(),a.close()}})}}),ThriveQuizB.views.ModalReAddVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/add-variation"),events:{"click .tvd-modal-submit":"save"},afterRender:function(){this._prepare_translations(),ThriveQuizB.util.data_binder(this)},_prepare_translations:function(){var b=this;this.$(".tqb-translate").each(function(){var c=a(this).html();c=c.replace("%s",b.model.get_name()),a(this).html(c)})},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var a=this;TVE_Dash.showLoader(),this.model.save(null,{success:function(b,c){a.model.trigger("add:parent_post",c),b.set({id:c.id,tcb_editor_url:c.tcb_editor_url}),a.page_model.get("variations").add(b)},error:function(a,b){},complete:function(){TVE_Dash.hideLoader(),a.close()}})}}),ThriveQuizB.views.ModalResetVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/reset-variation"),events:{"click .tvd-modal-submit":"reset"},reset:function(){var a=this;TVE_Dash.showLoader(),this.model.resetStatistics({success:function(b){delete b.id,delete b.page_id,delete b.quiz_id,a.model.set(b)},error:function(){},complete:function(){a.close(),TVE_Dash.hideLoader()}},this.model.toJSON())}}),ThriveQuizB.views.ModalResetQuiz=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/reset-quiz-stats"),events:{"click .tvd-modal-submit":"reset"},afterRender:function(){var a=this.$("p"),b=a.html();b=b.replace(/%s/g,this.model.get("post_title")),a.html(b)},reset:function(){var a=this;TVE_Dash.showLoader(),this.model.resetStatistics({success:function(b){TVE_Dash.success(ThriveQuizB.t.quiz_stats_reset),a.collection.trigger("tqb:reset-stats")},error:function(){TVE_Dash.err("Quiz statistics could not be reset")},complete:function(){a.close(),TVE_Dash.hideLoader()}},this.model.toJSON())}}),ThriveQuizB.views.ModalAnonymizeResults=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/anonymize-quiz-results"),events:{"click .tvd-modal-submit":"anonymize"},afterRender:function(){var a=this.$(".tvd-modal-title"),b=a.html();b=b.replace(/%s/g,this.model.get("post_title")),a.html(b)},anonymize:function(){var a=this;TVE_Dash.showLoader(),this.model.anonymizeResults({success:function(b){TVE_Dash.success("Quiz data was anonymized"),a.collection.trigger("tqb:reset-stats")},error:function(){TVE_Dash.err("Quiz data could not be anonymized")},complete:function(){a.close(),TVE_Dash.hideLoader()}},this.model.toJSON())}}),ThriveQuizB.views.ModalArchiveLastVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/archive-last-variation"),afterInitialize:function(a){this.page_model=a.page_model}}),ThriveQuizB.views.ModalArchiveVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/archive-variation"),events:{"click .tvd-modal-submit":"save"},afterInitialize:function(a){this.page_model=a.page_model},save:function(){var a=this,b=this.model.get("is_control");this.model.set({post_status:ThriveQuizB.data.variation_status.archive}),
TVE_Dash.showLoader(),this.model.save(null,{success:function(c,d){1==b&&d.new_control_id&&a.page_model.get("variations").get(d.new_control_id).set({is_control:1}),a.page_model.get("archived_variations").add(c),a.page_model.get("variations").remove(c),TVE_Dash.success(ThriveQuizB.t.archive_variation_success_toast)},error:function(a,b){TVE_Dash.err(ThriveQuizB.t.archive_variation_fail_toast)},complete:function(){TVE_Dash.hideLoader(),a.close()}})}}),ThriveQuizB.views.ModalDeleteVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-variation"),events:{"click .tvd-modal-submit":"delete"},afterRender:function(){this.$el.addClass("tvd-red")},delete:function(){var a=this;TVE_Dash.showLoader(),this.model.destroy({success:function(a,b){TVE_Dash.success(ThriveQuizB.t.delete_variation_success_toast)},error:function(a,b){TVE_Dash.err(ThriveQuizB.t.delete_variation_fail_toast)},complete:function(){TVE_Dash.hideLoader(),a.close()}})}}),ThriveQuizB.views.ModalCopyShortcode=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/copy-quiz-shortcode"),className:"tvd-modal tqb-copy-shortcode-modal",events:{},afterRender:function(){this.bind_zclip()},bind_zclip:function(){TVE_Dash.bindZClip(this.$el.find("a.tvd-copy-to-clipboard"))}}),ThriveQuizB.views.ModalDeleteStructureItem=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-structure-item"),events:{"click .tvd-modal-submit":"delete"},afterRender:function(){var a=this.$(".tqb-has-placeholder"),b=a.html().replace("%s",this.model.get("name"));a.html(b)},delete:function(){this.close(),this.model.trigger("tqb_render_structure_item")}}),ThriveQuizB.views.ModalDeleteRedirectLink=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/delete-redirect-link"),events:{"click .tvd-modal-submit":"delete"},afterRender:function(){var a=this.$(".tqb-has-placeholder"),b=a.html().replace("%s",this.data.model.get("lower_bound")+" - "+this.data.model.get("upper_bound"));a.html(b)},delete:function(){this.close(),this.model.destroy(),this.data.itemView.remove()}}),ThriveQuizB.views.ModalEditVariationTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/edit-variation-test"),events:{"click .tve-edit-variation-test":"saveTest","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal","change #tve-enable-test-settings":"toggleAutoWinSettings"},checkMinimumConversions:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<100?this.$el.find(".tve_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tve_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<7?this.$el.find(".tve_duration_notice").removeClass("tvd-hide"):this.$el.find(".tve_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(a){var b=jQuery(a.currentTarget);parseFloat(b.val())<90?this.$el.find(".tve_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tve_beat_original_notice").addClass("tvd-hide")},saveTest:function(a){var b=this;if(this.model.set("auto_win_enabled",this.$el.find("input[name='auto_win_enabled']").is(":checked")),this.model.set("auto_win_min_conversions",this.$el.find('input[name="auto_win_min_conversions"]').val()),this.model.set("auto_win_min_duration",this.$el.find('input[name="auto_win_min_duration"]').val()),this.model.set("auto_win_chance_original",this.$el.find('input[name="auto_win_chance_original"]').val()),this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);this.model.trigger("auto_win_changed"),TVE_Dash.showLoader(),this.model.save({},{success:function(){b.close(),TVE_Dash.hideLoader()}})},toggleAutoWinSettings:function(a){jQuery(a.currentTarget).is(":checked")?this.$el.find(".tve-winner-settings-input").show(0):this.$el.find(".tve-winner-settings-input").hide(0)}}),ThriveQuizB.views.ModalStopVariation=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/stop-variation"),className:"tvd-modal tvd-red",events:{"click .tqb-stop-test-variation-action":"stopVariation"},initialize:function(){},stopVariation:function(a){var b=this;location.hash="#dashboard/test/"+b.model.get("test_id")+"/stop",TVE_Dash.showLoader(),b.model.set("active",0),b.model.save(null,{success:function(a,c){2==b.collection.length?ThriveQuizB.router.navigate("#dashboard/page/"+b.collection.first().get("page_id"),{trigger:!0}):ThriveQuizB.router.navigate("#dashboard/test/"+b.model.get("test_id"),{trigger:!0})},error:function(){location.hash="#dashboard/test/"+b.model.get("test_id"),TVE_Dash.err(ThriveQuizB.t.stopVariationFailToast)},complete:function(){b.close(),TVE_Dash.hideLoader()}})}}),ThriveQuizB.views.ModalStopVariationTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/stop-variation-test"),afterRender:function(){this.$el.addClass("tvd-stop-test-modal");var a=this.$el.find("#tqb-stop-variation"),b=this,c=b.collection.getHighestRateItem();return a.empty(),this.collection.each(function(d){d.set("show_graph",!1),d.on("tqb_close_modal",function(){b.close()});var e=new ThriveQuizB.views.TestItem({model:d,highest_id:c,page_id:b.model.get("page_id")});a.append(e.render().el)}),this}}),ThriveQuizB.views.ModalDeleteTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("tests/delete-test"),events:{"click .tve-confirm-delete-test":"deleteTest"},afterInitialize:function(a){this.$el.addClass("tvd-red")},deleteTest:function(a){var b=this;TVE_Dash.showLoader(),this.model.destroy({success:function(){b.model.trigger("tqb_test_removed"),TVE_Dash.success(ThriveQuizB.t.deleteTestToast)},error:function(){},complete:function(){b.close(),TVE_Dash.hideLoader()}})}}),ThriveQuizB.views.ModalVariationTest=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/variation-start-test"),className:"tvd-modal",events:{"click .tqb-toggle-dropdown":"toggleSettings","click .tqb-start-variation-test":"saveTest","change #tqb-enable-test-settings":"toggleAutoWinSettings","blur #auto_win_min_conversions":"checkMinimumConversions","blur #auto_win_min_duration":"checkMinimumDuration","blur #auto_win_chance_original":"checkChanceToBeatOriginal"},checkMinimumConversions:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<100?this.$el.find(".tqb_engagements_notice").removeClass("tvd-hide"):this.$el.find(".tqb_engagements_notice").addClass("tvd-hide")},checkMinimumDuration:function(a){var b=jQuery(a.currentTarget);parseInt(b.val())<7?this.$el.find(".tqb_duration_notice").removeClass("tvd-hide"):this.$el.find(".tqb_duration_notice").addClass("tvd-hide")},checkChanceToBeatOriginal:function(a){var b=jQuery(a.currentTarget);parseFloat(b.val())<90?this.$el.find(".tqb_beat_original_notice").removeClass("tvd-hide"):this.$el.find(".tqb_beat_original_notice").addClass("tvd-hide")},toggleSettings:function(){var a=this.$el.find("#tqb-winner-test-container");this.$el.find("#tqb-winner-test-settings");a.is(":visible")?a.hide(0):a.fadeIn("fast")},toggleAutoWinSettings:function(a){jQuery(a.currentTarget).is(":checked")?this.$el.find(".tqb-winner-settings-input").show(0):this.$el.find(".tqb-winner-settings-input").hide(0)},saveTest:function(a){var b=this;if(this.model.set("title",this.$el.find('input[name="test_title"]').val()),this.model.set("notes",this.$el.find('textarea[name="test_notes"]').val()),this.model.set("conversion_goal",this.$el.find('input[name="conversion_goal"]:checked').val()),this.model.set("auto_win_enabled",this.$el.find("input[name='auto_win_enabled']").is(":checked")),this.model.set("auto_win_min_conversions",this.$el.find('input[name="auto_win_min_conversions"]').val()),this.model.set("auto_win_min_duration",this.$el.find('input[name="auto_win_min_duration"]').val()),this.model.set("auto_win_chance_original",this.$el.find('input[name="auto_win_chance_original"]').val()),this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);this.model.trigger("auto_win_changed"),TVE_Dash.showLoader(),this.model.save(null,{success:function(a,c){ThriveQuizB.router.navigate("#dashboard/test/"+c,{trigger:!0}),b.close(),TVE_Dash.hideLoader()}})}}),ThriveQuizB.views.ModalBadgeTemplates=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/badge-templates"),className:"tvd-modal tvd-modal-fixed-footer",events:{"click .tvd-modal-submit":"set_template"},afterInitialize:function(){this.badge_templates=ThriveQuizB.globals.badge_templates},afterRender:function(){var a=this,b=this.$("#tqb-badge-templates-list");this.badge_templates.each(function(c,d,e){var f=new ThriveQuizB.views.BadgeTemplateItem({model:c,collection:a.badge_templates});b.append(f.render().$el)})},set_template:function(){var a=this.badge_templates.findWhere({selected:!0});if(!a)return TVE_Dash.err(ThriveQuizB.t.no_badge_template_selected);var b=this,c=new ThriveQuizB.models.ThriveImage({post_parent:ThriveQuizB.globals.quiz.get("ID"),template:a.get("key")});TVE_Dash.showLoader(),c.save(null,{wait:!0,success:function(a,c,d){b.collection.push(a),TVE_Dash.hideLoader(),window.location=a.get("editor_url")},error:function(a,b,c){TVE_Dash.err(b.responseJSON.data.message),TVE_Dash.hideLoader()},complete:function(){b.close()}})}}),ThriveQuizB.views.ModalViewUserAnswers=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/view-user-answers"),afterRender:function(){var a=this.$el.find("#tqb-user-quiz-answers-list");return a.empty(),this.collection.each(function(b){var c=new ThriveQuizB.views.UserQuestion({model:b});a.append(c.render().el)}),this}}),ThriveQuizB.views.ModalSettings=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/settings"),events:{"click .tqb-setting-checkbox":"checkCheckboxValue","click .tvd-modal-submit":"save_settings"},afterInitialize:function(){this.model=new ThriveQuizB.models.Settings(ThriveQuizB.data.settings)},checkCheckboxValue:function(b){var c=a(b.currentTarget),d={};d[c.attr("data-key")]=Number(c[0].checked),this.model.set(d)},save_settings:function(){var a=this;TVE_Dash.showLoader(),this.model.save(null,{success:function(a,b){ThriveQuizB.data.settings=b},complete:function(){TVE_Dash.hideLoader(),a.close()}})}}),ThriveQuizB.views.QuizSettings=TVE_Dash.views.Modal.extend({className:"tvd-modal tqb-feedback-modal",template:TVE_Dash.tpl("modals/quiz/settings"),events:{"click .tqb-modal-submit":"save"},afterRender:function(){new ThriveQuizB.views.QuizExtraSettings({el:this.getSettingEl(),model:this.model}).render()},getSettingEl:function(){var a=null;switch(this.model.get("type")){case"right_wrong":a=this.$(".tqb-quiz-settings-right-wrong");break;case"personality":a=this.$(".tqb-quiz-settings-personality");break;default:a=this.$(".tqb-quiz-settings")}return a},save:function(){if(this.tvd_clear_errors(),!this.model.isValid())return this.tvd_show_errors(this.model);var a=this;TVE_Dash.showLoader(),this.model.prepareForSave(),this.model.save(null,{success:function(b,c){a.quiz_model.set("type",b.get("type")),a.quiz_model.set("results",new ThriveQuizB.collections.Options(c.returned_results)),a.quiz_model.set("feedback_settings",b.get("feedback_settings")),a.quiz_model.set("highlight_settings",b.get("highlight_settings")),TVE_Dash.success(c.responseText)},error:function(a,b){TVE_Dash.err(b.responseText)},complete:function(){TVE_Dash.hideLoader(),a.close()}})}}),ThriveQuizB.views.ModalExportQuiz=TVE_Dash.views.Modal.extend({className:"tvd-modal tqb-export-modal",template:TVE_Dash.tpl("modals/quiz/export"),events:{"click .tqb-cancel-export":"cancelExport","click #tqb-download-export":"close"},canceled:!1,process:null,afterInitialize:function(){this.process=this.startExport()},afterRender:function(){this.$(".tvd-modal-close-x").hide(),this.process.then(_.bind(this.exportQuizDetails,this)).then(_.bind(this.exportQuizQuestions,this)).then(_.bind(this.exportQuizBadge,this)).then(_.bind(this.exportQuizResultLinks,this)).then(_.bind(this.exportQuizStructure,this)).then(_.bind(this.exportFinished,this)).catch(_.bind(this.exportFailed,this)),this.$console=this.$("#tqb-export-console"),this.$btnDownload=this.$("#tqb-download-export"),this.$btnCancel=this.$(".tqb-cancel-export")},startExport:function(){var a={action:"tqb_admin_ajax_controller",route:"export_quiz",quiz_id:this.model.get("ID")};return Promise.resolve(a)},exportQuizDetails:function(a){return this.pushMessage("Exporting quiz details..."),a.step="details",this.doAjax(a)},exportQuizQuestions:function(a){return this.model.hasQuestions()&&this.pushMessage("Exporting quiz questions..."),a.step="questions",this.doAjax(a)},exportQuizBadge:function(a){return this.model.hasBadge()&&this.pushMessage("Exporting quiz badge..."),a.step="badge",this.doAjax(a)},exportQuizStructure:function(a){return this.pushMessage("Exporting quiz structure..."),a.step="structure",a.last_step=1,this.doAjax(a)},exportQuizResultLinks:function(a){return this.model.hasResultLinks()&&this.pushMessage("Exporting quiz result links..."),a.step="resultlinks",this.doAjax(a)},exportFinished:function(a){this.$btnDownload.show(),this.$btnDownload.attr("href",a.zip.url),this.$btnCancel.attr("disabled",!0),this.$(".tvd-modal-close-x").show()},exportFailed:function(a){a=_.extend({message:"Export failed"},a),this.$(".tvd-modal-close").show(),this.$btnCancel.hide(),this.pushMessage(a.message)},cancelExport:function(){this.canceled=!0,this.pushMessage("Canceling export process..."),this.close()},pushMessage:function(b){this.$console.append(a("<p/>").html(b))},doAjax:function(b){return new Promise(function(c,d){var e=b,f=ThriveQuizB.util.ajaxurl();a.ajax({url:f,data:e,type:"post"}).done(function(a){a.zip&&c(a),c(b)}).fail(function(a){d({message:a.responseJSON.message||"Export failed"})})})},beforeClose:function(){var a={action:"tqb_admin_ajax_controller",quiz_id:this.model.get("ID"),step:"clearexport",route:"export_quiz"};this.doAjax(a)}}),ThriveQuizB.views.ModalImportQuiz=TVE_Dash.views.Modal.extend({template:TVE_Dash.tpl("modals/quiz/import"),$dropArea:null,fileList:null,events:{"drop #tqb-drop-area":function(a){a.preventDefault(),this.fileList=a.dataTransfer.files,this.handleFile()},"dragover #tqb-drop-area":function(a){a.preventDefault()},"dragleave #tqb-drop-area":function(a){a.preventDefault()},"click .tqb-drop-blue":function(a){a.preventDefault(),this.$("#tqb-file-input").click()},"change #tqb-file-input":function(a){this.fileList=a.currentTarget.files,this.handleFile()},"click .tqb-modal-submit":function(){if(!0===this.validateFile()){TVE_Dash.showLoader();var b=new FormData,c=this;b.append("tqb_quiz_file",this.fileList.item(0)),b.append("action","tqb_admin_ajax_controller"),b.append("route","import_quiz");var d=ThriveQuizB.util.ajaxurl();a.ajax({url:d,data:b,type:"post",cache:!1,dataType:"json",processData:!1,contentType:!1}).done(function(a){a.quiz_id?(ThriveQuizB.shown_quizzes.order.push(a.quiz_id),ThriveQuizB.shown_quizzes.visible[a.quiz_id]=!0,ThriveQuizB.router.navigate("#dashboard/quiz/"+a.quiz_id,{trigger:!0}),TVE_Dash.success(a.message)):TVE_Dash.err(a.message),TVE_Dash.hideLoader(),c.close()}).fail(function(a){c.$(".tqb-state").hide(),c.$(".tqb-initial-state").show(),TVE_Dash.err(a.responseJSON.message),TVE_Dash.hideLoader()})}}},afterInitialize:function(){jQuery.event.props.push("dataTransfer")},afterRender:function(){this.$dropArea=this.$("#tqb-drop-area")},handleFile:function(){this.isZip()&&(this.$(".tqb-state").hide(),this.$(".tqb-ready-state").html('<span class="tqb-import-title">'+this.fileList.item(0).name+"</span>").show())},validateFile:function(){return!!(this.fileList&&this.fileList.length&&this.isZip())||(TVE_Dash.err(ThriveQuizB.t.invalid_import_file),!1)},isZip:function(){var a=this.fileList.item(0);return"object"==typeof a&&a.type&&("application/x-zip-compressed"===a.type||"application/zip"===a.type)}})})}(jQuery);var ThriveQuizB=ThriveQuizB||{};ThriveQuizB.util=ThriveQuizB.util||{},_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},Backbone.ajax=function(){return-1===arguments[0].url.indexOf("_nonce")&&(arguments[0].url+="&_nonce="+ThriveQuizB.admin_nonce),Backbone.$.ajax.apply(Backbone.$,arguments)},function(a){window.addEventListener("message",function(b){b.data.event&&"tqb_question_counter_update"==b.data.event&&(0==parseInt(a(".tqb-questions-number").text())||0==b.data.number?ThriveQuizB.globals.EditedQuiz.view.model.fetch({success:function(){ThriveQuizB.globals.EditedQuiz.view.render()}}):a(".tqb-questions-number").html(b.data.number))},!1),ThriveQuizB.util.states={normal:"normal",delete:"delete"},ThriveQuizB.util.bind_wistia=function(){window.rebindWistiaFancyBoxes&&window.rebindWistiaFancyBoxes()},ThriveQuizB.util.structure_items={splash:{name:ThriveQuizB.t.splash_name,mandatory:!1},qna:{name:ThriveQuizB.t.qna_name,mandatory:!0},optin:{name:ThriveQuizB.t.optin_name,mandatory:!1},results:{name:ThriveQuizB.t.results_name,mandatory:!0}},ThriveQuizB.util.ajaxurl=function(a){var b=-1!==ajaxurl.indexOf("?")?"&":"?";return a&&a.length?(a=a.replace(/^(\?|&)/,""),a+="&_nonce="+ThriveQuizB.admin_nonce,ajaxurl+b+a):ajaxurl+b+"_nonce="+ThriveQuizB.admin_nonce},ThriveQuizB.util.setLoading=function(a){a.addClass("tvd-disabled"),a.prepend('<span class="tvd-icon-spinner mdi-pulse tvo-small-icon tvd-margin-right-small"></span>')},ThriveQuizB.util.removeLoading=function(a){a.removeClass("tvd-disabled"),a.find(".tvd-icon-spinner").remove()},ThriveQuizB.util.showHideNoQuizInfo=function(){ThriveQuizB.globals.quizzes.length?a(".tqb-no-quiz-wrapper").hide():a(".tqb-no-quiz-wrapper").show()},ThriveQuizB.util.roundNumber=function(a,b){var c=Math.pow(10,b);return Math.round(a*c)/c},ThriveQuizB.util.createInitialStructureObject=function(a){var b={},c={},d=null;return Object.keys(ThriveQuizB.data.quiz_structure_item_types).forEach(function(e,f){d=ThriveQuizB.data.quiz_structure_item_types[e].key,void 0!==a[d]&&(c=a[d],c.key=d,b[e]=c)}),b},ThriveQuizB.util.data_binder=function(b,c){function d(a){return a.is(":checkbox")?!!a.is(":checked"):a.is(":radio")?a.is(":checked")?a.val():"":a.val()}function e(a,c){return a.is(":radio")?b.$el.find('input[name="'+a.attr("name")+'"]:radio').filter('[value="'+c+'"]').prop("checked",!0):a.is(":checkbox")?a.prop("checked",!!c):a.val(c)}if(void 0===c&&(c=b.model),!(!c instanceof Backbone.Model)){var f=b.$el.find("[data-bind]").each(function(){var f=a(this),g=f.attr("data-bind"),h=!1;f.on("change",function(){var a=d(f);c.get(g)!=a&&(h=!0,c.set(g,a),h=!1)}),b.listenTo(c,"change:"+g,function(){h||e(f,this.model.get(g))})});b.listenTo(c,"invalid",function(a,b){_.isArray(b)?_.each(b,function(a){var b=a;a.field&&(b=a.field);var c=f.filter('[data-bind="'+b+'"]').first().addClass("tvd-validate tvd-invalid").focus();a.message&&c.siblings("label").attr("data-error",a.message),(c.is(":radio")||c.is(":checkbox"))&&TVE_Dash.err(c.next("label").attr("data-error"))}):_.isString(b)&&TVE_Dash.err(b)})}}}(jQuery);var ThriveQuizB=ThriveQuizB||{};ThriveQuizB.globals=ThriveQuizB.globals||{},function(a){var b=Backbone.Router.extend({view:null,$el:a("#tqb-admin-dashboard-wrapper"),routes:{dashboard:"dashboard","dashboard/quiz/:id":"quizEdit","purge-cache":"purgeCache","reports(/:id)":"reports","reports(/:id)(/:type)":"reports","dashboard/page/:id/redirect-settings":"redirectSettings","dashboard/page/:id(/:is_default)":"editQuizPages","dashboard/test/:id":"editQuizPageTest"},breadcrumbs:{col:null,view:null},init_breadcrumbs:function(){this.breadcrumbs.col=new ThriveQuizB.collections.Breadcrumbs,this.breadcrumbs.view=new ThriveQuizB.views.Breadcrumbs({collection:this.breadcrumbs.col})},set_page:function(b,c,d){this.breadcrumbs.col.reset(),d=d||{},this.breadcrumbs.col.add_page(ThriveQuizB.dash_url,ThriveQuizB.t.Thrive_Dashboard,!0),_.each(d,_.bind(function(a){this.breadcrumbs.col.add_page(a.route,a.label)},this)),this.breadcrumbs.col.add_page("",c);var e=a("head > title");this.original_title||(this.original_title=e.html()),e.html(c+" &lsaquo; "+this.original_title)},dashboard:function(){function b(){c.view=new ThriveQuizB.views.Dashboard({collection:ThriveQuizB.globals.quizzes}),c.$el.html(c.view.render().$el),ThriveQuizB.util.bind_wistia(),ThriveQuizB.util.showHideNoQuizInfo(),ThriveQuizB.globals.quizzes.length<ThriveQuizB.quizzes_details.max_quiz_number&&a("#tqb-no-search-result, .tqb-load-more-section").hide()}this.set_page("dashboard",ThriveQuizB.t.Dashboard);var c=this;if(TVE_Dash.showLoader(),this.view&&this.view.remove(),ThriveQuizB.globals.quizzes.length)return b();ThriveQuizB.globals.quizzes.fetch({update:!0,success:b,error:function(a,b,c){TVE_Dash.err(ThriveQuizB.t.error_fetching_quizzes,1e4),TVE_Dash.hideLoader()}})},reports:function(a,b){if(!a)if(this.view&&this.view.model)a=this.view.model.get("ID");else{var c=ThriveQuizB.globals.quizzes.first();a=c instanceof ThriveQuizB.models.Quiz?c.get("ID"):null}if(!b)return this.navigate("#reports/"+a+"/completions",{trigger:!0});this.set_page("reports",ThriveQuizB.t.Reporting,[{route:"dashboard",label:ThriveQuizB.t.Dashboard}]),TVE_Dash.showLoader(),this.view&&this.view.remove(),this.view=new ThriveQuizB.views.Reporting({model:new ThriveQuizB.models.Reporting({selected:a}),collection:new ThriveQuizB.collections.ReportQuizzes,report_type:b}),this.$el.html(this.view.render().$el),TVE_Dash.hideLoader()},quizEdit:function(b){if(this.view&&this.view.remove(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),a(".tvd-material-tooltip").hide(),!b)return void ThriveQuizB.router.navigate("#dashboard",{trigger:!0});ThriveQuizB.globals.EditedQuiz=this;var c=this,d=new ThriveQuizB.models.Quiz({ID:b});TVE_Dash.showLoader(),d.fetch({cache:!1,success:function(a,b,d){ThriveQuizB.globals.quiz=a,c.view=new ThriveQuizB.views.EditQuiz({model:a}),c.$el.html(c.view.render().$el),c.set_page("dashboard/quiz",a.get("post_title"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard}]),a.on("change:post_title",function(){c.set_page("dashboard/quiz",a.get("post_title"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard}])}),TVE_Dash.hideLoader()}}).error(function(a){TVE_Dash.err(a.responseText),TVE_Dash.hideLoader(),ThriveQuizB.router.navigate("#dashboard",{trigger:!0})})},editQuizPageTest:function(b){if(this.view&&this.view.remove(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),a(".tvd-material-tooltip").hide(),!b)return void ThriveQuizB.router.navigate("#dashboard",{trigger:!0});var c=this,d=new ThriveQuizB.models.Test({id:b});TVE_Dash.showLoader(),d.fetch({success:function(a,b,d){a&&(a.set("status",Number(a.get("status"))),c.view=new ThriveQuizB.views.QuizPageTest({model:a,completed_tests:new ThriveQuizB.collections.Tests(a.get("completed_tests"))}),c.$el.html(c.view.$el),c.view.render(),c.set_page("dashboard/page",a.get("title"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard},{route:"dashboard/quiz/"+a.get("quiz_id"),label:a.get("quiz_name")}])),TVE_Dash.hideLoader()}}).error(function(a){TVE_Dash.err(a.responseText),TVE_Dash.hideLoader(),ThriveQuizB.router.navigate("#dashboard",{trigger:!0})})},editQuizPages:function(b,c){if(this.view&&this.view.remove(),TVE_Dash.opened_modal_view&&TVE_Dash.opened_modal_view.close(),a(".tvd-material-tooltip").hide(),!b)return void ThriveQuizB.router.navigate("#dashboard",{trigger:!0});var d=this,e=new ThriveQuizB.models.Page({ID:b});TVE_Dash.showLoader(),e.fetch({data:{viewed:!0},success:function(a,b,e){c&&a.set("is_default",!0),d.view=new ThriveQuizB.views.QuizPageVariations({model:a,completed_tests:new ThriveQuizB.collections.Tests(a.get("completed_tests"))}),d.$el.html(d.view.render().$el),d.set_page("dashboard/page",a.get("tqb_page_name"),[{route:"dashboard",label:ThriveQuizB.t.Dashboard},{route:"dashboard/quiz/"+a.get("post_parent"),label:a.get("quiz_name")}]),TVE_Dash.hideLoader()}}).error(function(a){TVE_Dash.err(a.responseText),TVE_Dash.hideLoader(),ThriveQuizB.router.navigate("#dashboard",{trigger:!0})})},redirectSettings:function(b){if(this.view&&this.view.remove(),TVE_Dash.showLoader(),a(".tvd-material-tooltip").hide(),!b)return ThriveQuizB.router.navigate("#dashboard",{trigger:!0});this.view=new ThriveQuizB.views.ResultsSettings,new ThriveQuizB.models.ResultsSettings({ID:b}).fetch({success:_.bind(function(a){this.view.model=a,this.$el.html(this.view.render().$el),this.set_page("dashboard/page",ThriveQuizB.t.redirect_settings,[{route:"dashboard",label:ThriveQuizB.t.Dashboard},{route:"dashboard/quiz/"+a.get("post_parent"),label:a.get("quiz_name")}])},this),error:_.bind(function(a,b){TVE_Dash.err(b.responseText)},this)}).always(function(){TVE_Dash.hideLoader()})},purgeCache:function(){TVE_Dash.showLoader(),a.ajax({type:"post",url:ajaxurl,dataType:"json",data:{action:"tqb_admin_ajax_controller",route:"settings",custom:"purge_cache",_nonce:ThriveQuizB.admin_nonce}}).done(_.bind(function(a){ThriveQuizB.globals.quizzes.reset(a),this.navigate("#dashboard",{trigger:!0})},this)).always(function(){TVE_Dash.hideLoader()})}});a(function(){ThriveQuizB.globals.quizzes=new ThriveQuizB.collections.Quizzes(ThriveQuizB.data.quizzes),ThriveQuizB.globals.badge_templates=new ThriveQuizB.collections.BadgeTemplates(ThriveQuizB.badge_templates),ThriveQuizB.router=new b,ThriveQuizB.router.init_breadcrumbs(),Backbone.history.stop(),Backbone.history.start({hashchange:!0}),Backbone.history.fragment||ThriveQuizB.router.navigate("#dashboard",{trigger:!0})})}(jQuery);var ThriveQuizB=ThriveQuizB||{};!function(){ThriveQuizB.LineChart=Backbone.Model.extend({defaults:function(){return{id:"",title:"",renderTo:"",type:"line",data:[]}},initialize:function(){var a=this.get("title"),b=this.get("type"),c=this.get("renderTo"),d=this.get("legend");this.chart=this.dochart(a,b,c,d)},redraw:function(){var a=this.get("title"),b=this.get("data"),c=this.get("x_axis"),d=this.get("y_axis"),e=[],f=this.get("x_axis").length;for(var g in b){e.push(b[g].id);var h=this.chart.get(b[g].id);h&&null!==h?h.setData(b[g].data):this.chart.addSeries(b[g],!1,!1)}for(var g=0;g<this.chart.series.length;g++)e.indexOf(this.chart.series[g].options.id)<0&&(this.chart.series[g].remove(!1),g--);this.chart.get("time_interval").setCategories(c),this.chart.xAxis[0].update({tickInterval:f>13?Math.ceil(f/13):1}),this.chart.setTitle({text:a}),this.chart.yAxis[0].axisTitle&&this.chart.yAxis[0].axisTitle.attr({text:d}),this.chart.redraw(),this.chart.hideLoading()},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},dochart:function(a,b,c,d){var e={};return d&&(e={layout:"vertical",backgroundColor:"#FFFFFF",align:"right",verticalAlign:"top",floating:!1,y:75,x:-50}),new Highcharts.Chart({chart:{type:b,renderTo:c,style:{fontFamily:"Open Sans,sans-serif"}},colors:ThriveQuizB.chart_colors,yAxis:{allowDecimals:!1,title:{text:"Conversions"},min:0},xAxis:{id:"time_interval"},credits:{enabled:!1},title:{text:a},legend:e,tooltip:{shared:!1,useHTML:!0,formatter:function(){return"scatter"!=this.series.type&&this.x+"<br/>"+this.series.name+": <b>"+this.y+"</b>"}},plotOptions:{series:{dataLabels:{shape:"callout",backgroundColor:"rgba(0, 0, 0, 0.75)",style:{color:"#FFFFFF",textShadow:"none"}},events:{legendItemClick:function(){"scatter"==this.type&&(this.visible?jQuery(".highcharts-data-labels").hide():jQuery(".highcharts-data-labels").show())}}}}})}}),ThriveQuizB.PieChart=Backbone.Model.extend({defaults:function(){return{id:"",title:"",data:[]}},initialize:function(){var a=this.get("title");this.get("data");this.chart=this.dopie(a)},redraw:function(){var a=this.get("title"),b=this.get("data");this.get("x_axis");this.chart.series[0].setData(b),this.chart.setTitle(a),this.chart.redraw(),this.chart.hideLoading()},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},dopie:function(a){return new Highcharts.Chart({chart:{renderTo:"tve-report-chart",plotBackgroundColor:null,plotBorderWidth:null,plotShadow:!1},colors:ThriveQuizB.chart_colors,credits:{enabled:!1},title:{text:a},plotOptions:{pie:{allowPointSelect:!1,cursor:"default",showInLegend:!0,dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %",style:{color:Highcharts.theme&&Highcharts.theme.contrastTextColor||"black"}}}},tooltip:{formatter:function(){return this.key+": "+parseInt(this.y)}},series:[{type:"pie",name:a}]})}}),ThriveQuizB.Pie3DChart=Backbone.Model.extend({defaults:function(){return{id:"",data:[],colors:[]}},initialize:function(){var a=this.get("renderTo"),b=this.get("data"),c=[];this.get("total");b.forEach(function(a,b){if(a.percent>0){var d={};d.name=a.image.url?'<img src="'+a.image.url+'" height="30" width="30"/>':a.text,d.y=a.percent,d.color=a.color,c.push(d)}}),this.doChart(c,a)},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},doChart:function(a,b){return new Highcharts.Chart({tooltip:{pointFormat:"<b>{point.percentage:.1f}%</b>",useHTML:!0},legend:{enabled:!1},chart:{renderTo:b,type:"pie",options3d:{enabled:!0,alpha:25,beta:0}},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:35,showInLegend:!1,dataLabels:{enabled:!1}}},title:{text:""},series:[{type:"pie",data:a}]})}}),ThriveQuizB.BarChart=Backbone.Model.extend({defaults:function(){return{id:"",data:[],colors:[]}},initialize:function(){var a=this.get("renderTo"),b=this.get("data"),c=this.get("colors"),d=0,e=100,f=100;for(var g in b)b[g][0]<e&&(e=b[g][0]),b[g][b[g].length-1]>d&&(d=b[g][b[g].length-1]),(b[g][b[g].length-1]-b[g][0])/2<f&&(f=(b[g][b[g].length-1]-b[g][0])/2);e=e>f/3?e-f/3:0,d+=f/3;for(var g in b){for(var h,i=[],j=1;j<b[g].length;j++)i.push({data:[{low:b[g][j-1],high:b[g][j]}]});h=(b[g][0]+b[g][b[g].length-1])/2,this.doChart(i,h,e,d,c[g],a+"-"+g)}},showLoading:function(){this.chart.showLoading()},hideLoading:function(){this.chart.hideLoading()},doChart:function(a,b,c,d,e,f){return new Highcharts.Chart({chart:{renderTo:f,type:"columnrange",inverted:!0,height:50,width:240,spacing:[10,10,10,10]},colors:e,plotOptions:{columnrange:{grouping:!1}},title:{text:""},xAxis:{title:{text:""},labels:{enabled:!1},lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},yAxis:{title:{text:""},labels:{enabled:!1},plotLines:[{color:"#000000",value:b,width:1,zIndex:100}],min:c,max:d,lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},legend:{enabled:!1},credits:{enabled:!1},tooltip:{enabled:!1},series:a})}})}();