/*! Thrive Quiz Builder - 2022-01-25
* http://www.thrivethemes.com/
* Copyright (c) 2022 Thrive Themes */
function isScrolling(){return window.tqbLastScrollTime&&(new Date).getTime()<window.tqbLastScrollTime+100}function isFirefox(){return navigator.userAgent.toLowerCase().indexOf("firefox")>-1}var ThriveQuizB=ThriveQuizB||{};ThriveQuizB.views=ThriveQuizB.views||{},ThriveQuizB.flows=ThriveQuizB.flows||{},function(a){"ontouchstart"in document.documentElement||(document.documentElement.className+=" no-touch"),ThriveQuizB.loadedShortcodes=[],ThriveQuizB.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},ThriveQuizB.ajaxurl=function(a){var b=-1!==TQB_Front.ajax_url.indexOf("?")?"&":"?";return a&&a.length?(a=a.replace(/^(\?|&)/,""),a+="&_nonce="+TQB_Front.nonce,a+="&tqb-post-id="+TQB_Front.post_id,TQB_Front.ajax_url+b+a):TQB_Front.ajax_url+b+"_nonce="+ThriveQuizB.admin_nonce},ThriveQuizB.tpl=function(b,c){var d=a("script#"+b.replace(/\//g,"-")).html()||"";return d=d.replace(/(\n|\t|\r)/g,""),c?_.template(d,ThriveQuizB.templateSettings)(c):_.template(d,ThriveQuizB.templateSettings)},ThriveQuizB.getQueryParams=function(){var a=window.location.search||"",b={};if(a=a.substr(1),window.tqb_restart_quiz&&(b.restart_quiz=1),!a.length)return b;var c=a.split("&");return _.each(c,function(a){var c=a.split("=")[0];c&&(b[c]=decodeURIComponent(a.split("=")[1]))}),b},a.fn.tqb=function(b,c){function d(a,b){void 0!==b&&b.lazy_load_conditional_preview&&tcb_condition_sets&&(tcb_condition_sets=tcb_condition_sets.concat(b.lazy_load_conditional_preview));var c=new ThriveQuizB.collections.Shortcodes;Object.keys(a).forEach(function(b){TQB_Front.quiz_options[a[b].quiz_id]={feedback_settings:a[b].feedback_settings,highlight_settings:a[b].highlight_settings,progress_settings:a[b].progress_settings,scroll_settings:a[b].scroll_settings,quiz_style:a[b].quiz_style},a[b].id=b;var d=new ThriveQuizB.models.Shortcode(a[b]);c.add([d])}),ThriveQuizB.shortcode_list&&ThriveQuizB.shortcode_list.destroy(),ThriveQuizB.shortcode_list=new ThriveQuizB.views.ShortcodeList({collection:c}),ThriveQuizB.shortcode_list.render()}function e(){return _.extend({},{quiz_ids:b,tqb_scripts_loaded:!0},ThriveQuizB.getQueryParams())}function f(){window.TVE_Dash&&TVE_Dash.add_load_item("tqb_lazy_load",e(),d)}if(b||(b={}),c=c||!1,window.TQB_Front=window.TQB_Front||window.TQB_Front_Ajax||null,window.TQB_Front)return a.each(b,function(a,c){-1!==ThriveQuizB.loadedShortcodes.indexOf(a)&&delete b[a],ThriveQuizB.loadedShortcodes.push(a)}),0!==Object.keys(b).length&&(!0===c?void ThriveGlobal.$j.ajax({url:TQB_Front.ajax_url,type:"get",data:_.extend(e(),{route:"get_quiz_data"})}).done(d):void(window.TVE_Dash&&!TVE_Dash.ajax_sent?a(document).on("tve-dash.load",function(a){f()}):f()))},a(function(){var b=a(this);ThriveGlobal.$j(document).on("tqb_quiz_loaded",function(c,d){var e={};_.each([d.quiz_id],function(b){var c=a("[data-quiz-id="+b+"]"),d=c.attr("data-unique");e[d]=c.attr("data-quiz-id")}),b.tqb(e,!0)});var c={};a(".tqb-shortcode-wrapper").each(function(b){var d=a(this).attr("data-quiz-id"),e=a(this).attr("data-unique");c[e]=d}),b.tqb(c)})}(jQuery);var ThriveQuizB=ThriveQuizB||{};ThriveQuizB.models=ThriveQuizB.models||{},ThriveQuizB.collections=ThriveQuizB.collections||{},function(a){a(function(){ThriveQuizB.models.Base=Backbone.Model.extend({idAttribute:"ID",validation_error:function(a,b){return{field:a,message:b}},custom_action:function(a,b,c){b||(b={});var d=_.extend({type:"post",dataType:"json",url:this.url()+"&custom_action="+c,data:b},a);return jQuery.ajax(d)}}),ThriveQuizB.collections.Base=Backbone.Collection.extend({last:function(){return this.at(this.size()-1)}}),ThriveQuizB.models.Shortcode=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,quiz_id:null,user_unique:null,page_type:"",page:{page_id:null,variation_id:null,html:"",css:"",fonts:""},question:null},url:function(){return ThriveQuizB.ajaxurl("&route=shortcode")},logSocialShareConversion:function(a,b){this.custom_action(a,b,"log_social_share_conversion")},saveUserCustomSocialShareBadge:function(a,b){this.custom_action(a,b,"save_user_custom_social_share_badge")},initialize:function(a){this.set("results_settings",new ThriveQuizB.models.ResultsSettings(a.results_settings||{}))},has_optin_page:function(){return this.get("structure")&&this.get("structure").optin},tpl:function(b){var c=this.get("tve_qna_templates");return c=c&&c[this.get("quiz_style")],(c=c&&c[b])?(c=a("<textarea/>").html(c).text(),_.template(c,ThriveQuizB.templateSettings)):null},hasQnaTpl:function(){var a=this.get("tve_qna_templates");return(a=a&&a[this.get("quiz_style")])&&Object.keys(a).length>0},getSharedStyles:function(){var a="";return this.get("tve_shared_styles")&&(a=this.get("tve_shared_styles")[this.get("page_type")]),a}}),ThriveQuizB.models.ResultsSettings=ThriveQuizB.models.Base.extend({initialize:function(a){this.set("message",new Backbone.Model(a.message)),a.links&&this.set("links",new Backbone.Collection(a.links))},get_type:function(){return this.get("type")},isURL:function(){return"url"===this.get_type()},get_redirect_url:function(b,c){var d="";c=c||{};var e={tqb_email:c.email||"",tqb_name:_.escape(c.name)||"",tqb_quiz_result:"personality"===b.quiz_type||"percentage"===b.quiz_type?b.explicit:b.user_points};b=_.extend({result_id:null,user_points:0,min_points:0,max_points:0},b||{});var f=parseInt(b.user_points);if(b.result_id){var g=this.get("links").findWhere({result_id:b.result_id});d=g.get("link")}else if("percentage"===this.get("quiz_type")){var h=0;h=b.min_points===b.max_points?100:100*(f-parseInt(b.min_points))/(parseInt(b.max_points)-parseInt(b.min_points)),this.get("links").each(function(a){h>=parseInt(a.get("lower_bound"))&&h<=parseInt(a.get("upper_bound"))&&(d=a.get("link"))})}else this.get("links").each(function(a){f>=parseInt(a.get("lower_bound"))&&f<=parseInt(a.get("upper_bound"))&&(d=a.get("link"))});return d.length&&this.get("forward_results")&&(d+="?"+a.param(e)),d}}),ThriveQuizB.models.Image=ThriveQuizB.models.Base.extend({defaults:_.extend({},ThriveQuizB.models.Base.prototype.defaults,{sizes:{thumbnail:{url:null}}}),initialize:function(a){"string"==typeof a&&this.set(_.extend({},this.defaults,{sizes:{full:{url:a},thumbnail:{url:a}},url:a}))},get_thumb:function(){return this.attributes.sizes.thumbnail?this.attributes.sizes.thumbnail.url||this.get("url")||null:this.get("url")||null}}),ThriveQuizB.models.Media=ThriveQuizB.models.Base.extend({defaults:_.extend({},ThriveQuizB.models.Base.prototype.defaults,{display_type:0,type:"",source:"",url:"",color:"",style:"",options:[]})}),ThriveQuizB.models.Video=ThriveQuizB.models.Media.extend({defaults:_.extend({},ThriveQuizB.models.Media.prototype.defaults,{video_id:"",style:{},thumb:"",source:"youtube",url:""}),initialize:function(a){this.get("thumb")&&this.set("thumb",new ThriveQuizB.models.Image(this.get("thumb"))),a.url&&0!==a.url.length||this.setDefaults(),this.buildEmbedCode()},setDefaults:function(){this.attributes.source="youtube"},buildEmbedCode:function(){if(this.attributes.url){var a=this.videoIdAndParams();a&&this.set("video_id",a)}},videoIdAndParams:function(){var a="";switch(this.attributes.source){case"youtube":var b=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/,c=this.attributes.url.match(b);a=c&&11==c[7].length?c[7]:"";break;case"vimeo":case"wistia":a=this.attributes.url.substring(this.attributes.url.lastIndexOf("/")+1)}return a=this.buildVideoParams(a)},buildVideoParams:function(a){var b=void 0!==this.attributes.options?this.attributes.options:[],c=void 0!==this.attributes.players?this.attributes.players:[],d=this.attributes.source,e=this.attributes.color?this.attributes.color.replace("#",""):"ffffff",f=[];if("vimeo"===d&&f.push("color="+this.attributes.color.replace("#","")),"wistia"===d&&(f.push("muted=1"),f.push("chromeless=false"),f.push("controlsVisibleOnLoad=true"),f.push("playerColor="+e)),"youtube"===d){var g=b&&1===parseInt(b.hide_logo.value)?1:0;f.push("mute=1"),f.push("modestbranding="+g)}return _.each(c[d],function(a,c){var e=c,g=a,h=void 0!==b[e]?b[e].value:"0";switch(c){case"autoplay":"youtube"!==d&&"wistia"!==d&&"vimeo"!==d||(1===parseInt(h)?(h="true","vimeo"===d&&f.push("muted=1")):h="false");break;case"hide_logo":case"hide_controls":h=1===parseInt(h)?0:1;break;case"hide_full_screens":h=1===parseInt(h)?0:1,"wistia"===d&&(h=1===parseInt(h)?"true":"false");break;case"disable_playbar":h=1===parseInt(h)?0:1,"wistia"!==d&&"vimeo"!==d||(h=1===parseInt(h)?"true":"false")}"youtube"===d&&"hide_logo"===c||f.push(g+"="+h)}),"wistia"===d&&f.push("videoFoam=true"),f.length>1?a+="?"+f.join("&"):a}}),ThriveQuizB.models.Audio=ThriveQuizB.models.Video.extend({buildEmbedCode:function(){if(this.attributes.url){var a=this.videoIdAndParams();a&&this.set("video_id",a)}},videoIdAndParams:function(){return this.buildVideoParams("")},buildVideoParams:function(a){var b=void 0!==this.attributes.options?this.attributes.options:[],c=void 0!==this.attributes.players?this.attributes.players:[],d=this.attributes.audio_source,e=[];return"spotify"===d&&(a=this.attributes.url.replace("https://open.spotify.com","")),_.each(c[d],function(a,c){var f=c,g=a,h=void 0!==b[f]?b[f].value:"0";switch(c){case"show_user":case"show_artwork":"soundcloud"===d&&(h=1===parseInt(h)?"false":"true");break;default:h=1===parseInt(h)?"true":"false"}e.push(g+"="+h)}),e.length>1?a+=e.join("&"):a}}),ThriveQuizB.models.Question=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,question_id:null,type:null,text:"",image:"",description:""},initialize:function(a){this.set("settings",new ThriveQuizB.models.QuestionSettings(a.settings)),null!==a.display_settings&&("video"===a.display_settings.type?this.set("display_settings",new ThriveQuizB.models.Video(a.display_settings)):this.set("display_settings",new ThriveQuizB.models.Audio(a.display_settings)))},get_image:function(){return"string"==typeof this.get("image")?this.get("image"):this.get("image").sizes.full.url},isTypeOf:function(a){var b=["button","image","open"],c=!1;return b.indexOf(a)>=0&&("button"===a&&1===parseInt(this.get("q_type"))?c=!0:"image"===a&&2===parseInt(this.get("q_type"))?c=!0:"open"===a&&3===parseInt(this.get("q_type"))&&(c=!0)),c},isOpenEndedType:function(){return this.isTypeOf("open")},showFeedback:function(){return!0===this.get("settings").get("display_question_feedback")}}),ThriveQuizB.models.FeedbackSettings=ThriveQuizB.models.Base.extend({defaults:{display_feedback:1,display_feedback_time:2,press_next:0},getFeedbackTime:function(){return parseInt(this.get("display_feedback_time"))},showFeedback:function(){return 1===this.get("display_feedback")||1===this.get("press_next")},showNextButton:function(){return 1===this.get("press_next")}}),ThriveQuizB.models.HilightSettings=ThriveQuizB.models.Base.extend({defaults:{highlight_answer:1,load_next_question:0,highlight_and_show_feedback:0},highlight:function(){return 0===this.get("load_next_question")},showFeedback:function(){return 1===this.get("highlight_and_show_feedback")},loadNext:function(){return 1===this.get("load_next_question")}}),ThriveQuizB.models.Answer=ThriveQuizB.models.Base.extend({idAttribute:"id",defaults:{id:null,order:null,text:"",image:""},initialize:function(){var a=TQB_Front.quiz_options[this.get("quiz_id")];a.feedback_settings.quiz_type=this.get("quiz_type"),a.highlight_settings.quiz_type=this.get("quiz_type"),this.set("highlight_settings",new ThriveQuizB.models.HilightSettings(a.highlight_settings)),this.set("feedback_settings",new ThriveQuizB.models.FeedbackSettings(a.feedback_settings))},highlight:function(){return this.get("highlight_settings")},feedback:function(){return this.get("feedback_settings")},isRightWrong:function(){return"right_wrong"===this.get("quiz_type")},hasFeedback:function(){return this.get("feedback")&&this.get("feedback").length>0},showFeedback:function(){return!!this.hasFeedback()&&(this.isRightWrong()?this.highlight().showFeedback():this.feedback().showFeedback())},showNextButton:function(){return this.isRightWrong()?this.highlight().loadNext():this.feedback().showNextButton()&&this.hasFeedback()},highlightAnswer:function(){return this.isRightWrong()&&(1===this.highlight().get("highlight_answer")||1===this.highlight().get("highlight_and_show_feedback"))},getShowFeedbackTime:function(){return 1e3*this.feedback().getFeedbackTime()},getDelayFeedbackTime:function(){return 1===parseInt(this.get("is_right"))?0:this.isRightWrong()?2e3:0},getTimeBeforeNextQuestion:function(){return this.showFeedback()||this.highlightAnswer()?this.getShowFeedbackTime():0},get_image:function(){return"string"==typeof this.get("image")?this.get("image"):this.get("image").sizes.full.url},validate:function(a,b){var c=[];if(!0===b.get("required")){var d=this.get("answer_text");if(!d||d.length<b.get_min_value())return[b.min_error()]}if(c.length)return c}}),ThriveQuizB.models.QuestionSettings=Backbone.Model.extend({get_max_value:function(){return parseInt(this.get("answer_limits").max.value)},get_min_value:function(){return parseInt(this.get("answer_limits").min.value)},min_error:function(){return this.get("answer_limits").min.error_message.replace("(limit)",this.get_min_value())},max_error:function(){return this.get("answer_limits").max.error_message.replace("(limit)",this.get_max_value())}}),ThriveQuizB.collections.Shortcodes=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Shortcode}),ThriveQuizB.collections.Answers=ThriveQuizB.collections.Base.extend({model:ThriveQuizB.models.Answer}),ThriveQuizB.models.ProgressSettings=ThriveQuizB.models.Base.extend({defaults:function(){return{quiz_id:"",display_progress:0}},getPercentToDisplay:function(){return"percentage_completed"===this.get("percent_type")?this.get("percentage"):100-this.get("percentage")}}),ThriveQuizB.models.ScrollSetting=ThriveQuizB.models.Base.extend({defaults:function(){return{enable_scroll:0}}})})}(jQuery);var quizFlowManager=function(a){return{initQuizFlows:function(){return a.each(function(a){var b=this;a.on("tqb.count",function(a){Object.keys(a).forEach(function(c){Object.keys(a[c].flows.items).length&&(a[c].count=b._getHighestCount(a[c])+1)})})},this),_.extend({first_question:this.getFirstQuestion().get("text")},{flows:{items:this.setQuestionFlows(this.getFirstQuestion())}})},_getHighestCount:function(a){var b=1;return Object.keys(a.flows.items).forEach(function(c){a.flows.items[c].count>b&&(b=a.flows.items[c].count)}),b},_setQuestionFlow:function(a){var b={};return null!==a.get("next_question_id")&&(b=this.setQuestionFlows(this.getQuestion(a.get("next_question_id")))),b},setQuestionFlows:function(a){if(void 0===a)return{};var b={},c="q_"+a.get("id");return b[c]={question:a.get("text"),count:1,flows:{items:this._setQuestionFlow(a)}},a.get("answers").each(function(a){var c=this.setAnswerFlows(a);b["a_"+a.get("id")]={answer:a.get("text"),flows:c,count:1}},this),a.trigger("tqb.count",b),b},setAnswerFlows:function(a){var b={items:{}};return null!==a.get("next_question_id")&&0!==parseInt(a.get("next_question_id"))&&(b=_.extend({items:this.setQuestionFlows(this.getQuestion(a.get("next_question_id")))},{count:1,next_question_id:a.get("next_question_id")})),b},calculateFlows:function(){var a="quiz_"+this.getQuizId();ThriveQuizB.flows[a]=_.extend({flowsSet:!1},this.initQuizFlows()),ThriveQuizB.flows[a].flowsSet=!0},getFirstQuestion:function(){return a.findWhere({start:"1"})},getQuestion:function(b){return a.findWhere({id:b})},getQuizId:function(){return parseInt(this.getFirstQuestion().get("quiz_id"))}}},resize=function(a,b){b=b||1e3,a.parents(".tve-leads-lightbox")&&setTimeout(function(){ThriveGlobal.$j(window).trigger("resize")},b)};window.addEventListener("scroll",function(){window.tqbLastScrollTime=(new Date).getTime()}),function(a){a(function(){ThriveQuizB.views.Base=Backbone.View.extend({render:function(){return this}}),ThriveQuizB.views.ShortcodeList=ThriveQuizB.views.Base.extend({events:{},el:a("body"),children:[],render:function(){return this.collection.each(this.renderOne,this),this},renderOne:function(a){if(a.get("page").html||a.get("question")){var b=new ThriveQuizB.views.Shortcode({model:a,collection:this.collection,questions:a.get("all_questions"),el:this.$el.find("#tqb-shortcode-wrapper-"+a.get("quiz_id")+"-"+a.get("id"))});b.render(),this.children.push(b)}a.get("error")&&TQB_Front.is_preview&&this.$el.find("#tqb-shortcode-wrapper-"+a.get("quiz_id")+"-"+a.get("id")).find(".tqb-frontend-error-message").html(a.get("error"))},destroy:function(){this.undelegateEvents(),_.each(this.children,function(a){a.undelegateEvents()})}}),ThriveQuizB.views.Shortcode=ThriveQuizB.views.Base.extend({events:{"click .tqb-shortcode-new-content .tqb-shortcode-submit-action":"nextPage","click .tqb-shortcode-new-content .tve_evt_manager_listen":"runEvent","click .tqb-shortcode-new-content .tve-dynamic-link":"restartQuiz"},to_load:0,sec_delay:1,powered_by_tqb:ThriveQuizB.tpl("powered-by-thrive-themes"),questions:null,quiz_type:null,render_count:0,initialize:function(b){this.questions=new Backbone.Collection(b.questions),this.quiz_type=this.model.get("quiz_type"),this.percentage=0,this.generateQuizFlows();var c="quiz_"+this.model.get("quiz_id");this.flows=ThriveQuizB.flows[c]?ThriveQuizB.flows[c].flows.items:{},this.listenTo(this.questions,"remove",this.getNextQuestion),this.questions.on("tqb.set_progress",function(a){var b="a_"+a.selectedAnswer.get("id"),c="q_"+this.questions.findWhere({id:a.selectedAnswer.get("question_id")}).get("id"),d={},e=1;null!==a.selectedAnswer.get("next_question_id")&&0!==parseInt(a.selectedAnswer.get("next_question_id"))&&this.flows[b].count?(d=this.flows[b].flows.items,e=this.flows[b].count):(d=this.flows[c].flows.items,e=this.flows[c].count);var f=this.percentage+(100-this.percentage)/e;f=Math.round(f),a.percentage=this.percentage=f,this.flows=d},this),ThriveGlobal.$j(".tve_p_lb_content").on("tve.lightbox-open",function(){resize(a(this).find(".tqb-shortcode-wrapper"),3e3)})},render:function(){return this.showLoader(),this.loadScripts(),this.initListeners(this.model),this.hideLoader(),this.render_count>0&&this.scrollQuiz(),this.render_count++,"ontouchstart"in document.documentElement||this.$el.addClass("no-touch"),this},generateQuizFlows:function(){var a=TQB_Front.quiz_options[this.model.get("quiz_id")],b=a.progress_settings;if(b="object"==typeof b&&a.progress_settings,b=b&&1===parseInt(a.progress_settings.display_progress))try{new quizFlowManager(this.getDataForProgress()).calculateFlows()}catch(c){}},getDataForProgress:function(){var a=JSON.parse(JSON.stringify(this.questions));return a=new Backbone.Collection(a),a.each(function(a){a.set("answers",new Backbone.Collection(a.get("answers")))}),a},getNextQuestion:function(b){var c=this.questions.findWhere({id:b.get("next_question_id")}),d=new Backbone.Collection(b.get("answers")),e=d.findWhere({id:b.get("user_answer_id")});setTimeout(function(d){c?(d.renderQuestion(c),d.scrollQuiz(),a.ajax({type:"post",url:ThriveQuizB.ajaxurl("&route=shortcode&custom_action=register_question_answer"),data:{user_unique:d.model.get("user_unique"),quiz_id:d.model.get("quiz_id"),answer_id:b.get("user_answer_id"),answer_text:b.get("user_answer_model").get("answer_text")},success:function(){}})):(e.set("answer_text",b.get("user_answer_model").get("answer_text")),d.shortcodeAction(e))},this._get_delay(),this)},loadScripts:function(){var b=this,c=this.model.get("page"),d=[],e=a("head"),f=this.$(".tqb-shortcode-new-content");if(c&&c.optimized_assets){if(c.optimized_assets.style){var g=document.createElement("style");document.head.prepend(g),g.setAttribute("data-tqb-variation",c.variation_id),g.appendChild(document.createTextNode(c.optimized_assets.style))}if(c.optimized_assets.files)for(var h in c.optimized_assets.files){var i="flat"===h;(!e.find('link[href*="thrive_flat.css"]').length&&i||!i)&&e.append(c.optimized_assets.files[h])}c.optimized_assets.js&&e.append(c.optimized_assets.js)}if(f.html("").append(this.model.getSharedStyles()),this.model.get("tve_custom_style")){var j=a("<style/>").addClass("tve_custom_style").html(this.model.get("tve_custom_style"));f.append(j)}c&&(d=d.concat(c.css),d=d.concat(c.fonts)),this.model.get("question")&&(d=d.concat(this.model.get("question").css)),this.to_load=d.length,_.each(d,function(c,e,f){var g=a('<link rel="stylesheet" type="text/css" media="all" href="'+c+'">');b.$(".tqb-shortcode-new-content").append(g),g.on("load",function(){b.to_load--,e===d.length-1&&b.check_loaded()})})},loadHTML:function(){if(!0!==isFirefox()||!0!==isScrolling()||!this.$el.closest(".tve-scroll-sticky").length){if(_.isEmpty(this.model.get("page"))){this.template=ThriveQuizB.tpl("question-wrapper");var a=this.model.get("tve_qna_templates");if(a){var b=this.model.get("quiz_style"),c=a[b];c&&c.questionWrapper&&(this.template=_.template(c.questionWrapper,ThriveQuizB.templateSettings))}this.$el.find(".tqb-shortcode-new-content").append(this.template()),this.renderQuestion(),this.model.trigger("tqb:close_loader",this.model)}else{this.template=_.template(this.model.get("page").html,ThriveQuizB.templateSettings),this.$el.find(".tqb-shortcode-new-content").append(this.template(this.model.toJSON())),this.$el.find(".tqb-shortcode-new-content").append('<style type="text/css">'+this.model.get("page").user_css.replace(/\\/g,"")+"</style>"),this.setUserIdentifier(),this.listener(),TQB_Front.settings.tqb_promotion_badge&&this.$el.find(".tqb-shortcode-new-content .tve-tqb-page-type").after(this.powered_by_tqb()),"results"===this.model.get("page_type")?this.resultPageListener():this.model.trigger("tqb:close_loader",this.model);var d=this.model.get("page")&&this.model.get("page").quiz_user_result;"optin"!==this.model.get("page_type")&&"results"!==this.model.get("page_type")||void 0===d||this.$(".thrv_lead_generation form").append('<input type="hidden" name="tqb-quiz-user-result" value="'+d+'">')}setTimeout(function(a){a.hideLoader(),a.setOverlayHeight();a.$el.offset().top;"splash"!==a.model.get("page_type")&&a.scrollQuiz()},50,this),TCB_Front.onDOMReady(ThriveGlobal.$j(this.$el)),TCB_Front.handleIframes(ThriveGlobal.$j(this.$el),!0),ThriveGlobal.$j(TCB_Front).trigger("content_loaded.thrive",[this.$el.find(".tqb-shortcode-new-content")])}},check_loaded:function(){var a,b=this;if(this.to_load<=0)return this.loadHTML(),void clearTimeout(a);a=setTimeout(function(){b.check_loaded()},50)},scrollQuiz:function(){var b,c=this.$el.parents(".thrive-quiz-builder-shortcode");if(c.length&&c.data("enable_scroll"))b="on"===c.data("enable_scroll");else{var d=TQB_Front.quiz_options[parseInt(this.model.get("quiz_id"))].scroll_settings,e=new ThriveQuizB.models.ScrollSetting(d);b=1===parseInt(e.get("enable_scroll"))}if(!0===b&&!this.$el.closest(".thrv-leads-slide-in").length)if(this.$el.parents(".tve_p_lb_background").length)a(".tve_p_lb_background").animate({scrollTop:0});else{var f=this;setTimeout(function(){var b=a(".thrv_header.tve-scroll-sticky").length?a(".thrv_header.tve-scroll-sticky").outerHeight():0;a("html,body").animate({scrollTop:f.$el.offset().top-b})},500)}},runEvent:function(b){var c=a(b.currentTarget),d=c.attr("data-tcb-events");if("string"==typeof c.data("shortcode-id")&&c.data("shortcode-id").includes("next_step_in_quiz"))return b.preventDefault(),void this.shortcodeAction();if("string"==typeof d){var e=!1,f=ThriveGlobal.$j.parseJSON(d.replace("__TCB_EVENT_","").replace("_TNEVE_BCT__",""));c.is("a")&&c.closest(".tve_ea_thrive_quiz_next_step ").length&&b.preventDefault(),b.stopPropagation();for(var g=0,h=f.length;g<h;g++)if("thrive_quiz_next_step"===f[g].a)e=!0;else if("thrive_animation"===f[g].a){var i=c.is("a")?c:c.parent("a"),j=i.attr("href");j&&(i.attr("target")?window.open(j,"_blank"):window.location.href=j)}e&&(b.preventDefault(),this.shortcodeAction())}},restartQuiz:function(b){if("tqb_quiz_options"===this.$(b.currentTarget).data("dynamic-link"))if(b.preventDefault(),this.$(b.currentTarget).data("shortcode-id").includes("restart_quiz")){this.undelegateEvents();var c={},d=this.$el.data("unique");c[d]=this.$el.data("quiz-id"),Object.keys(ThriveQuizB.loadedShortcodes).forEach(function(a){"undefined"!==c[a]&&delete ThriveQuizB.loadedShortcodes[a]}),window.tqb_restart_quiz=1,a(this).tqb(c),delete window.tqb_restart_quiz}else this.$(b.currentTarget).data("shortcode-id").includes("next_step_in_quiz")&&this.runEvent(b)},setUserIdentifier:function(){this.$el.find(".tqb-hidden-form-info.tqb-hidden-user-unique").val(this.model.get("user_unique"))},setOverlayHeight:function(){var a=this.$el.find(".tqb-shortcode-new-content").outerHeight();this.$el.find(".tqb-loading-overlay").css({height:a+"px"})},listener:function(){var a=this,b=this.$el.find(".tve_et_tve-viewport");ThriveGlobal.$j(this.$el).off("lead_conversion_success.tcb").on("lead_conversion_success.tcb",".thrv_lead_generation",function(b){b.content_unlocked="results"!==a.model.get("page_type"),a.model.set("form_data",_.extend({email:"",name:""},b.form_data||{})),a.nextPage()}),ThriveGlobal.$j(this.$el).off("should_submit_form.tcb").on("should_submit_form.tcb",".thrv_lead_generation",function(a){return a.flag_need_data=!0,!0}),this.$el.find(".tqb-shortcode-new-content").addClass("ajax-content"),"function"==typeof window.tar_trigger_viewport&&"function"==typeof window.tar_trigger_exit_viewport&&(jQuery(window).scroll(function(){window.tar_trigger_viewport(b.filter(":not(.tve-viewport-triggered)")),window.tar_trigger_exit_viewport(b.filter(".tve-viewport-triggered"))}),setTimeout(function(){window.tar_trigger_viewport(b),a.$el.find(".tqb-shortcode-new-content").trigger("content-inserted.tcb").removeClass("ajax-content")},200)),TCB_Front.onDOMReady(ThriveGlobal.$j(a.$el.find(".tqb-shortcode-new-content"))),TCB_Front.event_triggers(a.$el.find(".tqb-shortcode-new-content"))},switchContent:function(){var a=this.$el.find(".tqb-shortcode-old-content"),b=this.$el.find(".tqb-shortcode-new-content");a.html(b.html())},nextPage:function(){this.shortcodeAction()},shortcodeAction:function(a){if("results"!==this.model.get("page_type")){this.hideErrorToast();var b=this,c=a?this.getQuestionData(a):this.getPageData(),d=this.model.has_optin_page()&&void 0===a&&"optin"===c.page_type;c=_.extend({},c,ThriveQuizB.getQueryParams()),d=d||!this.model.has_optin_page()&&void 0!==a&&"splash"===c.page_type,d&&this.model.get("results_settings").isURL()&&this.model.get("results_settings").get("display_message")?this.model.trigger("tqb:show_redirect_loader",this.model):this.model.trigger("tqb:show_loader",this.model);var e=this.model.get("form_data");e&&e.email&&(c.user_email=e.email),this.model.fetch({data:c,success:function(a){if("results"===a.get("page_type")&&a.get("results_settings").isURL()){var c=a.get("results_settings").get("message"),d=parseInt(c.get("duration"));d=isNaN(d)?0:d,d*=1e3,a.get("results_settings").get("display_message")||(d=0),setTimeout(function(a){var b=a.get("results_settings").get_redirect_url(a.get("points"),a.get("form_data"));b.length&&(window.location=b)},d,a)}else b.render();resize(b.$el)}})}},hideErrorToast:function(){a("#tve-lg-error-container").hide()},getQuestionData:function(a){return{user_unique:this.model.get("user_unique"),quiz_id:this.model.get("quiz_id"),page_type:this.model.get("page_type"),answer_id:a.get("id"),answer_text:a.get("answer_text")||""}},getPageData:function(){var a=this.model.get("page");return{user_unique:this.model.get("user_unique"),quiz_id:this.model.get("quiz_id"),page_type:this.model.get("page_type"),variation:{page_id:a&&a.page_id||"",id:a&&a.variation_id||""}}},renderQuestion:function(a){a=void 0===a?this.questions.findWhere({start:"1"}):a,_.each(a.get("answers"),function(a){a.quiz_type=this.quiz_type},this);var b=new ThriveQuizB.collections.Answers(a.get("answers")),c=a.toJSON();delete c.answers,new ThriveQuizB.views.Question({model:new ThriveQuizB.models.Question(c),questions:this.questions,collection:b,quiz_type:this.quiz_type,flows:this.flows,percentage:this.percentage,shortcode:this.model,el:this.$el.find(".tqb-shortcode-new-content .tqb-question-wrapper")}).render()},resultPageListener:function(){function b(){j.removeAttr("data-image"),k.removeAttr("src"),i.children().hide(),i.append(h),a("style[onLoad]").removeAttr("onLoad")}function c(a){m++,k.attr("src",a),2===m&&j.attr("data-image",a);var b=e.model.get("quiz_url"),c="",d=j.attr("data-description");"I got: "===d&&(d=""),c+="&tqb_redirect_post_id="+TQB_Front.post_id,c+="&image_url="+a,c+="&description="+encodeURIComponent(d),-1===b.indexOf("?")&&(c+="?"+c.substr(1)),b+=c,j.attr("data-href",b),ThriveGlobal.$j(tve_frontend_options.is_editor_page?"#tve_editor":"body").on("click",".tqb-social-share-badge-container .tve_s_link",function(){e.model.logSocialShareConversion({},{page_id:e.model.get("page").page_id,quiz_id:e.model.get("page").quiz_id,variation_id:e.model.get("page").variation_id,"tqb-variation-user_unique":e.model.get("user_unique")});var a=ThriveGlobal.$j(this).parents(".tve_s_item"),b=a.attr("data-s");TCB_Front.onSocialCustomClick[b]&&TCB_Front.onSocialCustomClick[b](a)}),l.remove()}function d(a){c(a),k.load(function(){h.remove(),i.children().fadeIn();(new Date).getTime()})}var e=this;ThriveGlobal.$j(tve_frontend_options.is_editor_page?"#tve_editor":"body").on("click",".thrv_social_custom .tve_s_link",function(){e.model.logSocialShareConversion({},{page_id:e.model.get("page").page_id,quiz_id:e.model.get("page").quiz_id,variation_id:e.model.get("page").variation_id,"tqb-variation-user_unique":e.model.get("user_unique")})});var f=this.model.get("page").badge_url||null,g=e.model.get("page").has_social_badge&&1==e.model.get("page").has_social_badge&&e.model.get("page").html_canvas&&!f,h=a('<div id="tie-preloader-gif"></div>'),i=e.$(".tqb-social-share-badge-container"),j=i.find(".tve_s_fb_share"),k=i.find("img"),l=a('<div id="tie-html-canvas" style="overflow: visible; position: absolute; z-index: -1; visibility: hidden;">'+(e.model.get("page").html_canvas?e.model.get("page").html_canvas:"")+"</div>"),m=((new Date).getTime(),0);ThriveGlobal.$j(document).trigger("tve_shortcode_content_loaded",this),f&&(b(),c(f)),g&&(e.$el.find(".tqb-shortcode-new-content").parents().each(function(b,c){a(c).addClass("tqb-overflow-visible-badge")}),a("body").append(l),b(),setTimeout(function(){html2canvas([l.get(0)],{onrendered:function(b){function f(a){for(var b=atob(a.split(",")[1]),c=[],d=0;d<b.length;)c.push(b.charCodeAt(d)),d++;return new Blob([new Uint8Array(c)],{type:"image/jpg"})}var g=b.toDataURL("image/png");c(g),e.$el.find(".tqb-shortcode-new-content").parents().each(function(b,c){a(c).removeClass("tqb-overflow-visible-badge")});var h=f(g),i=new FormData,j=e.model.get("quiz_id"),k=e.model.get("user_id"),l=e.model.get("page").result;i.append("user_badge",h,l+"-"+j+".png"),i.append("quiz_id",j),i.append("user_id",k),i.append("result",l),i.append("action","tqb_frontend_ajax_controller"),a.ajax({type:"post",url:ThriveQuizB.ajaxurl("&route=shortcode&custom_action=save_user_custom_social_share_badge"),data:i,processData:!1,contentType:!1,success:d})}})},500))},showLoader:function(){this.$el.find(".tqb-loading-overlay").show(),this.$el.find(".tqb-shortcode-new-content").html("")},showRedirectLoader:function(){var a=this.$el.find(".tqb-loading-overlay"),b=ThriveQuizB.tpl("loaders/redirect");a.html(b({display_message:this.model.get("results_settings").get("display_message"),item:this.model.get("results_settings").get("message")})),a.show(),this.$el.find(".tqb-shortcode-new-content").html("")},hideLoader:function(){this.$(".tqb-loading-overlay").hide(),this.$el.css({"--tqb-placeholder-height-m":"","--tqb-placeholder-height-t":"","--tqb-placeholder-height-d":""})},initListeners:function(a){a.off("tqb:show_loader").on("tqb:show_loader",_.bind(this.showLoader,this)).off("tqb:show_redirect_loader").on("tqb:show_redirect_loader",_.bind(this.showRedirectLoader,this)),a.off("tqb:close_loader").on("tqb:close_loader",_.bind(this.hideLoader,this))},_get_delay:function(){var a=0
;return"right_wrong"===this.quiz_type&&1===this.highlight_answer&&(a=1e3*this.sec_delay),a}}),ThriveQuizB.views.VideoImageOverlay=Backbone.View.extend({template:ThriveQuizB.tpl("video/image-overlay"),events:{"click .tqb_video_overlay_image":"hideOverlayImage"},render:function(){var a=this.model.get("thumb")instanceof Backbone.Model&&this.model.get("thumb"),b=a?a.get("url"):"",c=this.model.get("source");return this.$el.find(".tqb-video-container-responsive").prepend(this.template({source:c,url:b})),this},hideOverlayImage:function(){this.$(".tqb_video_overlay_image").hide();var a,b=this.$el.find("iframe"),c=b.attr("src"),d=this.model.get("source");switch(d){case"youtube":c=c.replace("&autoplay=0",""),c=c.replace("&autoplay=false","&autoplay=1"),a="&autoplay=true";break;case"vimeo":a="&autoplay=true";break;case"wistia":a="&autoPlay=true"}if("youtube"===d||"vimeo"===d||"wistia"===d)b=this.$el.find("iframe"),0!==c.length&&b.attr("src",c+a);else if((!TCB_Front.browser.safari||0===parseInt(data_controls)&&1===parseInt(data_overlay))&&("custom"===d||"self"===d)){var e=this.$el.find("video").get(0);e.paused?e.play():e.pause()}}}),ThriveQuizB.views.Media=Backbone.View.extend({renderVideoImageOverlay:function(){var a=this.model.get("thumb"),b=this.model.get("options");if(!1!=a instanceof Backbone.Model&&void 0!==b&&(void 0===b.autoplay||1!==b.autoplay.value)){new ThriveQuizB.views.VideoImageOverlay({model:this.model,el:this.$el}).render()}},showLoader:function(){this.$el.find(".tqb-loading-overlay").show(),this.$el.find(".tqb-shortcode-new-content").html("")},hideLoader:function(){this.$el.find(".tqb-loading-overlay").hide()}}),ThriveQuizB.views.YotubeEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/youtube"),render:function(){return this.showLoader(),this.$el.html(this.template({item:this.model})),this.renderVideoImageOverlay(),this.hideLoader(),this}}),ThriveQuizB.views.WistiaEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/wistia"),render:function(){return this.showLoader(),this.$el.html(this.template({item:this.model})),this.renderVideoImageOverlay(),this.hideLoader(),this}}),ThriveQuizB.views.VimeoEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/vimeo"),render:function(){return this.showLoader(),this.$el.html(this.template({item:this.model})),this.renderVideoImageOverlay(),this.hideLoader(),this}}),ThriveQuizB.views.CustomEmbededVideo=ThriveQuizB.views.Media.extend({template:ThriveQuizB.tpl("video/custom"),allowedMimeTypes:{asf:"video/x-ms-asf",asx:"video/x-ms-asf",wmv:"video/x-ms-wmv",wmx:"video/x-ms-wmx",wm:"video/x-ms-wm",avi:"video/avi",divx:"video/divx",flv:"video/x-flv",mov:"video/quicktime",qt:"video/quicktime",mpeg:"video/mpeg",mpg:"video/mpeg",mpe:"video/mpeg",mp4:"video/mp4",m4v:"video/mp4",ogv:"video/ogg",webm:"video/webm",mkv:"video/x-matroska"},render:function(){var a=this.media_mime();return this.$el.html(this.template({mime:a,item:this.model})),this.renderVideoImageOverlay(),this},media_mime:function(){var a=this.model.get("url").split(".").pop().toLowerCase();return"string"==typeof this.allowedMimeTypes[a]?this.allowedMimeTypes[a]:""}}),ThriveQuizB.views.CustomEmbededAudio=ThriveQuizB.views.CustomEmbededVideo.extend({allowedMimeTypes:{mp3:"audio/mpeg",mpeg:"audio/mpeg",m4a:"audio/m4a",m4b:"audio/mpeg",ra:"audio/x-realaudio",ram:"audio/x-realaudio",wav:"audio/wav",ogg:"audio/ogg",oga:"audio/ogg",mid:"audio/midi",midi:"audio/midi",wma:"audio/x-ms-wma",wax:"audio/x-ms-wax",mka:"audio/x-matroska"},template:ThriveQuizB.tpl("audio/custom")}),ThriveQuizB.views.SpotifyEmbededAudio=ThriveQuizB.views.CustomEmbededVideo.extend({template:ThriveQuizB.tpl("audio/spotify"),render:function(){var a="//open.spotify.com/embed"+this.model.get("video_id");return this.$el.html(this.template({item:this.model,src:a})),this}}),ThriveQuizB.views.SoundcloudEmbededAudio=ThriveQuizB.views.CustomEmbededVideo.extend({template:ThriveQuizB.tpl("audio/soundcloud")}),ThriveQuizB.views.Question=ThriveQuizB.views.Base.extend({template:ThriveQuizB.tpl("question"),powered_by_tqb:ThriveQuizB.tpl("powered-by-thrive-themes"),events:{"click .tqb-next-button":function(a){if(!this.$(".tqb-open-ended-wrapper").length){var b=this.$('[data-clicked="1"]');if(b.length){this.collection.findWhere({id:b.data("id")});var c=this.collection.findWhere({id:b.data("id").toString()});"object"==typeof c&&c.trigger("tqb:choose_answer",c)}}}},initialize:function(a){this.questions=a.questions,this.quiz_type=a.quiz_type,this.flows=a.flows,this.percentage=a.percentage,this.shortcode=a.shortcode,this.collection.on("tqb:disable_answer",_.bind(this.disableAnswer,this)).on("tqb:show_next",_.bind(this.showNext,this)).on("tqb:show_right_answer",_.bind(this.showRightAnswer,this)).on("tqb:handle_progress",_.bind(this.handleProgress,this))},showRightAnswer:function(a){_.each(this.collection.where({is_right:"1"}),function(a){var b=this.$("#tqb-answer-"+a.get("id"));b.addClass("tqb-right tqb-right-answer tqb-rw"),b.attr("data-css",this.$("tqb-active-answer").attr("data-css"))},this),"1"!==a.get("is_right")&&this.$("#tqb-answer-"+a.get("id")).addClass("tqb-wrong tqb-wrong-answer tqb-rw")},showNext:function(){this.$(".tqb-button-holder").removeClass("tqb-hide").addClass("tqb-clear"),this.$("#tqb-thrv-label").css({position:"relative","z-index":"-1"})},disableAnswer:function(){this.$(".tqb-answer-inner-wrapper").addClass("tqb-disable-answer")},handleProgress:function(a){this.selectedAnswer=a,this.questions.trigger("tqb.set_progress",this),this.renderProgress()},_qnaHtml:function(){if(this.shortcode.hasQnaTpl()){var a=this.model.get("display_settings")instanceof Backbone.Model&&this.model.get("display_settings"),b=a&&a.get("type")?a.get("type"):"";this.$el.html(jQuery(this.shortcode.tpl("questionWrapper")({item:this.model,display_type:b})).html()),this.$(".tqb-question-container").replaceWith(this.shortcode.tpl("questionContainer")({item:this.model,display_type:b})),this.$(".tqb-question-text").replaceWith(this.shortcode.tpl("questionText")({item:this.model})),this.$(".tqb-question-description").replaceWith(this.shortcode.tpl("questionDescription")({item:this.model})),"text"===b&&this.model.get("image")&&this.$(".tqb-question-container").append('<div class="tqb-question-image-container"><img src="'+this.model.get_image()+'" alt="question-image"></div>'),this.$(".tqb-answers-container").replaceWith(this.shortcode.tpl("answersContainer")())}},_html:function(){var a=this.model.get("display_settings")instanceof Backbone.Model&&this.model.get("display_settings"),b=a&&a.get("type")?a.get("type"):"";this.$el.html(this.template({item:this.model,display_type:b}))},render:function(){if(this._html(),this._qnaHtml(),this.renderMedia(),this.renderProgress(),this.renderAnswers(),this.shortcode.hasQnaTpl()){var a=this.model.isOpenEndedType()?".tqb-open-type-button":".tqb-button-holder",b=this.model.isOpenEndedType()?"html":"replaceWith";this.$(a)[b](this.shortcode.tpl("nextQuestion")()),this.$(".tqb-open-ended-wrapper .tqb-button-holder").removeClass("tqb-hide")}return TQB_Front.settings.tqb_promotion_badge&&!this.$("#tqb-thrv-label").length&&(this.$el.append(this.powered_by_tqb()),this.$("#tqb-thrv-label").addClass("tqb-clear")),"1"!==this.model.get("start")&&this.$("#tqb-open-type-answer").focus(),resize(this.$el),this},renderMedia:function(){var a=this.model.get("display_settings");if(null!==a)switch(parseInt(a.get("display_type"))){case 0:default:this.renderText();break;case 1:this.renderVideo();break;case 2:this.renderAudio()}},renderText:function(){},renderAudio:function(){var a=a||this.$el.find(".tqb-question-media"),b=this.model.get("display_settings");switch(b.get("audio_source")){case"soundcloud":var c=new ThriveQuizB.views.SoundcloudEmbededAudio({model:b,el:a});break;case"spotify":var c=new ThriveQuizB.views.SpotifyEmbededAudio({model:b,el:a});break;case"custom":default:var c=new ThriveQuizB.views.CustomEmbededAudio({model:b,el:a})}c.render()},renderVideo:function(a){var a=a||this.$el.find(".tqb-question-media"),b=this.model.get("display_settings");switch(b.get("source")){case"youtube":var c=new ThriveQuizB.views.YotubeEmbededVideo({model:b,el:a});break;case"vimeo":var c=new ThriveQuizB.views.VimeoEmbededVideo({model:b,el:a});break;case"wistia":default:var c=new ThriveQuizB.views.WistiaEmbededVideo({model:b,el:a});break;case"custom":var c=new ThriveQuizB.views.CustomEmbededVideo({model:b,el:a})}c.render()},renderProgress:function(){var a=TQB_Front.quiz_options[this.model.get("quiz_id")],b=new ThriveQuizB.models.ProgressSettings(a.progress_settings);1===parseInt(b.get("display_progress"))&&(b.set("percentage",this.percentage),this.$(".tqb-progress-container").remove(),"position_top"===a.progress_settings.progress_position?this.$el.prepend('<div class="tqb-progress-container tqb-hide"></div>'):this.$el.append('<div class="tqb-progress-container tqb-hide"></div>'),new ThriveQuizB.views.ProgressBar({template:this.shortcode.tpl("progressbarContainer"),shortcode:this.shortcode,model:b,flows:this.flows,hasSelectedAnswer:!!this.selectedAnswer,el:this.$(".tqb-progress-container"),quizId:this.model.get("quiz_id")}).render())},renderAnswers:function(){return 2===parseInt(this.model.get("q_type"))&&this.$el.find(".tqb-answers-container").addClass("tqb-answer-has-image"),new ThriveQuizB.views.Answers({model:this.model,collection:this.collection,questions:this.questions,quiz_type:this.quiz_type,shortcode:this.shortcode,el:this.$el.find(".tqb-answers-container")}).render()}}),ThriveQuizB.views.Answers=ThriveQuizB.views.Base.extend({events:{},initialize:function(a){this.questions=a.questions,this.quiz_type=a.quiz_type,this.shortcode=a.shortcode},render:function(){return this.$el.empty(),this.collection.each(this.renderOne,this),this},renderOne:function(a){a.on("tqb:choose_answer",function(){var b=this.questions.findWhere({id:a.get("question_id")}),c=TQB_Front.quiz_options[this.model.get("quiz_id")];if(parseInt(a.get("next_question_id"))&&b.set({next_question_id:a.get("next_question_id")}),b.set("user_answer_id",a.get("id")),b.set("user_answer_model",a),this.questions.remove(b),!0!==c.press_next&&"right_wrong"===this.quiz_type&&0===parseInt(a.get("is_right"))){var d=this.collection.findWhere({is_right:"1"});d instanceof ThriveQuizB.models.Answer&&d.trigger("tqb:indicate-right")}},this);var b=new ThriveQuizB.views.Answer({model:a,question:this.model,quiz_type:this.quiz_type,collection:this.collection,shortcode:this.shortcode});return this.$el.append(b.render().$el),this}}),ThriveQuizB.views.Answer=ThriveQuizB.views.Base.extend({className:"tqb-answer-inner-wrapper",template:ThriveQuizB.tpl("answer"),template_image:ThriveQuizB.tpl("answer-image"),template_open:ThriveQuizB.tpl("answer-open"),events:{"click .tqb-answer-action":"answerAction","keyup textarea":function(a){var b=this.question.get("settings"),c=this.$(".tqb-answer-status"),d=b.get_max_value()-a.currentTarget.value.length;d<0?(a.currentTarget.value=a.currentTarget.value.substr(0,b.get_max_value()),this.model.trigger("invalid",this.model,[b.max_error()])):(c.html(TQB_Front.t.chars+": %s".replace("%s",d)),this.set_status("typing"))}},right_class:"tqb-right-answer",wrong_class:"tqb-wrong-answer",quiz_type:null,$status:null,initialize:function(a){this.shortcode=a.shortcode,a.quiz_type&&(this.quiz_type=a.quiz_type),a.question&&a.question instanceof ThriveQuizB.models.Question&&(this.question=a.question),this.model.on("tqb:indicate-right",this.indicate_right,this),this.model.on("invalid",function(a,b){this.set_status("error").html(b.shift())},this)},indicate_right:function(){this.$el.addClass(this.right_class)},_tpl:function(b){var c=this.template,d="answerItem",e=this.shortcode.tpl(d);this.isQnaTpl=!1,this.question.isTypeOf("image")?(e=this.shortcode.tpl("answerImageItem"),c=this.template_image):this.question.isTypeOf("open")&&(e=this.shortcode.tpl("answerOpenItem"),c=this.template_open),e&&e.length&&(c=e,this.isQnaTpl=!0);var f=c(b);if(this.isQnaTpl){var g=a(f);this.$el.attr("data-css",g.data("css")),this.$el.addClass("tqb-editor-answer-wrapper"),g.find(".tqb-answer-icon").replaceWith(this.shortcode.tpl("answerIcon")()),g.find(".tcb-icon").removeClass("tcb-icon"),this.model.get("image")&&(g.find(".tqb-fancy-icon").addClass("tqb-fancy-rel"),g.find(".tqb-answer-image-container").html('<img src="'+this.model.get_image()+'" alt="" class="tqb-answer-image">')),f=g.find(".tqb-answer-content")[0].outerHTML}return f},_html:function(){var b=this._tpl({item:this.model,question:this.question,settings:this.question.get("settings")});this.isQnaTpl&&this.$el.attr("data-css",a(b).data("css")),this.$el.html(b)},render:function(){return this._html(),this.question.isTypeOf("open")&&this.$el.addClass("tqb-open-ended-wrapper"),this.$status=this.$(".tqb-answer-status"),this.$el.attr("id","tqb-answer-"+this.model.get("id")),this.$el.attr("data-id",this.model.get("id")),this},answerAction:function(b){if(("BUTTON"===b.target.tagName||a(b.target).is(".tqb-next-icon"))&&(this.model.set("answer_text",this.$("textarea").val()),!1===this.model.isValid(this.question.get("settings"))))return void this.$("textarea").focus();var c=b.currentTarget.classList.contains("tqb-open-ended-wrapper");if(c=c&&"BUTTON"!==b.target.tagName,c=c&&!a(b.target).is(".tqb-next-icon"))return b.stopPropagation();this.$el.data("clicked")||(this.$el.attr("data-clicked",1),this.handleProgress()&&this.collection.trigger("tqb:handle_progress",this.model),this.showNextButton()&&this.collection.trigger("tqb:show_next",this.model),this.$el.find(".tqb-answer-action").addClass("tqe-selected-answer"),this.$el.addClass("tqb-active-answer"),this.question.isOpenEndedType()||(this.collection.trigger("tqb:disable_answer",this.model),this.highlightAnswer(),this.handleFeedback()),this.next())},next:function(){if(!this.showNextButton()){var a=this;setTimeout(function(){a.model.trigger("tqb:choose_answer",a.model)},this.getTimeBeforeNextQuestion())}},getTimeBeforeNextQuestion:function(){var a=(this.model.highlightAnswer()||this.model.showFeedback())&&this.question.showFeedback(),b=!this.question.isOpenEndedType()&&a?this.model.getTimeBeforeNextQuestion():0;return"right_wrong"!==this.quiz_type||0!==b||this.model.highlight().loadNext()||this.question.isOpenEndedType()||(b=this.model.getShowFeedbackTime()),b},showNextButton:function(){var a=!this.question.isOpenEndedType()&&!this.model.highlight().loadNext();return a="right_wrong"===this.quiz_type?a&&this.model.feedback().showNextButton():a&&this.hasFeedback()&&this.model.feedback().showNextButton()&&this.question.showFeedback()},hasFeedback:function(){return this.model.get("feedback")&&this.model.get("feedback").length>0},displayFeedback:function(){return!0===this.question.get("settings").get("display_question_feedback")&&this.model.showFeedback()},highlightAnswer:function(){!1===this.model.highlightAnswer()&&!1===this.question.isOpenEndedType()||this.collection.trigger("tqb:show_right_answer",this.model)},handleFeedback:function(){if(this.displayFeedback()){this.renderFeedback();var a=this;setTimeout(function(){a.$(".tqb-answer-feedback").removeClass("tqb-hide")},this.model.getDelayFeedbackTime()),this.showNextButton()||setTimeout(function(){a.$(".tqb-answer-feedback").addClass("tqb-hide")},this.model.getShowFeedbackTime())}},renderFeedback:function(){if(this.model.hasFeedback()){var a="";_.each(this.model.get("feedback").split("\n"),function(b){a+='<p class="tqb-feedback-text">'+_.escape(b)+"</p>"},this),this.$(".tqb-feedback-inner").html(a)}},set_status:function(a){var b="tqb-answer-status";switch(this.$status.removeAttr("class"),a){case"typing":this.$status.addClass("tqb-typing-text");break;case"error":this.$status.addClass("tqb-error-text")}return this.$status.addClass(b),this.$status},handleProgress:function(){var a=TQB_Front.quiz_options[this.model.get("quiz_id")];return a.progress_settings&&1===a.progress_settings.display_progress}}),ThriveQuizB.views.ProgressBar=Backbone.View.extend({template:function(a){return a._template&&a._template.length?a._template(a):ThriveQuizB.tpl("progress-bar-skin-"+TQB_Front.quiz_options[this.quizId].quiz_style)(a)},initialize:function(a){this._template=a.template,this.shortcode=a.shortcode,this.flows=a.flows,this.hasSelectedAnswer=a.hasSelectedAnswer,this.quizId=a.quizId},render:function(){var b=this.model.get("percentage"),c=!0!==this.hasSelectedAnswer?Math.round((100-this.model.get("percentage"))/this.getHighestCount()):0,d=100-this.model.get("percentage")>c?Math.round(100-c-this.model.get("percentage")):0,e=a(this.template({_template:this._template,model:this.model,completed:b,estimatedProgress:c,remaining:d}));return this.shortcode.hasQnaTpl()?(this.$el.attr("data-css",e.attr("data-css")),this.$el.html(e.html())):this.$el.html(e[0].outerHTML),this.$(".tqb-progress-completed").css("background-color",this.model.get("fill_color")),this.$(".tqb-progress-label").css("color",this.model.get("label_color")),this.$(".tqb-progress-label, .tqb-next-item, .tqb-remaining-progress").css("font-size",parseInt(this.model.get("font_size"))),this.$(".tqb-next-item").css("background-color",this.model.get("next_step_color")),this.$(".tqb-remaining-progress").css({width:"calc("+d+"%)","background-color":this.model.get("background_color")}),this.$(".tqb-next-item").toggleClass("tqb-hide",!0===this.hasSelectedAnswer),this.$el.removeClass("tqb-hide"),this},getHighestCount:function(a){var b=1;return a=a||this.flows,Object.keys(a).forEach(function(c){a[c].count>b&&(b=a[c].count)}),b}})})}(jQuery);