/*! Thrive Architect - 2021-12-13
* http://www.thrivethemes.com/
* Copyright (c) 2021 Thrive Themes */

"use strict";function ownKeys(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),i.push.apply(i,n)}return i}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(i,!0).forEach(function(e){_defineProperty(t,e,i[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):ownKeys(i).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))})}return t}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}!function(l){var u,m,o,h,g,s={".js":[],".json":[],".css":[],".html":[]},p="function"==typeof require?require:null;return h=function(e){var t=new Error("Could not find module '"+e+"'");return t.code="MODULE_NOT_FOUND",t},g=function(e,t,i){var n,o;if("function"==typeof e[t+i])return t+i;for(n=0;o=s[i][n];++n)if("function"==typeof e[t+o])return t+o;return null},u=function(e,t,i,n,o,s){var r,a,l,p,c,d;for("."!==(r=(i=i.split("/")).pop())&&".."!==r||(i.push(r),r="");null!=(a=i.shift());)if(a&&"."!==a&&(".."===a?(e=t.pop(),s=s.slice(0,s.lastIndexOf("/"))):(t.push(e),e=e[a],s+="/"+a),!e))throw h(n);if(r&&"function"!=typeof e[r]&&((d=(d=(d=(d=g(e,r,".js"))||g(e,r,".json"))||g(e,r,".css"))||g(e,r,".html"))?r=d:2!==o&&"object"===_typeof(e[r])&&(t.push(e),e=e[r],s+="/"+r,r="")),!r)return 1!==o&&e[":mainpath:"]?u(e,t,e[":mainpath:"],n,1,s):u(e,t,"index",n,2,s);if(!(c=e[r]))throw h(n);return c.hasOwnProperty("module")?c.module.exports:(l={},c.module=p={exports:l,id:s+"/"+r},c.call(l,l,p,m(e,t,s)),p.exports)},o=function(e,t,i,n){var o,s=i,r=i.charAt(0),a=0;if("/"===r){if(s=s.slice(1),!(e=l["/"])){if(p)return p(i);throw h(i)}n="/",t=[]}else if("."!==r){if(o=s.split("/",1)[0],!(e=l[o])){if(p)return p(i);throw h(i)}n=o,t=[],(s=s.slice(o.length+1))||(a=(s=e[":mainpath:"])?1:(s="index",2))}return u(e,t,s,i,a,n)},(m=function(t,i,n){return function(e){return o(t,[].concat(i),e,n)}})(l,[],"")}({workspace:{admin:{assets:{js:{lightspeed:{"collection.js":function(e,t,i){t.exports=Backbone.Collection.extend({modelId:function(e){return"".concat(e.id,"-").concat(e.key||"0")},isOptimized:function(){return this.models.every(function(e){return e.get("optimized")||e.get("failed")})},getItemToOptimize:function(){return this.find({optimized:!1,failed:!1})},resetOptimization:function(){this.each(function(e){return e.set({optimized:!1})})},getStatus:function(){return this.findWhere({optimized:!1})?this.findWhere({loading:!0})?"running":this.findWhere({failed:!0})?"fail":"":"optimized"}})},"main.js":function(e,t,i){_.templateSettings={evaluate:/<#([\s\S]+?)#>/g,interpolate:/<#=([\s\S]+?)#>/g,escape:/<#-([\s\S]+?)#>/g},Backbone.emulateHTTP=!0,jQuery(function(){var e="#optimization/main",n=i("./views/_includes");window.Lightspeed={CONST:window.lightspeed_localize,groups:[],collections:{},router:new(Backbone.Router.extend({view:null,routes:{":view/:step":"loadView"},loadView:function(e,t){this.view&&(this.view.undelegateEvents(),this.view.$el.empty());var i=new(n[e]&&n[e][t]?n[e][t]:n.optimization.home)({el:"#ls-view-container"});this.view=i.render()}})),view:new(i("./views/main"))},Lightspeed.CONST.timeout=1e3*parseInt(Lightspeed.CONST.timeout),Lightspeed.view.render(),Backbone.history.stop(),Backbone.history.start({hashchange:!0,silent:window.location.hash!==e}),Lightspeed.router.navigate(e,{trigger:!0})})},"utils.js":function(e,t,i){var o;o=jQuery,t.exports={tpl:function(e,t){var i=1<arguments.length&&void 0!==t?t:{};e.includes("lightspeed-")||(e="lightspeed-".concat(e));var n=o("script#"+e.replace(/\//g,"-")).html()||"";return _.template(n)(i)},secondsToTime:function(e){var t=0<arguments.length&&void 0!==e?e:0;t=parseInt(t);var i=parseInt(t/3600),n=parseInt((t-3600*i)/60),o=t-3600*i-60*n,s="";return i&&(s="".concat(i," hour").concat(1===i?"":"s")),n&&(i&&(s+=", "),s+="".concat(n," minute").concat(1===n?"":"s"," ")),o&&((n||i)&&(s+=" and "),s+="".concat(o," second").concat(1==o?"":"s")),s},getTotalItems:function(){return Lightspeed.collections.reduce(function(e,t){return e+t.length},0)},getOptimizedItems:function(){return Lightspeed.collections.reduce(function(e,t){return e+t.where({optimized:!0}).length},0)},getFailedItems:function(){return Lightspeed.collections.reduce(function(e,t){return e+t.where({failed:!0}).length},0)},ajax:function(e,t,i){var n=2<arguments.length&&void 0!==i?i:{};return o.ajax({url:"".concat(Lightspeed.CONST.route,"/").concat(e),headers:{"X-WP-Nonce":Lightspeed.CONST.nonce},type:t,data:n})},getOptimizationIframe:function(e){var t="lightspeed-optimization-iframe-".concat(0<arguments.length&&void 0!==e?e:"all"),i=o("#".concat(t));return 0===i.length&&(i=o('<iframe id="'.concat(t,'" class="tve-ls-optimization-frame">')).appendTo(o("body"))),i}}},views:{"_includes.js":function(e,t,i){t.exports={optimization:{main:i("./optimization/main"),analyze:i("./optimization/analyze"),optimize:i("./optimization/optimize"),finished:i("./optimization/finished")},fonts:{main:i("./fonts/main")},advanced:{main:i("./advanced-settings/main")}}},"advanced-settings":{"main.js":function(e,t,i){var a=i("../../utils"),n=i("../optimization/progress-bar"),l=i("../../collection"),o=i("../optimization/optimize");t.exports=Backbone.View.extend({initialize:function(){this.initializeOptimize(),this.$progressBar=new n,this.optimizedItems=0},initializeOptimize:function(){var i=this;this.optimize=new o,this.optimize.updateProgress=function(){var e=a.getOptimizedItems(),t=a.getTotalItems();i.$progressBar.updateProgress(100*e/t)},this.optimize.$el=this.$el,this.optimize.onFinished=function(){a.getOptimizationIframe().remove(),window.location.href.includes("#advanced/main")&&(i.$progressBar.updateProgress(100),i.$(".ls-save-advanced-settings").removeClass("tvd-disabled").text("Save"),i.$(".progress-bar-wrapper").hide())}},events:{"click .ls-save-advanced-settings":"saveAdvancedSettings"},render:function(){this.$el.html(a.tpl("advanced-settings/main",_objectSpread({},Lightspeed.CONST.options))),this.$(".progress-bar-wrapper").html(this.$progressBar.render())},saveAdvancedSettings:function(){var o=[];this.$el.find(".ls-advanced-setting-input").each(function(e,t){var i=t.dataset.key,n=t.checked?1:0;a.ajax("options","POST",{key:i,value:n}),Lightspeed.CONST.options[i]=n,t.checked&&o.push(t.dataset.key)}),this.advancedAssetsOptimize(o)},advancedAssetsOptimize:function(e){var t=this,i=[],n=e.some(function(e){return e.includes("woo")}),o=e.some(function(e){return e.includes("gutenberg")});if(e.some(function(e){return e.includes("lp")})&&i.push("lp"),e.length&&e.some(function(e){return!e.includes("lp")})&&i.push("ttb"),this.$(".ls-save-advanced-settings").addClass("tvd-disabled").text("Saving"),this.$(".progress-bar-wrapper").show(),i.length)a.ajax("analyze","GET",{to_analyze:i}).then(function(e){Lightspeed.collections=[],Lightspeed.groups=Object.values(e).map(function(e){return e.collection=new l(e.items.map(function(e){return e.failed=!1,e.optimized=!0,n&&!e.woo_optimized&&(e.optimized=!1),o&&!e.gutenberg_optimized&&(e.optimized=!1),e})),Lightspeed.collections.push(e.collection),e}),t.optimize.optimizeItems()});else var s=0,r=setInterval(function(){s<=100?t.$progressBar.updateProgress(s):(t.optimize.onFinished(),clearInterval(r)),s+=2},15)},decodeUrl:function(e){return e.replace(/&#038;/g,"&")}})}},fonts:{"main.js":function(e,t,i){var n=i("../../utils");t.exports=Backbone.View.extend({events:{"click .ls-setting-input":"toggleOption"},render:function(){this.$el.html(n.tpl("fonts/main",_objectSpread({},Lightspeed.CONST.options,{canOptimizeFonts:!Lightspeed.CONST.options.tve_google_fonts_disable_api_call,canLoadFontsAsync:!Lightspeed.CONST.options.tve_google_fonts_disable_api_call&&Lightspeed.CONST.options._tve_enable_fonts_optimization})))},toggleOption:function(e){var t=e.currentTarget.dataset.key,i=e.currentTarget.checked?1:0;switch(t){case"tve_google_fonts_disable_api_call":i&&(this.updateOption("_tve_enable_fonts_optimization",0),this.updateOption("_tve_enable_fonts_async_load",0));break;case"_tve_enable_fonts_optimization":i||this.updateOption("_tve_enable_fonts_async_load",0)}this.updateOption(t,i)},updateOption:function(e,t){var i=this;n.ajax("options","POST",{key:e,value:t}).then(function(){Lightspeed.CONST.options[e]=t,"fonts/main"===Backbone.history.fragment&&i.render()})}})}},"main.js":function(e,t,i){var n=i("../utils"),o={optimization:{label:"Asset Optimization",url:"#optimization/main"},fonts:{label:"Font Settings",url:"#fonts/main"},advanced:{label:"Advanced Settings",url:"#advanced/main"}};t.exports=Backbone.View.extend({el:"#lightspeed-admin-wrapper",render:function(){this.$el.html(n.tpl("main")),Lightspeed.router.on("route",this.updateBreadcrumbs.bind(this))},updateBreadcrumbs:function(){var t=Backbone.history.getFragment().replace(/\/.*/g,""),i=this.$("#ls-menu-container").empty();Object.values(o).forEach(function(e){i.append(n.tpl("menu-item",_objectSpread({},e,{currentRoute:t})))}),jQuery(".ls-breadcrumbs > span").html(o[t].label)}})},optimization:{"analyze.js":function(e,t,i){var n=i("../../utils"),o=i("./optimization-toggle");t.exports=Backbone.View.extend({events:{"click .lightspeed-optimize":"optimize","click .lightspeed-force-optimize":"forceOptimize"},initialize:function(){this.$toggle=new o},render:function(){var e={totalItems:n.getTotalItems(),optimizedItems:n.getOptimizedItems()},t=this.getState(e.optimizedItems,e.totalItems);return this.$el.html(n.tpl("optimization/".concat(t,"-optimized"),e)),"not"!==t&&this.$(".page-footer").html(this.$toggle.render()),this},optimize:function(){Lightspeed.router.navigate("#optimization/optimize",{trigger:!0})},forceOptimize:function(){Lightspeed.collections.forEach(function(e){return e.resetOptimization()}),this.optimize()},getState:function(e,t){var i,n=0<arguments.length&&void 0!==e?e:0,o=1<arguments.length&&void 0!==t?t:0;switch(!0){case 0===n:i="not";break;case n===o:i="all";break;case 0<n&&n<o:default:i="partially"}return i}})},"finished.js":function(e,t,i){var n=i("../../utils");t.exports=Backbone.View.extend({events:{"click .go-to-home":function(){return Lightspeed.router.navigate("#optimization/analyze",{trigger:!0})},"click .show-failed":"showFailedItems"},render:function(){return this.$el.html(n.tpl("optimization/finished",{optimizationTime:n.secondsToTime((performance.now()-Lightspeed.startedTime)/1e3),optimizedItems:n.getOptimizedItems(),failedItems:n.getFailedItems()})),this.$failedItems=this.$(".failed-items").hide(),this},showFailedItems:function(){var t=this;this.$failedItems.empty();var i=1;Lightspeed.collections.forEach(function(e){e.where({optimized:!1}).forEach(function(e){t.$failedItems.append(n.tpl("optimization/failed-item",{index:i,group:e.get("group"),name:e.get("name")})),i++})}),this.$failedItems.slideDown()}})},"group.js":function(e,t,i){var n=i("../../utils");t.exports=Backbone.View.extend({className:"text-paragraph optimize-item",initialize:function(e){var t=this;this.label=e.label,this.type=e.type,this.collection.each(function(e){e.set({failed:!1}),t.listenTo(e,"change",function(e){e.get("failed")&&e.set({group:t.label},{silent:!0}),t.render()})})},render:function(){return this.$el.html(n.tpl("optimization/group",{label:this.label,items:this.collection,status:this.collection.getStatus()})),this.$el}})},"main.js":function(e,t,i){var n=i("../../utils"),o=i("./optimization-toggle"),s=i("../../collection");t.exports=Backbone.View.extend({events:{"click .lightspeed-analyze":"analyze"},initialize:function(){this.$toggle=new o},render:function(){return this.$el.html(n.tpl("optimization/analyze")),this.$(".page-footer").append(this.$toggle.render()),this},analyze:function(){var t=this;this.inLoading||(this.setLoading(!0),n.ajax("analyze","GET").then(function(e){Lightspeed.collections=[],Lightspeed.groups=Object.values(e).map(function(e){return e.collection=new s(e.items.map(function(e){return _objectSpread({},e,{optimized:!!parseInt(e.optimized)})})),Lightspeed.collections.push(e.collection),e}),t.setLoading(!1),Lightspeed.router.navigate("#optimization/analyze",{trigger:!0})}))},setLoading:function(e){var t=!(0<arguments.length&&void 0!==e)||e;this.inLoading=t,this.$(".analyze-icon").toggleClass("loading",t)}})},"optimization-toggle.js":function(e,t,i){var n=i("../../utils");t.exports=Backbone.View.extend({events:{"click .toggle-lightspeed":"toggleLightspeed"},className:"page-optimization-toggle",render:function(){return this.$el.html(n.tpl("optimization/toggle",{isEnabled:Lightspeed.CONST.options.is_enabled})),this.$el},toggleLightspeed:function(e){var t=this,i=e.currentTarget.checked?1:0;n.ajax("options","POST",{key:"_tve_enable_lightspeed",value:i}).then(function(){Lightspeed.CONST.options.is_enabled=i,t.trigger("toggle",i)})}})},"optimize.js":function(e,t,i){var s=i("../../utils"),n=i("./progress-bar"),o=i("./group");t.exports=Backbone.View.extend({initialize:function(){var t=this;this.$progressBar=new n,this.optimizedItems=0,window.addEventListener("message",function(e){e.data&&"lightspeed-optimize"===e.data.from&&t.onOptimize(e.data)}),window.TVE_LS_API=this},resizeFrame:function(t,e){var i=1<arguments.length&&void 0!==e?e:"all";return new Promise(function(e){s.getOptimizationIframe(i).css("width",t+"px"),requestAnimationFrame(e)})},onOptimize:function(e){clearTimeout(this.waitingTimeout);var t=this.getOptimizingModel(e.id,e.key);this.optimizedItems++;var i={loading:!1,failed:void 0===t,optimized:void 0!==t};void 0===t&&Lightspeed.collections.find(function(e){return!!(t=e.findWhere({loading:!0}))}),t&&t.set(i),this.optimizeItems()},render:function(){var i=this;return this.$el.html(s.tpl("optimization/progress")),this.$(".progress-bar-wrapper").html(this.$progressBar.render()),Lightspeed.groups.forEach(function(e){var t=new o(e);i.$(".groups-to-optimize").append(t.render())}),setTimeout(function(){Lightspeed.startedTime=performance.now(),i.optimizeItems()},24),this},updateProgress:function(){var e=s.getOptimizedItems(),t=s.getTotalItems();this.$progressBar.updateProgress(100*e/t);var i=(performance.now()-Lightspeed.startedTime)/1e3;this.$(".optimization-time").html(s.secondsToTime(i/this.optimizedItems*(t-e))),this.$(".optimized-items").html(e),this.$(".total-items").html(t);var n=s.getFailedItems();this.$(".failed-optimization-wrapper").toggle(0!==n),0!==n&&this.$(".optimization-failed-items").html(n)},optimizeItems:function(){var e=this;this.updateProgress();var t=Lightspeed.collections.find(function(e){return!e.isOptimized()});if(t){var i=t.getItemToOptimize();if(i){i.set("loading",!0),this.$(".item-in-progress").html(i.get("name"));var n=new URL(this.decodeUrl(i.get("url"))),o=["force-flat","force-all-js","tcb-lightspeed-optimize"];window.location.href.includes("#advanced/main")&&o.push("tcb-advanced-optimize"),o.forEach(function(e){n.searchParams.append(e,1)}),s.getOptimizationIframe().css("width","").attr("src","".concat(n.href)),this.waitingTimeout=setTimeout(function(){i.set({loading:!1,failed:!0,optimized:!1}),Lightspeed.startedTime-=Lightspeed.CONST.timeout,e.optimizeItems()},Lightspeed.CONST.timeout)}}else this.onFinished()},onFinished:function(){s.getOptimizationIframe().remove(),Lightspeed.router.navigate("#optimization/finished",{trigger:!0})},getOptimizingModel:function(t,e){var i=1<arguments.length&&void 0!==e?e:"",n=null;return Lightspeed.collections.find(function(e){return!!(n=e.findWhere({id:t,key:i}))}),n||Lightspeed.collections.find(function(e){return!!(n=e.findWhere({id:t}))}),n},decodeUrl:function(e){return e.replace(/&#038;/g,"&")}})},"progress-bar.js":function(e,t,i){var n=i("../../utils");t.exports=Backbone.View.extend({initialize:function(){this.model=new Backbone.Model({progress:0}),this.listenTo(this.model,"change",this.render.bind(this))},render:function(){return this.$el.html(n.tpl("progress-bar",{progress:this.model.get("progress")})),this.$el},updateProgress:function(e){var t=0<arguments.length&&void 0!==e?e:0;t=parseInt(t),(isNaN(t)||t<0)&&(t=0),100<t&&(t=100),this.model.set("progress",t)}})}}}}}}}}})("workspace/admin/assets/js/lightspeed/main");